function _DYTask_(a){a?(this.id=a.id,this.cr_id=a.cr_id,this.url=a.url,this.referer=a.referer,this.page_title=a.page_title,this.text=a.text,this.title=a.title,this.size=a.size,void 0==this.size&&(this.size=-1),this.iconURL16=a.iconURL16,this.iconURL32=a.iconURL32,this.folder=a.folder,this.naming=a.naming,this.naming_auto=a.naming_auto,this.folder_auto=a.folder_auto,this.name_conflict=a.name_conflict,this.state=a.state,this.time_add=new Date(a.time_add),this.time_finish=a.time_finish?new Date(a.time_finish):
null,this.time_elapsed=a.time_elapsed,this.max_threads_config=a.max_threads_config,this.checksum=a.checksum,this.desc=a.desc,this.batch_num=a.batch_num,this.exists=a.exists,this._start_time=a._start_time,this.hash=a.hash,this.temp_file=a.temp_file,this.recycled=a.recycled,this.blocksize=a.blocksize,this.blockcnt=a.blockcnt,this.finished_blocks=a.finished_blocks,this.finished_bytes=a.finished_bytes,this.etag=a.etag,this.last_modified=a.last_modified,this.mime_type=a.mime_type,this.file_ext=a.file_ext,
this.full_path=a.full_path,this.eurl=a.eurl,this.single_thread=a.single_thread,this.error_str=a.error_str):(this.id=-1,this.cr_id=-2,this.title=this.text=this.page_title=this.referer=this.url="",this.size=-1,this.naming=this.folder=this.iconURL32=this.iconURL16="",this.folder_auto=this.naming_auto=!0,this.name_conflict="",this.state=2,this.time_add=new Date,this.time_finish=null,this.time_elapsed=0,this.max_threads_config=5,this.desc=this.checksum="",this.batch_num=0,this.exists=!1,this.temp_file=
this.hash="",this.recycled=!1,this.finished_bytes=this.finished_blocks=this.blockcnt=this.blocksize=0,this.eurl=this.full_path=this.file_ext=this.mime_type=this.last_modified=this.etag="",this.single_thread=!0);0<this.size?(0<this.blocksize&&(this.finished_bytes=Math.min(this.size,this.blocksize*this.finished_blocks)),this.progress=this.finished_bytes/this.size*100):this.progress=3==this.state?100:0;this.time_remained=this.active_threads=this.max_threads=this.speed=0;this._cf={}};

function ca(a){var c=0,b=0,e=[];a&&(c=a,b=Math.ceil(a/32))&&(e=new Uint32Array(Array(b)),(a%=32)&&(e[b-1]|=~((1<<a)-1)));a={bc:function(){return c},ac:function(){var a,g=0;if(e&&b)for(var d=0;d<b;++d)a=e[d],a=a-(a>>>1&3681400539)-(a>>>2&1227133513),a=a+(a>>>3)&3340530119,g+=((a&2147483647)%63+((a&2147483648)>>>30))%63;return g-(32*b-c)},resize:function(a){c=a;e=[];if(b=Math.ceil(a/32))e=new Uint32Array(Array(b)),(a%=32)&&(e[b-1]|=~((1<<a)-1))},reset:function(){if(e&&b){for(var a=0;a<b;++a)e[a]=0;
(a=c%32)&&(e[b-1]|=~((1<<a)-1))}},complete:function(){if(e&&b)for(var a=0;a<b;++a)e[a]=4294967295},set:function(a,b){if(void 0==b)b=1;else if(0==b)return;var d=a+b;d>c&&(d=c);for(var g,v,k=0;0<=a&&a<d;)g=Math.floor(a/32),v=a%32,e[g]&1<<v||++k,e[g]|=1<<v,++a;return k},get:function(a){return 0<=a&&a<c?e[Math.floor(a/32)]&1<<a%32?1:0:0},clear:function(a){0<=a&&a<c&&(e[Math.floor(a/32)]&=~(1<<a%32))},pb:function(a){if(e&&b)for(var g=0,d=0;d<b;++d)for(var k=0;32>k&&g<c;++k,++g)e[d]&1<<k&&a(g)},ya:function(a){if(!c)return-1;
for(var g=0,d;g<b&&65535==(e[g]&65535)&&65535==(e[g]>>16&65535);)++g;if(g==b)return-1;var k=e[g];for(d=0;k&1;)++d,k>>=1;a&&(e[g]|=1<<d);return 32*g+d}};a.set=a.set;return a};window._gaq=window._gaq||[];window._gaq.push(["_setAccount","UA-32450437-3"],["_setDetectFlash",!1],["_setDetectTitle",!1],["_trackPageview"]);function fa(a,c,b,e,k){window._gaq.push(["_trackEvent",a,c,b,e,k])}function ga(a,c){c.forEach(function(b){for(b.unshift("_trackEvent",a);5>b.length;)b.push(void 0);b.push(!0);window._gaq.push(b)})}
window.addEventListener("load",function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://ssl.google-analytics.com/ga.js";document.body.appendChild(a)});var ha=localStorage;var f=chrome.i18n.getMessage,h=chrome.runtime.sendMessage;function ia(a){return a?a.trim():""}
var ja=/^data:([^;]+)((?:;[^=]+=[^;]+)*)(?:;(base64))?,(.+)$/,ka=RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),
la={"3gpp":"3gp","3gpp2":"3g2",aiff:"aif","ms-asf":"asf",basic:"au",msvideo:"avi",binary:"bin",macbinary:"bin","octet-stream":"bin","windows-bmp":"bmp",bzip:"bz",bzip2:"bz2",java:"class","java-class":"class",msword:"doc","openxmlformats-officedocument.wordprocessingml.document":"docx",fortran:"f",icon:"ico","java-source":"java",jpeg:"jpg",pjpeg:"jpg",mpegurl:"m3u",rfc822:"mhtml",matroska:"mkv",quicktime:"mov",mpeg3:"mp3",mpeg:"mp4","sgi-movie":"mv",pascal:"p","portable-bitmap":"pbm","portable-floatmap":"pfm",
"portable-graymap":"pgm","portable-pixmap":"ppm",mspowerpoint:"ppt","ms-powerpoint":"ppt",powerpoint:"ppt","openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx",postscript:"ps","adobe.photoshop":"psd","script.phyton":"py","pn-realaudio":"ra","rn-realmedia":"rm",bsh:"sh","svg+xml":"svg",gnutar:"tgz",plain:"txt","ms-wma":"wma","ms-wmv":"wmv",excel:"xls",msexcel:"xls","ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",
compressed:"zip","zip-compressed":"zip"};function l(a){a=(a||"").trim();var c={},b=14;if(0==a.indexOf("data:")){for(;b--;)c[na[b]]="";c.protocol="data";(b=ja.exec(a))&&b[1]&&(a=b[1].match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&a[1]&&(c.file="download."+(la[a[1]]||a[1]))}else for(a=oa?pa.exec(a):qa.exec(a);b--;)c[na[b]]=a[b]||"";return c}
var oa=!1,na="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),pa=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,qa=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;
function n(a){a=(a||"").trim();var c=a.lastIndexOf("."),b=-1!=c;b||(c=a.length);return{P:a.substr(0,c),w:a.substr(c+1),fc:b}}function ra(a){return(a||"").trim().replace(/(^(\\|\/|\.)+)|((\\|\/|\.)+$)/g,"").replace(/\s*(\\|\/)+\s*/g,"/").trim()}function sa(a){return a?a.substr(Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1):""}function ta(a){return a&&!/^ *(\.|\\|\/)/.test(a)&&""!=a.replace(/[\.\*\\\/\_]/g,"").trim()}
function ua(a){a=Math.round(a);var c;60>a?c="Second":3600>a?(a=Math.round(a/60),c="Minute"):86400>a?(a=Math.round(a/3600),c="Hour"):(a=Math.round(a/86400),c="Day");1<a&&(c+="s");return f("unit"+c,[a.toString()])}function va(a){return 1E3>a?+a.toFixed(2)+" B":1024E3>a?+(a/1024).toFixed(2)+" KB":1048576E3>a?+(a/1048576).toFixed(2)+" MB":+(a/1073741824).toFixed(2)+" GB"}function wa(a){return 0>a?f("phraseUnknown"):va(a)+"/s"}var p=0,p=0,xa=p++,ya=p++,za=p++,p=0,y=p++,C=p++,D=p++,Aa=p-1,H=p++,J=p++;p++;
var p=0,Ba=p++,Ca=p++,p=0,Da=p++;p++;var Ea=p++,Fa=p++,p=0,Ga=p++,Ha=p++;p++;var p=0,Ia=p++;p++;p++;var Ja=p++,Ka=p++,p=0;p++;p++;var La=p++,p=0;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p++;p=0;p++;p++;p++;p=0;p++;var p=256,Ma=p++;p++;p++;p++;p++;p++;p=512;p++;p++;var Na="dy_proxy_enable dy_proxy dy_max_con_tasks dy_retry_count dy_retry_timeout dy_cache_max dy_cache_unit dy_bandlimit dy_file_permission".split(" "),Oa=f("chromesysFailedGenericNetworkError"),Pa=f("chromesysFailedGenericDownloadError");
f("stateDownloading");f("stateQueue");f("statePaused");f("stateFinished");f("stateError");f("stateFileMiss");var Qa={none:f("errorNone"),fnConflict:f("errorFNameConflict"),noID:f("errorNoID"),NETWORK_FAILED:Oa,NETWORK_DISCONNECTED:Oa,NETWORK_SERVER_DOWN:Oa,NETWORK_INVALID_REQUEST:Oa,FILE_FAILED:Pa,FILE_HASH_MISMATCH:Pa,SERVER_NO_RANGE:Pa};function Ra(a){return a?Qa[a]||f("chromesysFailed_"+a)||a:""};var Sa=["",[String.fromCharCode(103),String.fromCharCode(108),String.fromCharCode(99)].join(""),"1_"].join("_");function Ta(a){var c=void 0;a=ha[Sa+a];if(void 0!=a)try{c=JSON.parse(atob(a[1]+a.substr(3)))}catch(b){}return c}function Ua(a){a=Ta(a);var c=Date.now();return!a||!a._t||isNaN(a._t)||!isFinite(a._t)||6048E5<c-a._t?{_t:c}:a}
function Va(a,c,b,e){function k(a){return btoa(a.split("").map(function(a){var b=a.charCodeAt(0),c=0;"_"!=a&&(c=60<b?-55:53);return String.fromCharCode(b+c)}).join(""))}e=e||1;var g=Ua(a);c=k(c)+(b?";"+k(b):"");g[c]=(g[c]||0)+e;(function(a,b){var c=btoa(JSON.stringify(b));ha[Sa+a]=String.fromCharCode(97+Math.floor(26*Math.random()))+c[0]+String.fromCharCode(97+Math.floor(26*Math.random()))+c.substr(1)})(a,g)}
function Wa(a){if(!(0>=a)){var c=Math.round(Math.log2(a));Va("dz","sz",10>c?(1<<c)+"B":20>c?(1<<c-10)+"KB":30>c?(1<<c-20)+"MB":(1<<c-30)+"GB");Va("dz","sz_raw","",a)}};var M=_DYTask_;
M.prototype.reset=function(a,c){this.naming_auto&&(this.naming="");this.folder_auto&&(this.folder="");this.name_conflict="";this.o=this.M=void 0;this.eurl=this.url;this.cr_id=-2;this.size=-1;this.iconURL32=this.iconURL16="";void 0!=a&&(this.state=a);this.time_finish=null;this.batch_num=this.time_elapsed=0;this.exists=!1;this.hash="";this._start_time=void 0;this.temp_file="";this.recycled=!1;this.finished_bytes=this.finished_blocks=this.blockcnt=this.blocksize=0;this.full_path=this.mime_type=this.last_modified=
this.etag="";this.single_thread=!0;this.error_str=void 0;this.time_remained=this.active_threads=this.max_threads=this.speed=this.progress=0;0!=c&&(this.time_add=new Date);this._cf={}};
(function(){function a(a,c,g,d,m){if("mime"==c)c="mime_type";else if("addtime"==c)c="time_add";else if("refer"==c)c="referer";else if("remark"==c||"remarks"==c)c="desc";var e=null;switch(c){case "host":e=g.host;break;case "query":case "anchor":e=g[c];break;case "subdirs":e=g.directory;break;case "name":e=d?decodeURIComponent(d.P):"";break;case "ext":e=d?d.w:"";break;case "url":e=a.url;break;case "eurl":e=a.eurl;break;case "num":return a.batch_num||(a.batch_num=b++),a.batch_num;case "date":case "datetime":e=
new Date;break;case "state":case "size":case "referer":case "page_title":case "text":case "title":case "time_add":case "time_elapsed":case "checksum":case "desc":case "progress":case "finished_bytes":case "mime_type":e=a[c];break;default:1==m&&(e="_"+c+"_")}return e}function c(c,b,g){function d(a){return 10>a?"0"+a:a.toString()}function e(a,c){var b={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),S:a.getMilliseconds()};c||(c="yyyy-MM-dd hh:mm:ss");/(y+)/.test(c)&&
(c=c.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in b)(new RegExp("("+d+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?b[d]:("00"+b[d]).substr((""+b[d]).length)));return c}b=(b||"").trim();if(!b)return"";var v=l(c.url),x=n(c.file_ext||(c.eurl!=c.url?l(c.eurl).file:"")||v.file);b=b.replace(/\*(flat)?([^\*]+)?\*/gi,function(b,k,m){if(m){var w=ia(m.replace(/\s+,\s+/,",")).split(",");b="";m=w[0];var w=w[1],q=new Date;switch(m){case "hh":b=d(q.getHours());break;
case "mm":b=d(q.getMinutes());break;case "ss":b=d(q.getSeconds());break;case "y":b=q.getFullYear().toString();break;case "m":b=d(q.getMonth()+1);break;case "d":b=d(q.getDate());break;case "wd":b=""+q.getDay();break;case "datetime":b=e(q,w);break;case "date":b=e(q,w||"yyyy-MM-dd");break;case "time":b=e(q,w||"hh:mm:ss");break;case "time_add":case "addtime":b=e(c.time_add,w);break;case "size_s":b=va(c.size);break;default:"state"!=m&&"progress"!=m&&"finished_bytes"!=m&&"time_elapsed"!=m?b=a(c,m,v,x,!0):
b="_"+m+"_"}(b=b||"")&&(k||g)&&(b=(b||"").replace(/\/|\\/g,"_"));return b}return""});return ra(b.replace(/\~|\*|\?|\:|\||\<|\>|\"/g,"_"))}var b=1;M.prototype.cb=function(b){var c=l(this.url),e=n(this.file_ext||(this.eurl!=this.url?l(this.eurl).file:"")||c.file);b=a(this,b,c,e);if(void 0==b||null==b)b="";return b};M.prototype.sa=function(){return sa(this.full_path)||this.file_ext||l(this.url).file};M.prototype.Ea=function(){return c(this,this.naming)};M.prototype.D=function(){return sa(this.full_path)||
this.M||(this.M=sa(this.Db()))};M.prototype.Db=function(){if(this.o)return this.o;for(var a={},b=[this.naming,N.get("def_naming"),"*name*.*ext*","*subdirs*","*anchor*","*query*","*host*"],g=0,d=b.length;g<d;++g){var m=b[g];if(m&&!a[m]&&(a[m]=!0,this.o=c(this,m,2<=g),ta(this.o)))return this.o}return this.o="_file"}})();M.prototype.reset=M.prototype.reset;M.prototype.get_raw_name=M.prototype.sa;M.prototype.render_UI_name=M.prototype.D;function Xa(a,c){return(-1<navigator.platform.indexOf("Mac")?((c||"")&&"\u21e7")+"\u2318":"Ctrl+")+a}
var N={Oa:{general:{name:f("titleOptionsGeneral"),sections:[{name:"Chrome",id:"gen-chrome",items:["override_cr","hide_cr_bar"]},{name:f("optSectionTaskDefaults"),id:"gen-new-task-def",tip:f("tipOptSectionTaskDefaults"),items:["def_addtop","def_addpause"]},{name:f("optSectionOneClick"),id:"gen-one-click",items:["doneclick_rule"]},{name:f("optSectionNetwork"),id:"gen-network",items:["dy_max_con_tasks","dy_max_per_server"]},{name:f("optSectionMisc"),id:"gen-misc",items:["fnconflict","down_clipboard",
"clear_search","recycle_cancel"]}]},"interface":{name:f("titleOptionsInterface"),sections:[{name:f("chromesysLanguageSection"),id:"int-language",description:f("msgChromeI18nLanguage")+(f("uilang").substr(0,2).toLowerCase()!=chrome.i18n.getUILanguage().substr(0,2).toLowerCase()?"<br>Oops, Chrono is not yet available in "+(f("uilangName")||"your language")+', please help us with <a target=_blank href="http://translate.chronodownloader.net">translation</a> :)':""),items:["_uilanguage"]},{name:f("optSectionBehaviors"),
id:"int-behaviors",items:["start_interrupted","slide_details_panel","dbclick_action"]},{name:f("optSectionMenu"),id:"int-menu",items:["menu_d_dialog","menu_d_oneclick"]},{name:f("optSectionPopup"),id:"int-popup",items:["poplist_showd_first","poplist_clear_close","poplist_like_btns","poplist_max_items","poplist_remove_confirm"]},{name:f("optSectionPreview"),id:"int-preview",items:["preview_autoplay"]},{name:f("optSectionNotifications"),id:"int-notifications",items:"notify_oneclick notify_finish notify_error sound_finish sound_error notify_progress notify_large_preview click_notify".split(" ")},
{name:f("optSectionMisc"),id:"int-misc",items:["badge_downnum","font_size"]}]},rules:{name:f("titleOptionsRules"),sections:[{items:["match_mode","def_naming"]}]}},items:{_uilanguage:{label:"",type:"button",buttonText:f("chromesysChange"),onclick:function(){chrome.tabs.create({url:"chrome://settings/languages"})}},fnconflict:{label:"When file name conflicts",type:"select",options:[f("optOptionUniquify"),f("optOptionOverwrite"),f("optOptionPrompt"),f("optOptionSkipPause"),f("optOptionSkipCancel")],
value:Ia,b:"NameConflict"},def_threads:{label:f("fieldThreads"),type:"int",native_only:!0,value:5,min:1,max:15},def_addtop:{label:f("optionAddTop"),type:"bool",value:!1},def_addpause:{label:"Add paused",type:"bool",value:!1,b:"DefAddPaused"},down_clipboard:{label:"Download URL from Clipboard",type:"bool",value:!0,b:"DownloadClipboard"},start_interrupted:{label:"Start Button also starts interrupted tasks",type:"bool",value:!1,b:"StartInterrupted"},override_cr:{label:f("optItemOverrideChrome",[Xa("J",
!0)]),type:"bool",value:!0,f:function(a){Q.da(a)}},hide_cr_bar:{label:"Hide Chrome's Downloads Shelf(Bar)",type:"bool",value:!0,f:function(a){chrome.downloads.setShelfEnabled(!a)},b:"HideShelf"},slide_details_panel:{label:"Slide details panel when click on task",type:"bool",value:!0,b:"SlideDetailsPanel",tip:f("tipOptItemSlideDetailsPanel")},recycle_cancel:{label:"Cancel the task when it's recycled",type:"bool",value:!1,b:"RecycleCancel"},clear_search:{label:"Clear search box when filter changes",
type:"bool",value:!1,b:"ClearSearch"},menu_d_dialog:{label:f("menuDLink"),type:"bool",value:!0,f:function(a){Ya.Rb(a)},ca:function(a){this.f(a)}},menu_d_oneclick:{label:f("menuDLinkOneClick"),type:"bool",value:!0,f:function(a){Ya.Sb(a)},ca:function(a){this.f(a)}},notify_error:{label:"When error occurs",type:"bool",value:!0,f:function(a){0==a&&Za("terr_")},b:"NotifyError"},notify_finish:{label:"When download completes",type:"bool",value:!0,f:function(a){0==a&&Za("tfin_")},b:"NotifyFinish"},sound_finish:{label:"Play sound when download completes",
type:"bool",value:!0,b:"SoundFinish"},sound_error:{label:"Play sound when error occurs",type:"bool",value:!0,b:"SoundError"},notify_oneclick:{label:"When adding One-Click download",type:"bool",value:!0,f:function(a){0==a&&Za("task_")},b:"NotifyOneClick"},notify_progress:{label:"Show download progress",type:"bool",value:!0,f:function(a){0==a&&Za("task_")},b:"NotifyProgress"},notify_large_preview:{label:"Show large preview for images",type:"bool",value:!0,b:"NotifyLargePreview"},click_notify:{label:"Clicking on a notification",
type:"select",options:[f("menuOpenManager"),f("optOptionClearNotify"),f("optOptionClearAllNotify")],value:Ga,b:"ClickNotify"},msg_singlet:{label:"Notify when task is not resumable",type:"bool",value:!0},dbclick_action:{label:"Double-click on task",type:"select",options:[[f("optOptionDoNothing"),Da],[f("optOptionOpenFile"),Ea],[f("optOptionOpenFolder"),Fa]],value:Fa,b:"DblClickAction"},doneclick_rule:{label:f("phraseEnable"),type:"bool",value:!0,tip:f("tipOptSectionOneClick"),tipURL:"http://faq.chronodownloader.net/index.php?sid=168941&lang=en&action=artikel&cat=7&id=3"},
badge_downnum:{label:"Show Downloading Number",type:"bool",value:!0,b:"BadgeDownloadNum",f:function(){S.u(-1)}},font_size:{label:f("chromesysFontSize"),type:"int",value:14,min:12,max:16,f:function(a){h({cmd:"u_font_size",data:a})}},poplist_max_items:{label:"Max Items",type:"int",value:15,min:1,max:50,b:"PopMaxItems"},poplist_showd_first:{label:"Show downloading tasks first",type:"bool",value:!0,b:"PopShowDLFirst"},poplist_clear_close:{label:"Close after clear",type:"bool",value:!1,b:"PopClearClose"},
poplist_like_btns:{label:"Show social media button",type:"bool",value:!0,b:"PopLikeButtons"},dy_max_con_tasks:{label:"Concurrent downloads",type:"int",value:10,min:1,max:20,cc:Ma,b:"ConcurrentDownloads",f:function(){T.K()}},dy_max_per_server:{label:"Downloads per server",type:"int",value:5,min:1,max:5,b:"DownloadsPerServer",f:function(){T.K()}},def_folder:{label:"Default folder",type:"string",value:"",native_only:!0,tip:f("tipOptNoRuleMatch"),b:"DefFolder"},def_naming:{label:"Default Naming Mask",
type:"string",value:"*name*.*ext*",ja:"*name*.*ext*",tip:f("tipOptNoRuleMatch"),b:"DefNaming"},match_mode:{label:"Match Mode",type:"select",options:[f("optOptionFirstMatch"),f("optOptionReplace")],value:Ba,tip:f("tipOptItemRuleMatchMode"),b:"RuleMatchMode"},tb_fit_cols:{type:"bool",value:!1},tb_sync_resize:{type:"bool",value:!1},tb_def_cols:{type:"string",value:'["state","name","progress","size","speed","active_threads","time_remained","url","time_add"]'},tb_sort_cols:{type:"string",value:'[{"field":"time_add","sortAsc":false}]'},
tb_free_order:{type:"string",value:"{}"},tip_rateshare:{type:"int",value:1,message:f("msgRateShare",[f("extName"),f("chromesysWebStore")])},tip_rateshare_wait:{type:"int",value:1},tip_translate:{type:"int",value:0},tip_notifications:{type:"int",value:0,message:f("tipmsgNotifications",[f("titleOptions")+" > "+f("titleOptionsInterface")+" > "+f("optSectionNotifications")]),set_section:"interface.int-notifications",freq:6},tip_dblclick:{type:"int",value:0,message:f("tipmsgDoubleClick",[f("titleOptions")+
" > "+f("titleOptionsInterface")+" > "+f("optSectionBehaviors")]),set_section:"interface.int-behaviors",freq:3},tip_slide:{type:"int",value:0,message:f("tipmsgSlideDetailsPanel",[f("titleOptions")+" > "+f("titleOptionsInterface")+" > "+f("optSectionBehaviors")]),set_section:"interface.int-behaviors",freq:5},tip_taskfilter:{type:"int",value:0,message:f("tipmsgTaskFilter",[f("titleOptions")+" > "+f("titleOptionsRules")]),set_section:"rules",freq:4},tip_openmanager:{type:"int",value:0,message:f("tipmsgOpenShortcut",
[f("extName"),Xa("J",!0)]),freq:4},tip_grid:{type:"int",value:0,message:f("tipmsgGridSelection",[Xa("A")]),freq:8},tip_copyselurls:{type:"int",value:0,message:f("tipmsgCopySelectedURLs",[Xa("C")]),freq:1},tip_colfit:{type:"int",value:0,message:f("tipmsgFitColumnWidth"),freq:1},pop_preview:{type:"bool",value:!0},pop_showsize:{type:"bool",value:!0},pop_content:{type:"int",value:0},pop_sniffer_hint:{type:"int",value:0},pop_clear_file:{type:"bool",value:!1},poplist_remove_confirm:{type:"select",value:La,
b:"PopDeleteAction",label:"Click 'Delete' button",options:[f("optOptionRemList"),f("optOptionRemFile"),f("optOptionRemAsk")]},preview_autoplay:{type:"bool",value:!1,b:"PreviewAutoplay"},bg_image_enable:{type:"bool",value:!1},bg_image_everset:{type:"bool",value:!1},bg_image_url:{type:"string",value:"../icons/bg/1.jpg"},bg_image_opacity:{type:"float",value:.35,min:0,max:1},bg_image_blur:{type:"int",value:0,min:0,max:10},ui_grid_list:{type:"bool",value:!0},_glst:{type:"int",value:0},autoclear_type:{type:"string",
value:"both"},autoclear_timer:{type:"int",value:-1},autoclear_lasttime:{type:"int",value:-1},search_mode:{type:"string",value:"normal"},search_case_sensitive:{type:"bool",value:!1}},load:function(){for(var a in N.items){var c=N.items[a];c.b&&(c.label=f("optItem"+c.b));var b=localStorage["#"+a];if(void 0!=b)switch(c.type){case "bool":"true"==b?c.value=!0:"false"==b&&(c.value=!1);break;case "select":case "int":b=parseInt(b);isNaN(b)||b<c.min||b>c.max?console.log('load from storage, invalid value for "'+
a+'"'):c.value=b;break;case "float":b=parseFloat(b);isNaN(b)||b<c.min||b>c.max?console.log('load from storage, invalid value for "'+a+'"'):c.value=b;break;default:c.value=b}c.ca&&c.ca(c.value)}V.load();a=0;for(c=Na.length;a<c;++a);},s:function(){V.s()},H:function(){return{addtop:N.get("def_addtop")}},get:function(a){return(a=N.items[a])?""===a.value?void 0==a.ja?"":a.ja:a.value:null},aa:function(a){return N.items[a]},Wa:function(a){return N.Oa[a]},set:function(a,c){var b=N.items[a];return b&&(void 0==
b.min||c>=b.min)&&(void 0==b.max||c<=b.max)?(b.value=c,localStorage["#"+a]=c,b.f&&b.f(c),!0):!1},ua:function(a){var c=N.items[a];if(c){var b=c.value?++c.value:1;c.value=b;localStorage["#"+a]=b;c.f&&c.f(b)}}};N.set=N.set;N.get=N.get;N.getRaw=N.aa;N.getCat=N.Wa;N.inc=N.ua;N.get_taskdef=N.H;N.commit=N.s;window.dy_settings=N;function $a(a,c){function b(){if(d){var a=g.length;localStorage[v]=a;for(var b=0;b<a;++b)localStorage[m+b]=JSON.stringify(g[b]);for(b=a;15>b;++b)localStorage.removeItem(m+b);d=!1}}function e(a,b){return b.v==a.v?b.time-a.time:b.v-a.v}function k(a){for(var c=0,v=g.length,m=(new Date).getTime(),u=1;c<v;++c)if(g[c].value==a){if(4E3>m-g[c].time)return;u=g[c].v+1;g[c].v=1E6;g[c].time=m;break}c>=v&&(15<=v&&g.splice(14,1),g.push({value:a,v:1E6,time:m}));g.sort(e);g[0].v=u;d=!0;b()}var g=[],d=!1,m=a,v=c;
return{load:function(a){var c=parseInt(localStorage[v]);isNaN(c)&&(c=0);for(var e,x=0;x<c;++x)(e=localStorage[m+x])&&g.push(JSON.parse(e));d=g.length!=c;b();if(!c)for(x=0;x<a.length;++x)k(a[x])},s:b,Tb:k,ta:function(){for(var a=Math.min(6,g.length),b=[],c=0;c<a;++c)b.push(g[c].value);return b},ec:function(){return 0<g.length?g[0].value:null}}}var ab=new $a("path_rt_","path_rt_cnt"),bb=new $a("naming_rt_","naming_rt_cnt");var Q=function(){function a(a){chrome.tabs.get(a.tabId,function(a){"chrome://downloads/"==a.url&&e({c:!0,l:a.id})})}function c(a,b){"chrome://downloads/"==b.url&&e({c:!0,l:a})}function b(a){"chrome://downloads/"==a.url&&e({c:!0,l:a.id})}function e(a,b){function c(){b&&b();d=!1;if(0<m.length){var a=m.shift();e(a.tb,a.Na)}}function g(a){chrome.windows.getCurrent(function(b){chrome.runtime.lastError&&!b?(console.log(chrome.runtime.lastError),console.log("checking in one second"),setTimeout(function(){g(a)},
1100)):a&&a()})}d?(m.push({tb:a,Na:b}),console.log("still opening")):(d=!0,a||(a={c:!0}),void 0==a.c&&(a.c=!0),-1!=S.m?(a.l&&a.l!=S.m&&(console.log("opt.tabId != tab.id"),chrome.tabs.remove(a.l)),a.c&&(chrome.tabs.get(S.m,function(a){chrome.windows.update(a.windowId,{focused:!0})}),chrome.tabs.update(S.m,{active:!0})),c()):(S.Fb(c),a.l?(a.c&&chrome.tabs.get(a.l,function(a){chrome.windows.update(a.windowId,{focused:!0})}),chrome.tabs.update(a.l,{active:a.c,url:k})):g(function(){chrome.tabs.create({active:a.c,
url:k})})))}var k=chrome.extension.getURL("ui/index.htm"),g=chrome.extension.getURL("ui/options.htm"),d=!1,m=[];return{jb:k,hc:g,qa:function(a){chrome.windows.getLastFocused({populate:!1},function(b){chrome.tabs.query({active:!0,windowId:b.id},function(b){a(b&&b.length?b[0]:null)})})},da:function(d){d?(chrome.tabs.onUpdated.hasListener(c)||chrome.tabs.onUpdated.addListener(c),chrome.tabs.onCreated.hasListener(b)||chrome.tabs.onCreated.addListener(b),chrome.tabs.onActivated.hasListener(a)||chrome.tabs.onActivated.addListener(a)):
(chrome.tabs.onUpdated.removeListener(c),chrome.tabs.onCreated.removeListener(b),chrome.tabs.onActivated.removeListener(a))},h:e,R:function(a){a||(a={});(function(a,b){chrome.tabs.query({url:a},function(c){c.length?b(c):chrome.tabs.query({url:a+"?*"},function(c){c.length?b(c):chrome.tabs.query({url:a+"#*"},function(c){c.length?b(c):chrome.tabs.query({url:a+".*"},function(a){b(a)})})})})})(g,function(b){var c=g+(a.V?"#"+a.V:"");if(b&&b.length){b=b[0];var d=a.C||b.windowId;if(a&&a.C&&a.J){var e=b.index,
m=a.J;b.windowId==a.C&&e<m&&--m;chrome.tabs.move(b.id,{windowId:a.C,index:m})}chrome.windows.update(d,{focused:!0});c!=b.url?chrome.tabs.update(b.id,{url:c,active:!0}):chrome.tabs.update(b.id,{active:!0})}else a&&a.C&&a.J?chrome.tabs.create({url:c,windowId:a.C,index:a.J}):chrome.tabs.create({url:c})})}}}();var W=function(){function a(a){console.log("StoreMan::onerror: "+a)}function c(a){var b=S.g;if(e){var c=e.transaction("tasks","readwrite").objectStore("tasks");b.pb(function(a){var d=S.fa(a);d&&(d=c.put({id:d.id,cr_id:d.cr_id,url:d.url,referer:d.referer,page_title:d.page_title,text:d.text,title:d.title,size:d.size,iconURL16:d.iconURL16,iconURL32:d.iconURL32,folder:d.folder,naming:d.naming,naming_auto:d.naming_auto,folder_auto:d.folder_auto,name_conflict:d.name_conflict,state:d.state,time_add:d.time_add,
time_finish:d.time_finish,time_elapsed:d.time_elapsed,max_threads_config:d.max_threads_config,checksum:d.checksum,desc:d.desc,batch_num:d.batch_num,hash:d.hash,exists:d.exists,_start_time:d._start_time,temp_file:d.temp_file,recycled:d.recycled,blocksize:d.blocksize,blocks:d.Xb,finished_blocks:d.finished_blocks,finished_bytes:d.finished_bytes,etag:d.etag,last_modified:d.last_modified,mime_type:d.mime_type,file_ext:d.file_ext,full_path:d.full_path,eurl:d.eurl,single_thread:d.single_thread,error_str:d.error_str}),
d.onsuccess=function(){b.clear(a)},d.onerror=function(b){console.log("IDB updateTask "+a+" fail");console.log(b)})});a&&a()}}function b(a){c(function(){a&&a()})}var e=null,k=window.indexedDB||window.webkitIndexedDB,g=null;return{open:function(b){var c=k.open("downloady",1);c.onerror=a;c.onsuccess=function(){var d=c.result;!c.hasOwnProperty("onupgradeneeded")&&d.setVersion?(console.log("Your Chrome's version is too low, indexedDB doesn't work well"),alert("Your Chrome's version is too low, indexedDB doesn't work well")):
(e=d,d.onerror=a,console.log("dbopened"),b&&setTimeout(b,0))};c.onupgradeneeded=function(a){console.log("dbupgradeneeded");a=a.target.result;console.log("dbupdated");a.createObjectStore("tasks",{keyPath:"id"})}},close:function(){e&&(e.close(),e=null)},clear:function(b){if(e){var c=e.transaction(["tasks"],"readwrite");c.onerror=a;c.objectStore("tasks").clear().onsuccess=function(){b&&b()}}else b&&b()},Ab:function(a){if(e){var b=e.transaction("tasks","readwrite").objectStore("tasks")["delete"](a);b.onsuccess=
function(){};b.onerror=function(b){console.log("IDB removeTaskById "+a+" fail");console.log(b)}}},Bb:function(a){if(e)for(var b=e.transaction("tasks","readwrite").objectStore("tasks"),c=0;c<a.length;++c)b["delete"](a[c].id)},zb:function(a){if(e)for(var b=e.transaction("tasks","readwrite").objectStore("tasks"),c=0;c<a.length;++c)b["delete"](a[c])},Ua:function(a){if(e){var b=[],c=e.transaction("tasks").objectStore("tasks").openCursor();c.onsuccess=function(c){(c=c.target.result)?(b.push(new M(c.value)),
c["continue"]()):(console.log("done"),a(b))};c.onerror=function(c){a(b);console.log(c)}}else console.log("getAllTasks: db not ready"),a([])},s:b,Mb:function(){g=setInterval(b,3E3)},Ob:function(){clearInterval(g);g=null}}}();var Ya=function(){function a(a,b,c,d){void 0==B[a]&&(B[a]=chrome.contextMenus.create({title:b,contexts:c,onclick:d,documentUrlPatterns:["http://*/*","https://*/*","ftp://*/*"]}))}function c(a){var b=B[a];void 0!=b&&(chrome.contextMenus.remove(b),delete B[a])}function b(a,b,c){var d={cmd:"d_one",task:{}};d.task.referer=b;d.task.url=a;if(a=cb.na(a))d.task.text=a.text,d.task.title=a.title,d.task.desc=a.download||a.text||a.title;chrome.tabs.sendMessage(c.id,d,function(a){a||(console.log("menu download no response"),
Q.h({c:!0},function(){h(d)}))})}function e(a,b,c){var d={};d.url=a;d.referer=b;var A=N.H();b=N.get("def_addpause");A=A.addtop;chrome.tabs.sendMessage(c.id,{cmd:"d_anim",addpause:b});c="";if(a=cb.na(a))d.text=a.text,d.title=a.title,d.desc=a.download||d.text||d.title,c=a.page_title;db.$()({cmd:"new_task",add_paused:b,addtop:A,tasks:[d],notify:!0,page_title:c,source:"ctxmenu_1click"},{},function(){})}function k(){Q.h()}function g(a,b){Q.R({C:b.windowId,J:b.index+1,V:"help"})}function d(){chrome.tabs.create({active:!0,
url:"http://faq.chronodownloader.net"})}function m(){chrome.tabs.create({active:!0,url:"http://bugs.chronodownloader.net"})}function v(a,c){a.linkUrl&&b(a.linkUrl,a.pageUrl||a.frameUrl,c)}function x(a,c){a.srcUrl&&b(a.srcUrl,a.pageUrl||a.frameUrl,c)}function w(a,b){a.linkUrl&&e(a.linkUrl,a.pageUrl||a.frameUrl,b)}function z(a,b){a.srcUrl&&e(a.srcUrl,a.pageUrl||a.frameUrl,b)}var B={};return{Rb:function(b){b?(a("d_link",f("menuDLink"),["link"],v),a("d_image",f("menuDImage"),["image"],x),a("d_video",
f("menuDVideo"),["video"],x),a("d_audio",f("menuDAudio"),["audio"],x)):(c("d_link"),c("d_image"),c("d_video"),c("d_audio"))},Sb:function(b){b?(a("d_link_oneclick",f("menuDLinkOneClick"),["link"],w),a("d_image_oneclick",f("menuDImageOneClick"),["image"],z),a("d_video_oneclick",f("menuDVideoOneClick"),["video"],z),a("d_audio_oneclick",f("menuDAudioOneClick"),["audio"],z)):(c("d_link_oneclick"),c("d_image_oneclick"),c("d_video_oneclick"),c("d_audio_oneclick"))},Ha:function(){a("ba_openmanager",f("menuOpenManager"),
["browser_action"],k);a("ba_help",f("menuGetHelp"),["browser_action"],g);a("ba_faq",f("btnFAQ"),["browser_action"],d);a("ba_report",f("menuReportIssue"),["browser_action"],m);"zh-CN"!=chrome.i18n.getUILanguage()&&a("ba_translate","Help us with translation",["browser_action"],function(){chrome.tabs.create({active:!0,url:"http://translate.chronodownloader.net"})})}}}();var cb=function(){function a(a){if("in_progress"==a.state&&(a.byExtensionId&&console.log(a.byExtensionId),!X.eb(a))){var b=a.url,c=a.referrer;if(V.ob(b))chrome.downloads.cancel(a.id,function(){chrome.downloads.erase({id:a.id})}),Q.qa(function(a){var d={cmd:"d_one",task:{}};d.task.url=b;d.task.referer=c;var e=k[b];e?(d.task.text=e.text,d.task.title=e.title,d.task.desc=e.download||e.text||e.title):console.log("desc not found");chrome.tabs.sendMessage(a.id,d,function(a){a||Q.h({c:!0},function(){h(d)})})});
else{var d=N.get("def_addpause"),g=function(){var b=S.Z(a.url,a.referrer);if(!b)return null;N.H();b.mime_type=a.mime;b.size=a.totalBytes;b.exists=a.exists;var c=k[b.url];c?(b.text=c.text,b.title=c.title,b.desc=c.download||b.text||b.title,b.page_title=c.page_title):console.log("url desc not found");return b}();g?d||!X.hb()?(chrome.downloads.cancel(a.id,function(){chrome.downloads.erase({id:a.id})}),g.reset(d?D:C),d||(T.enqueue(g),S.u(!0)),S.ha(g,d)):(g.state=y,e[a.id]=g):(chrome.downloads.cancel(a.id,
function(){chrome.downloads.erase({id:a.id})}),Q.h({c:!0},function(){h({cmd:"u_alert",data:Qa.noID})}))}}}function c(a){var b=e[a.id];if(b){for(var c in a){var d=a[c].current;switch(c){case "url":b.eurl=d;break;case "mime":b.mime_type=d;break;case "exists":b.exists=d;break;case "endTime":b.time_finish=new Date(d);break;case "state":"interrupted"==d?b.state=J:"complete"==d?b.state=H:"in_progress"==d&&(d=a.paused,b.state=d&&d.current?D:y);break;case "paused":a.state||(b.state=d?D:y);break;case "error":if((b.error_str=
d)&&0==d.toUpperCase().indexOf("USER_")){delete e[a.id];console.log("cancel in Save As: "+a.id);return}break;case "totalBytes":case "fileSize":b.size=d;break;case "danger":"safe"!=d&&"accepted"!=d&&(b.W=!0)}}(c=a.filename)&&!c.previous&&(delete e[a.id],b.full_path=c.current,X.ga(b,a.id,c.current,!1))}}function b(a){e[a]&&(console.log("cancel in Save As: "+a),delete e[a])}var e={},k={},g=[];return{ab:function(a){return e[a]},na:function(a){return k[a]},Gb:function(a,b,c,e,w){if(a){if(void 0!=k[a])for(var d=
0;d<g.length;++d)if(g[d]==a){g.splice(d,1);break}18<=g.length&&(delete k[g[0]],g.shift());g.push(a);k[a]={download:b,text:c,title:e,page_title:w}}},start:function(){chrome.downloads.onCreated.hasListener(a)||chrome.downloads.onCreated.addListener(a);chrome.downloads.onChanged.hasListener(c)||chrome.downloads.onChanged.addListener(c);chrome.downloads.onErased.hasListener(b)||chrome.downloads.onErased.addListener(b)},stop:function(){chrome.downloads.onCreated.removeListener(a);chrome.downloads.onChanged.removeListener(c);
chrome.downloads.onErased.removeListener(b)}}}();var V=function(){function a(a){return a.replace(/\[([^\]]+)\]/gi,function(a,b){var A=b?b.trim().toLowerCase():"";if(1==r[A])throw"dy_rules.expand_exts: loop of link filter ["+A+"] detected";r[A]=!0;var d=c(A);delete r[A];if(!d)throw"dy_rules.expand_exts: ref link filter ["+A+"] not found";return"("+d+")"})}function c(b){for(var c=0;c<w.length;++c)if(w[c].int_name==b)try{return a(w[c].exts)}catch(O){console.log(O);break}return null}function b(a,b){for(var c in a)a.hasOwnProperty(c)&&!b.hasOwnProperty(c)&&
(b[c]=a[c]);return b}function e(){m=!0;g()}function k(){d=!0;g()}function g(){d&&(localStorage.lfilters=JSON.stringify(w),d=!1);if(m){localStorage.rules=JSON.stringify(u);for(var a=m=!1,b={},c=0,e=u.length;c<e;++c){for(var g=-1,k=0,r=q.length;k<r;k+=2)if(q[k]==u[c].id){g=k;b[u[c].id]=1;break}u[c].as_filter?-1==g&&(q.push(u[c].id),q.push(0),a=!0,b[u[c].id]=1):0<=g&&(q.splice(g,2),a=!0)}for(k=q.length-2;0<=k;k-=2)b[q[k]]||(q.splice(k,2),a=!0);a&&(localStorage.disp_filters=JSON.stringify(q));h({cmd:"u_filters",
rebuild:a})}}var d=!0,m=!0,v=new ca(500),x={caption:f("extsNew"),int_name:"",exts:".*",filter_links:!1},w=[{caption:f("extsImage"),int_name:"ext_image",exts:"bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp",filter_links:!0},{caption:f("extsVideo"),int_name:"ext_video",exts:"3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv",filter_links:!0},{caption:f("extsAudio"),int_name:"ext_audio",exts:"aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba",
filter_links:!0},{caption:f("extsDocument"),int_name:"ext_doc",exts:"c|cfg|cpp|cs|css|csv|dat|doc|docx|h|hpp|ini|js|log|m|pdf|ppt|pptx|ps|py|rtf|sh|tex|torrent|txt|xls|xlsx",filter_links:!0},{caption:f("extsArchive"),int_name:"ext_arch",exts:"7z|bin|cbr|cue|deb|dmg|gz|iso|mdf|pkg|rar|rpm|sitx|tar.gz|vcd|zip",filter_links:!0},{caption:f("extsApp"),int_name:"ext_app",exts:"apk|app|bat|cgi|com|dll|exe|gadget|jar|msi|pif|sys",filter_links:!0},{caption:f("extsAll"),int_name:"ext_all",exts:"[ext_audio]|[ext_video]|[ext_image]|[ext_doc]|[ext_arch]|[ext_app]",
filter_links:!1}],z={id:-1,int_name:"",condition:"true",as_filter:!1,caption:f("ruleNew"),active:!1,folder:"",naming:"",post_action:""},B=1,u=[{id:B++,int_name:"r_recent",condition:"*time_add*>=[3_days_ago]",as_filter:!0,caption:f("ruleRecent"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:B++,int_name:"r_downloading",condition:"*state*!=[finished]&&*state*!=[interrupted]",as_filter:!0,caption:f("ruleDownloading"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:B++,
int_name:"r_done",condition:"*state*==[finished]",as_filter:!0,caption:f("ruleFinished"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:B++,int_name:"r_done_image",condition:"{r_done}&&*ext*.is([ext_image])",as_filter:!0,caption:f("ruleImage"),active:!1,folder:"./images",naming:"",post_action:"<file>",init_indent:1},{id:B++,int_name:"r_done_video",condition:"{r_done}&&*ext*.is([ext_video])",as_filter:!0,caption:f("ruleVideo"),active:!1,folder:"./videos",naming:"",post_action:"",init_indent:1},
{id:B++,int_name:"r_done_audio",condition:"{r_done}&&*ext*.is([ext_audio])",as_filter:!0,caption:f("ruleAudio"),active:!1,folder:"./music",naming:"",post_action:"",init_indent:1},{id:B++,int_name:"r_done_doc",condition:"{r_done}&&*ext*.is([ext_doc])",as_filter:!0,caption:f("ruleDocument"),active:!1,folder:"./docs",naming:"",post_action:"<file>",init_indent:1},{id:B++,int_name:"r_done_other",condition:"{r_done}&&!(*ext*.is([ext_audio])||*ext*.is([ext_video])||*ext*.is([ext_image])||*ext*.is([ext_doc]))",
as_filter:!0,caption:f("ruleOther"),active:!1,folder:"",naming:"",post_action:"",init_indent:1},{id:B++,int_name:"r_interrupted",condition:"*state*==[interrupted]",as_filter:!0,caption:f("ruleInterrupted"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:B++,active:!1,caption:f("ruleSmallFiles"),int_name:"r_smallf",condition:"*size*>0&&*size*<kb(1024)",folder:"./small_files",naming:"",as_filter:!1,post_action:"<folder>"}],q=[],r={};return{ob:function(){return 1!=N.get("doneclick_rule")},
va:"aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba",xa:"3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv",wa:"bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp",Za:function(){return w},ra:function(){return u},bb:function(){for(var a=[],b=0,c=q.length;b<c;b+=2)for(var d=0,e=u.length;d<e;++d)u[d].id==q[b]&&1==u[d].as_filter&&a.push({id:u[d].id,caption:u[d].caption,filter:u[d].condition,indent:q[b+1]});return a},
Ib:function(a){q=a;localStorage.disp_filters=JSON.stringify(q)},Ja:function(a){a=b(z,a);a.id=v.ya(!0);u.push(a);e();fa("sets","rules","add")},Ia:function(a){a=b(x,a);w.push(a);k();fa("sets","ext_filters","add")},yb:function(a){for(var b=0;b<u.length;++b)if(u[b].int_name==a)return u[b].condition;return null},wb:function(a){r={};return c(a)},xb:function(b){r={};var c=null;if(0<=b&&b<w.length)try{c=a(w[b].exts)}catch(O){console.log(O)}return c},sb:e,rb:k,load:function(){var a=localStorage.getItem("lfilters");
a&&(w=JSON.parse(a));(a=localStorage.getItem("rules"))&&(u=JSON.parse(a));if(a=localStorage.getItem("disp_filters"))q=JSON.parse(a);else for(q=[],a=0;a<u.length;++a){var b=u[a];void 0!=b.init_indent&&(q.push(b.id),q.push(b.init_indent))}for(a=0;a<u.length;++a)v.set(u[a].id);d=m=!1},s:g,match:function(a){for(var b=N.get("match_mode"),c={},d=0;d<u.length;++d)if(u[d].active&&Y.Pb(a,u[d].condition))if(b==Ba){a=u[d];c.naming=a.naming;c.folder=a.folder;c.post_action=a.post_action;var e=ia(c.folder);e&&
(c.folder=e.replace(/^\./,N.get("def_folder")));break}else if(b==Ca){var g=ia(u[d].naming),e=ia(u[d].folder),k=ia(u[d].post_action);g&&(c.naming=g);e&&(c.folder=e.replace(/^\./,c.folder||N.get("def_folder")));k&&(c.post_action=k)}c.naming||(c.naming=N.get("def_naming"));c.folder||(c.folder=N.get("def_folder"));return c},Sa:function(){return{naming:N.get("def_naming"),folder:N.get("def_folder")}}}}();V.internal_audio=V.va;V.internal_video=V.xa;V.internal_image=V.wa;V.getLinkFilters=V.Za;
V.getRules=V.ra;V.get_display_filters=V.bb;V.set_display_filters=V.Ib;V.ref_filteri=V.xb;V.addRule=V.Ja;V.addFilter=V.Ia;V.on_rules_change=V.sb;V.on_filters_change=V.rb;window.dy_rules=V;var Y=function(){function a(){var a=new Date;v=a.getTime();g=a.getDay();d=a.getMonth();m=a.getFullYear();a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);x=a.getTime();w=x+864E5-1}function c(a){return a.replace(/\.match/g,".bmatch").replace(/\*([^\*]+)\*/gi,function(a,b){return"Fd('"+b.trim().toLowerCase()+"')"}).replace(/\{([^\}]+)\}/gi,function(a,b){var d=b?b.trim().toLowerCase():"";if(1==q[d])throw"circular dependency of rules detected";var A=V.yb(d);if(null==A||void 0==A)throw"referenced rule {"+
d+"} not found";q[d]=!0;A="("+c(A)+")";delete q[d];return A}).replace(/\[([^\]]+)\]/gi,function(a,b){var c=b?b.trim().toLowerCase():"",d;a:if(d=z[c],void 0!=d)d="function"==typeof d?"new Date("+d()+")":d;else{var A;if(A=c.match(/(\d+)_([a-z]+_ago_?)/)){d=parseInt(A[1]);if(isNaN(d)||0>=d)throw"bad number in: "+c;if(A=z[A[2]]){d="new Date("+A(d)+")";break a}throw"not supported function: "+c;}d=null}if(void 0!=d&&null!=d)return d;d=V.wb(c);if(void 0==d||null==d)throw"constant/referenced ext filter ["+
c+"] not found";return'"'+d+'"'})}function b(b,d){if(!b||""==b||"true"==b)return"true";0!=d&&a();var A=null;try{q={},A=c(b)}catch(G){return console.log("Invalid filter expression: "+G),null}return A}function e(a,b,c){if(!a)throw Error();if(b.recycled)return!1;r.ba=b;r.Aa=c;a=(new Function("with(this) { 'use strict';return ( "+a+" )}")).call(r);r.ba=void 0;r.Aa=void 0;return a}function k(a,b,c,d){try{return e(a,b,c)}catch(U){return h({cmd:"u_badfilter",filter:d||""}),U.message&&console.log("Invalid filter expression: "+
U),!1}}String.prototype.bmatch=function(a){return!!this.match(a)};String.prototype.is=function(a){return(new RegExp("^("+a+")$")).test(this)};String.prototype.has=function(a){return(new RegExp(a)).test(this)};String.prototype.beginwith=function(a){return(new RegExp("^("+a+")")).test(this)};String.prototype.endwith=function(a){return(new RegExp("("+a+")$")).test(this)};Date.prototype.is=function(a){var b=z[a],c=z[a+"_"];if(null!=b&&null!=c)return"function"==typeof b&&(b=b()),"function"==typeof c&&
(c=c()),this.getTime()>=b&&this.getTime()<=c;if(c=a.match(/(\d+)_([a-z]+)_ago/)){var d=parseInt(c[1]);if(isNaN(d)||0>=d)throw"bad number in: "+a;b=z[c[2]+"_ago"];c=z[c[2]+"_ago_"];if(b&&c)return b=b(d),c=c(d),this.getTime()>=b&&this.getTime()<=c}throw"fail to parse: "+a;};Date.prototype.btwn=function(a,b){"string"==typeof a&&(a=Date.parse(a));"string"==typeof b&&(b=Date.parse(b));return this.getTime()>a&&this.getTime()<b};Date.prototype._btwn=function(a,b){"string"==typeof a&&(a=Date.parse(a));"string"==
typeof b&&(b=Date.parse(b));return this.getTime()>=a&&this.getTime()<b};Date.prototype.btwn_=function(a,b){"string"==typeof a&&(a=Date.parse(a));"string"==typeof b&&(b=Date.parse(b));return this.getTime()>a&&this.getTime()<=b};Date.prototype._btwn_=function(a,b){"string"==typeof a&&(a=Date.parse(a));"string"==typeof b&&(b=Date.parse(b));return this.getTime()>=a&&this.getTime()<=b};Date.prototype.b4=function(a){"string"==typeof a&&(a=Date.parse(a));return this.getTime()<a};Date.prototype.b4_=function(a){"string"==
typeof a&&(a=Date.parse(a));return this.getTime()<=a};Date.prototype.aft=function(a){"string"==typeof a&&(a=Date.parse(a));return this.getTime()>a};Date.prototype.aft_=function(a){"string"==typeof a&&(a=Date.parse(a));return this.getTime()>=a};var g=0,d=0,m=0,v=0,x=0,w=0,z={mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:0,download:y,inqueue:C,paused:D,finished:H,interrupted:J,now:function(){return v},today:function(){return x},today_:function(){return w},yesterday:function(){return x-864E5},yesterday_:function(){return x-
1},this_week:function(){return x-864E5*g},this_week_:function(){return z.this_week()+6048E5-1},last_week:function(){return z.this_week()-6048E5},last_week_:function(){return z.this_week()-1},this_month:function(){var a=new Date(x);a.setDate(1);return a.getTime()},this_month_:function(){var a=new Date(x);a.setMonth(d+1);a.setDate(1);return a.getTime()-1},last_month:function(){var a=new Date(x);a.setMonth(d-1);a.setDate(1);return a.getTime()},last_month_:function(){return z.this_month()-1},this_year:function(){var a=
new Date(x);a.setMonth(0);a.setDate(1);return a.getTime()},this_year_:function(){var a=new Date(x);a.setYear(m+1);a.setMonth(0);a.setDate(1);return a.getTime()-1},last_year:function(){var a=new Date(x);a.setYear(m-1);a.setMonth(0);a.setDate(1);return a.getTime()},last_year_:function(){return z.this_year()-1},days_ago:function(a){return x-864E5*a},days_ago_:function(a){return x-864E5*(a-1)-1},weeks_ago:function(a){return z.this_week()-6048E5*a},weeks_ago_:function(a){return z.this_week()-6048E5*(a-
1)-1},months_ago:function(a){var b=new Date(z.this_month());b.setMonth(d-a);return b.getTime()},months_ago_:function(a){return z.months_ago(a-1)-1},years_ago:function(a){var b=new Date(z.this_year());b.setFullYear(m-a);return b.getTime()},years_ago_:function(a){return z.years_ago(a-1)-1}};a();var B="true",u,q={},r={},ba;for(ba in this)r[ba]=void 0;r.eval=void 0;r.uneval=void 0;r.Function=void 0;r.Genertor=void 0;r.GenertorFunction=void 0;r.Promise=void 0;r.Object=void 0;r.String=String;r.Date=Date;
r.Fd=function(a){if(1==this.Aa){var b=this.ba,c=l(b),d;c.file&&""!=c.file&&(d=n(c.file));var e=null;switch(a){case "host":e=c.host;break;case "query":case "anchor":e=c[a];break;case "subdirs":e=c.directory;break;case "name":e=d?d.P:"";break;case "ext":e=d?d.w:"";break;case "url":e=b}a=e||""}else a=this.ba.cb(a);return a};r.yearof=function(a){return(new Date(a)).getFullYear()};r.monthof=function(a){return(new Date(a)).getMonth()};r.dateof=function(a){return(new Date(a)).getDate()};r.dayof=function(a){return(new Date(a)).getDay()};
r.hourof=function(a){return(new Date(a)).getHours()};r.minuteof=function(a){return(new Date(a)).getMinutes()};r.secondof=function(a){return(new Date(a)).getSeconds()};r.kb=function(a){return a<<10};r.mb=function(a){return a<<20};r.gb=function(a){return a<<30};r.sec=function(a){return 1E3*a};r.min=function(a){return 6E4*a};r.hr=function(a){return 36E5*a};r.hour=function(a){return 36E5*a};return{Xa:function(){return B},Ra:function(a){return k(B,a,void 0,u)},Pb:function(a,c,d){d=b(c,d);return k(d,a,
!1,c)},Qa:function(a,c){B=b(a,c)||"";u=a},compile:b,Qb:e}}();Y.compileCache=Y.Qa;Y.compiledTest=Y.Ra;Y.getCompiledFilter=Y.Xa;window.dy_taskfilter=Y;chrome.notifications.onClicked.addListener(function(a){if(-1!=a.indexOf("task_")||-1!=a.indexOf("terr_")||-1!=a.indexOf("tfin_")){var c=N.get("click_notify");c==Ga?(Q.h({c:!0},function(){h({cmd:"u_scroll",id:a.substring(5)})}),chrome.notifications.clear(a,function(){})):c==Ha?chrome.notifications.clear(a,function(){}):eb()}else-1!=a.indexOf("tip_")?(N.set(a,100),chrome.notifications.clear(a,function(){})):-1!=a.indexOf("int_")&&(chrome.notifications.clear(a,function(){}),Q.h({c:!0}))});
chrome.notifications.onButtonClicked.addListener(function(a,c){if("reload_update"==a){if(0==c){chrome.runtime.reload();return}}else if(-1!=a.indexOf("task_")||-1!=a.indexOf("terr_"))Q.h({c:!0},function(){h({cmd:"u_scroll",id:a.substring(5)})});else if(-1!=a.indexOf("tfin_")){var b=S.fa(a.substring(5));0==c?X.exec(b):1==c&&X.ka(b)}else-1!=a.indexOf("tip_")&&(N.set(a,100),1==c&&(b=N.aa(a))&&(b.set_section?Q.R({V:b.set_section}):b.set_page&&chrome.tabs.create({url:b.set_page})));chrome.notifications.clear(a,
function(){})});function fb(a){if(!localStorage["noup_"+a]){var c={type:"basic",title:f("msgTitleUpdateAvail",[a]),priority:2,message:f("msgTextUpdateAvail"),iconUrl:"../icons/noty/update.png",buttons:[{title:f("btnUpdateReload")},{title:f("btnLater")}]};chrome.notifications.create("reload_update",c,function(){});localStorage["noup_"+a]=1}}
function gb(){var a=N.aa("tip_notifications");if(a&&a.message&&!(a.value>=a.freq)&&!a.Kb&&(N.ua("tip_notifications"),!a.freq||a.value==a.freq)){N.set("tip_notifications",0);var c={type:"basic",title:f("titleTips"),priority:1,message:a.message,iconUrl:"../icons/logo/48.png",buttons:[{title:f("btnGotIt"),iconUrl:"../icons/tick.png"}]};(a.set_section||a.set_page)&&c.buttons.push({title:f("btnTakeMeThere"),iconUrl:"../icons/noty/gear.png"});chrome.notifications.create("tip_notifications",c,function(){});
a.Kb=!0}}
function hb(a,c){if(a&&a.state!=H&&a.state!=J){var b={type:"basic",title:a.D(),message:c?f("msgTaskAddPaused"):f("msgTaskStart"),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",buttons:[{title:f("btnOpenManager"),
iconUrl:"../icons/noty/table.png"}]};chrome.notifications.create("task_"+a.id,b,function(){});setTimeout(function(){gb()},0)}}
function ib(a){if(a&&a.state==y){var c=function(a){if(0>=a.size)return 0<a.finished_bytes?va(a.finished_bytes):f("phraseUnknownSize");var b=va(a.size);return a.state==H||a.state==J?b:f("statusDownloadedSize",[va(a.finished_bytes),b])}(a),b=wa(a.speed),e=ua(a.time_remained),k=c+"\n"+b+" - "+f("statusTimeLeft",[e]);chrome.notifications.update("task_"+a.id,{progress:Math.round(a.progress),message:k},function(b){chrome.runtime.lastError&&console.log(chrome.runtime.lastError);b||(b=function(){a.state==
y&&chrome.notifications.create("task_"+a.id,{type:"progress",priority:2,title:a.D(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
buttons:[{title:f("btnOpenManager"),iconUrl:"../icons/noty/table.png"}],progress:Math.round(a.progress),message:k},function(){})},-1<navigator.platform.indexOf("Mac")?chrome.notifications.clear("task_"+a.id,b):b())})}}
function jb(a){if(a)if(N.get("notify_finish")){var c=/^(jpe?g|gif|png|bmp|ico|webp|svg)$/i,b={type:"basic",title:a.D(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",message:f("msgTaskFinish"),
buttons:[{title:f("optOptionOpenFile"),iconUrl:"../icons/noty/file.png"},{title:f("optOptionOpenFolder"),iconUrl:"../icons/noty/folder_open.png"}]},e="";if(S.O&&a.full_path){var k=n(a.sa());k.w&&c.test(k.w)&&(e="file:///"+a.full_path)}e&&(N.get("notify_large_preview")?(b.type="image",b.imageUrl=e):(b.iconUrl=e,a.Ga=!0));chrome.notifications.create("tfin_"+a.id,b,function(){kb(a)});setTimeout(function(){gb()},0)}else kb(a)}
function lb(a){if(a)if(N.get("notify_error")){var c={type:"basic",title:a.D(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
message:f("msgTaskInterrupt"),buttons:[{title:f("btnOpenManager"),iconUrl:"../icons/noty/table.png"}]};a.error_str&&(c.contextMessage=Ra(a.error_str));chrome.notifications.create("terr_"+a.id,c,function(){kb(a)});setTimeout(function(){gb()},0)}else kb(a)}function mb(a,c){chrome.notifications.update("task_"+a.id,{title:c},function(){});chrome.notifications.update("tfin_"+a.id,{title:c},function(){});chrome.notifications.update("terr_"+a.id,{title:c},function(){})}
function nb(a,c){chrome.notifications.update("task_"+a.id,{iconUrl:c},function(){});a.Ga||chrome.notifications.update("tfin_"+a.id,{iconUrl:c},function(){});chrome.notifications.update("terr_"+a.id,{iconUrl:c},function(){})}function ob(a){(N.get("notify_oneclick")||N.get("notify_progress"))&&chrome.notifications.clear("task_"+a,function(){});N.get("notify_finish")&&chrome.notifications.clear("tfin_"+a,function(){});N.get("notify_error")&&chrome.notifications.clear("terr_"+a,function(){})}
function pb(a){ob(a.id)}function kb(a){chrome.notifications.clear("task_"+a.id,function(){})}function Za(a){chrome.notifications.getAll(function(c){for(var b in c)-1!=b.indexOf(a)&&chrome.notifications.clear(b,function(){})})}function eb(){chrome.notifications.getAll(function(a){for(var c in a)chrome.notifications.clear(c,function(){})})};var qb=function(){function a(a){if(-1!=a.tabId){var e=-1,g="",d="";if(a.responseHeaders)for(var m=0;m<a.responseHeaders.length;++m){var v=a.responseHeaders[m];if("content-type"==v.name.toLowerCase())g=(v.value||"").trim();else if("content-length"==v.name.toLowerCase()){if(e=parseInt(v.value),isNaN(e)||!isFinite(e))e=-1}else"content-disposition"==v.name.toLowerCase()&&(d=(d=v.value)?(d=d.match(/filename=\"([^\"]+)\"/i))?d[1]||"":"":"")}m=n(d).w||n(l(a.url).file).w;if(g&&b.test(g)||m&&c.test(m))m||
(g=g.match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&g[1]&&(m=la[g[1]]||g[1]),e={cmd:"stream_url",url:a.url,size:e,need_send:a.tabId==S.Ca},d&&(e.desc=d),m&&(e.fext=m),chrome.tabs.sendMessage(a.tabId,e)}}var c=new RegExp("^(("+V.wa+")|("+V.xa+")|("+V.va+"))$","i"),b=/(^(image|audio|video))|(application\/vnd.rn-realmedia)/i;return{start:function(){if(!chrome.webRequest.onHeadersReceived.hasListener(a))try{chrome.webRequest.onHeadersReceived.addListener(a,{urls:["http://*/*","https://*/*"],types:"main_frame sub_frame stylesheet script image font object xmlhttprequest ping csp_report media websocket other".split(" ")},
["responseHeaders"])}catch(e){console.log("Failed to add listener"),console.log(e)}},stop:function(){chrome.webRequest.onHeadersReceived.removeListener(a)}}}();var X={Ba:0,i:function(){rb=Date.now()/1E3;var a=1==X.i.N%10;1E4<=X.i.N++&&(X.i.N=0);X.ub(function(c,b,e){X.Ba=c;c=[];for(b=0;b<e.length;++b){var k=e[b];c.push(k.id);k._start_time||(k._start_time=rb);k.time_elapsed+=rb-k._start_time;k._start_time=rb;0<k.size&&(k.progress=k.finished_bytes/k.size*100,k.progress=Math.min(100,k.progress),isFinite(k.progress)||console.log("f: "+k.finished_bytes+" sz: "+k.size));k._cf={}}S.B({cmd:"u_prog",ids:c});if(N.get("notify_progress")&&!S.T&&!S.F)for(b=0;b<e.length;++b)ib(e[b]);
if(a)for(b=0;b<e.length;++b)S.g.set(e[b].id)})}};X.i.N=1;
var T=function(){function a(){for(var a=0,b=S.a.length;a<b;++a){var c=S.a[a];if(c&&0==c.recycled&&c.state==C&&!c.L)return c}return null}function c(){if(!b){S.u(!1);var g=a();g&&(b=!0,X.fb(g,function(a){S.u(a!=xa);if(a==ya)b=!1;else{if(a==xa){delete e[g.id];if(!X.download(g)){b=!1;return}g.L&&(delete g.L,delete k[g.id])}else a==za&&(g.L=!0,k[g.id]=g);b=!1;setTimeout(c,0)}}))}}var b=!1,e={},k={};return{vb:function(){return Object.keys(e).length},enqueue:function(a){e[a.id]=!0},Ta:function(a){delete e[a.id]},
U:function(){for(var a in k)delete k[a].L;k={};c()},K:c}}();window.dy_engine=X;X.pollProgress=X.i;X.getOverallSpeed=function(){return X.Ba};X.version=1;X.nb=!1;
(function(){function a(a,b){var d=c(a),I=c(b);return d==I}function c(a){a=/^(https?|ftp|data):/i.test(a)?a:"http://"+a;return"/"==a[a.length-1]?a:a+"/"}function b(a){a._start_time=Date.now()/1E3;S.j(a,"state",y);G.add(a);X.i.Y||(X.i.Y=setInterval(X.i,1E3),X.i())}function e(a,b){G.remove(a);0==G.length()&&(clearInterval(X.i.Y),X.i.Y=void 0);delete a.G;a._start_time&&(a.time_elapsed+=Math.max(0,Date.now()/1E3-a._start_time));delete a._start_time;a.active_threads=0;0!=b?chrome.downloads.search({id:a.cr_id},function(b){b&&
b.length&&(a.finished_bytes=b[0].bytesReceived);a.state==H?(a.size=a.finished_bytes,a.progress=100):a.progress=0<a.size?a.finished_bytes/a.size*100:0;S.A(a,["progress","size","time_elapsed"])}):S.A(a,["time_elapsed"])}function k(a,b,c){g(b,a.id);a.cr_id=b;P[b]=a;if(0!=c)for(b=R.find(a.url);b;)a.eurl=b,b=R.find(b);S.g.set(a.id)}function g(a,b){var c=P[a];c&&c.id!=b&&d(c,a)}function d(a,b){a.cr_id=-2;S.g.set(a.id);delete P[b]}function m(a){R.map[c(a.url)]=a.redirectUrl}function v(a){-1!=S.m||S.T?h({cmd:"u_accept",
crid:a}):Q.h({c:!0},function(){h({cmd:"u_accept",crid:a})})}function x(a){var b=P[a];b&&(d(b,a),G.remove(b),console.log("onerased"))}function w(a){var c=P[a.id];if(c){var d=!1;a.exists&&!a.exists.current&&(d=!0);var e=!1,t=[],F;for(F in a){var E=a[F].current,I;switch(F){case "url":c.eurl=E;I="eurl";break;case "filename":E=A(c,E,!1);(I=a.danger?a.danger.current:"")&&!E&&"safe"!=I&&"accepted"!=I&&v(a.id);I="naming";break;case "mime":c.mime_type=E;break;case "exists":c.exists=E;I="exists";break;case "endTime":c.time_finish=
new Date(E);I="time_finish";break;case "state":if(!d){if("interrupted"==E)E=J;else if("complete"==E)E=H;else break;O(c,E)}break;case "error":c.error_str=E;break;case "paused":if(d||a.state)break;1==E?E=D:(E=y,c.state!=y&&b(c));O(c,E);break;case "totalBytes":Wa(E);case "fileSize":c.size=E;I="size";break;case "danger":a.filename||"safe"==E||"accepted"==E||v(a.id)}e||("_all_"==I?e=!0:I&&t.push(I))}e?(S.g.set(c.id),c._cf={},S.B({cmd:"u_tasks",ids:[c.id]})):0<t.length&&S.A(c,t)}}function z(){var a=N.get("fnconflict");
if(0>a||5<=a)a=0;return aa[a]}function B(a,b){var c=cb.ab(a.id)||P[a.id];if(c){var d=a.filename;c.file_ext=d;var t=V.Sa();c.naming||(t=V.match(c));c.naming||(c.naming=t.naming);c.folder||(c.folder=t.folder);var t=c.Ea(),F="";ta(t)?F=t:(c.naming=d,console.log("naming mask not good, changing to provided:"+d));c.M=c.o=void 0;S.A(c,["naming"]);(c=F)?b({filename:c,conflictAction:z()}):b()}else console.log("Task not found, wtf!! a canceled topause tasks?")}function u(a){function c(a){X.erase(a,!0);a.reset(y);
S.g.set(a.id);q(a);S.B({cmd:"u_tasks",ids:[a.id]})}function d(a){if(0>=a.size)c(a);else{var b=f("confirmCantResumeRestart",[a.D()]);h({cmd:"u_confirm",data:b},function(d){void 0==d&&(d=confirm(b));d?c(a):O(a,J)})}}b(a);void 0==a.cr_id||0>a.cr_id?d(a):chrome.downloads.search({id:a.cr_id},function(b){b&&b.length&&(b[0].canResume||"in_progress"==b[0].state&&!b[0].paused)?chrome.downloads.resume(a.cr_id,function(){}):d(a)})}function q(a){if(0<=a.cr_id)console.log("dy_engine.newDownload: call restart/resume instead");
else{delete a.G;b(a);for(var c=0;c<K.length;++c)if(K[c].id==a.id&&K[c].url==a.url){console.log("duplicate issue!!");return}chrome.downloads.download({url:a.url,method:"GET",saveAs:!1,conflictAction:z()},function(b){if(void 0==b){for(b=0;b<K.length;++b)if(K[b].id==a.id){K.splice(b,1);break}a.cr_id=-2;chrome.runtime.lastError&&chrome.runtime.lastError.message&&(a.error_str=chrome.runtime.lastError.message);G.has(a.id)&&O(a,J);console.log("fail to start download, "+JSON.stringify(chrome.runtime.lastError))}});
K.push(a)}}function r(a,b){void 0==a||0>a?b&&b():chrome.downloads.search({id:a},function(c){c&&c.length&&"complete"==c[0].state&&c[0].exists&&chrome.downloads.removeFile(a,function(){});b&&b()})}function ba(a,b){if(!a)return b&&b(!1,f("errorFileNotExist")),!1;if(!(0<=a.cr_id))return b&&b(!1,f("errorRemovedFromChrome")),!1;chrome.downloads.search({id:a.cr_id},function(c){var d=!0,t="";c&&c.length?(a.exists!=c[0].exists&&S.j(a,"exists",c[0].exists),a.exists||(d=!1,t=f("errorFileNotExist"))):0<a.time_elapsed&&
(d=!1,t=f("errorRemovedFromChrome"));b&&b(d,t)});return!0}function A(a,b,c){var d=!1;if(!a||void 0==a.cr_id||0>a.cr_id)return d;a.full_path=b;var t=a.Ea().replace(/^.*(\\|\/|\:)/,"");if(b=b.replace(/^.*(\\|\/|\:)/,"")){if(t!=b){var F=N.get("fnconflict");if(F==Ka||F==Ja){var e=n(t).P||"",g=n(b).P||"";g.length>e.length&&0==g.indexOf(e)&&(F==Ka?(S.Da(a,!0,"bg"),console.log("file name conflicts: "+t+", removing the task"),h({cmd:"u_skipcancel",filename:t})):F==Ja&&(X.erase(a,!0,!0),a.reset(),a.error_str=
"fnConflict",O(a,J),console.log("file name conflicts: "+t+", pausing the task")),d=!0)}d||(a.name_conflict=b,a.M=a.o=void 0,0!=c&&S.A(a,["naming"]),mb(a,b))}Va("dz","fex",n(b).w||"_undefined_")}d||(chrome.downloads.getFileIcon(a.cr_id,{size:16},function(b){S.j(a,"iconURL16",b)}),chrome.downloads.getFileIcon(a.cr_id,{size:32},function(b){S.j(a,"iconURL32",b);nb(a,b)}));a._cf={};S.g.set(a.id);return d}function O(a,b){if(a){var c=a.state;a.state=b;b!=y&&(e(a),T.U(),b==H?c!=b&&(jb(a),N.get("sound_finish")&&
(c=new Audio("../snds/finish.ogg"),c.play())):b==J?c!=b&&(lb(a),N.get("sound_error")&&(c=new Audio("../snds/error.ogg"),c.play())):N.get("notify_progress")&&kb(a));S.A(a,["state"])}}var P={};X.Jb=function(){for(var a=0;a<S.a.length;++a){var b=S.a[a].cr_id;0<=b&&(P[b]=S.a[a])}chrome.downloads.onChanged.addListener(w);chrome.downloads.onErased.addListener(x);chrome.downloads.onDeterminingFilename.addListener(B);chrome.webRequest.onBeforeRedirect.addListener(m,{urls:["http://*/*","https://*/*"]});return!0};
var G={},U={},Z={};G.Va=function(a){return Z[a]};G.add=function(a){if(a&&a.url){U[a.id]=!0;var b=l(a.url).authority;void 0==Z[b]&&(Z[b]={});Z[b][a.id]=!0;S.u(-1)}};G.remove=function(a){if(a){delete U[a.id];var b=l(a.url).authority,c=Z[b];c&&(delete c[a.id],Object.keys(c).length||delete Z[b]);S.u(-1)}};G.has=function(a){return 1==U[a]};G.length=function(){return Object.keys(U).length};var R={map:{}};R.Zb=setInterval(function(){R.map={}},3E5);R.find=function(a){if(0!=a.indexOf("data:")){a=c(a);var b=
R.map[a];return b?(delete R.map[a],b):null}};X.za=function(){return G.length()};X.eb=function(b){g(b.id);for(var c=null,d=b.url,e=0;e<K.length;++e)if(a(K[e].url,d)){c=K[e];K.splice(e,1);break}if(!c)return!1;if(c.G)return delete c.G,chrome.downloads.cancel(b.id,function(){chrome.downloads.erase({id:b.id},function(){O(c,D)})}),console.log("ignore a _topause/erased task, cr_id:"+b.id),!0;k(c,b.id);b.referrer&&(c.referer=b.referrer);c.mime_type=b.mime;c.exists=b.exists;S.j(c,"size",b.totalBytes);Wa(c.size);
return!0};X.ga=function(a,c,d,e){k(a,c,!e);e||S.ha(a,!1);a.state==y&&b(a);var t=!1;e?(a.full_path=d,S.g.set(a.id)):t=d?A(a,d):!1;a.W&&(t||setTimeout(function(){v(c)},0),delete a.W);0<a.size&&Wa(a.size)};var aa=["uniquify","overwrite","prompt","uniquify","uniquify"];X.download=function(a){if(!a)return!1;void 0==a.cr_id||0>a.cr_id?q(a):u(a);return!0};X.pause=function(a){void 0==a.cr_id||0>a.cr_id?a.G=!0:chrome.downloads.pause(a.cr_id,function(){})};var K=[];X.erase=function(a,b,c,g){e(a,!1);a.G=!0;
var t=a.cr_id;void 0==t||0>t||(d(a,t),0!=g&&(b?a.state==H?1!=c?r(t,function(){chrome.downloads.erase({id:t},function(){})}):chrome.downloads.erase({id:t},function(){}):chrome.downloads.cancel(t,function(){chrome.downloads.erase({id:t},function(){})}):chrome.downloads.erase({id:t},function(){})))};X.hb=function(){var a=N.get("dy_max_con_tasks");return G.length()<a};X.fb=function(a,b){var c=N.get("dy_max_con_tasks");if(G.length()>=c)b(ya);else{var d=l(a.url).authority;chrome.downloads.search({state:"in_progress",
urlRegex:"^((https?|ftp)://)?"+d+".*"},function(c){var t=N.get("dy_max_con_tasks");if(G.length()>=t)b(ya);else{var t=N.get("dy_max_per_server"),e=!1,g=G.Va(d),k=g?Object.keys(g):[],g={};if(k&&k.length)for(var L=0;L<k.length;++L)g[k[L]]=!0;k=Object.keys(g).length;if(c&&c.length)for(var m=-10,L=0;L<c.length;++L){var q=P[c[L].id],q=q?q.id:m--;g[q]=!0}if(Object.keys(g).length<t||k<t&&1==g[a.id])e=!0;b(e?xa:za)}})}};X.ka=function(a,b){ba(a,b)&&(chrome.downloads.show(a.cr_id),chrome.runtime.lastError&&
console.log("show lastError: "+JSON.stringify(chrome.runtime.lastError)))};X.exec=function(a,b){ba(a,b)&&(chrome.downloads.open(a.cr_id),chrome.runtime.lastError&&console.log("open lastError: "+JSON.stringify(chrome.runtime.lastError)))};X.ub=function(a){chrome.downloads.search({state:"in_progress",paused:!1},function(b){var c=0,d=b.length,t=[];if(b.length){for(var e=b.length,e=10<e?10:5<e?5:3,E=X.i.N%e,g=0;g<b.length;++g){var k=b[g],L=k.id,m=k.bytesReceived,q=k.totalBytes-m,r=.001*(new Date(k.estimatedEndTime)).getTime(),
u=r-rb,v=0;0<q&&0<u&&(v=q/u,c+=v);L%e==E&&(L=P[L])&&(L.speed=v,L.finished_bytes=m,L.time_remained=void 0==k.estimatedEndTime?8553600:r-rb,t.push(L))}a(c,d,t)}else a(c,d,[])})};X.$b=function(){};X.dc=function(a){a(1)};X.Yb=function(){}})();X.numDownloading=X.za;X.exec=X.exec;X.explore=X.ka;X.erase=X.erase;X.pause=X.pause;X.isNative=function(){return X.nb};var db=function(){function a(a){switch(a.cmd){case "open_ui":Q.h();break;case "open_options":case "open_set":Q.R({})}}function c(a,c,k){function b(a,b){a.url=a.url.replace(/ /g,"%20");var c=a.url,c=c||"",d=0==c.indexOf("data:"),e=c.indexOf("\r");-1==e&&(e=c.indexOf("\n"));-1!=e?c=c.substr(0,d?Math.min(e,1024):e):d&&1024<c.length&&(c=c.substr(0,1024));if(d?!ja.test(c):!ka.test(c))return console.log("bad url in new_task()"),console.log(a.url),null;0==/^(https?|ftp|data):/i.test(a.url)&&(a.url="http://"+
a.url);c=S.Z(a.url,a.referer);if(!c)return-1;c.naming=a.naming;c.text=a.text||"";c.title=a.title||"";c.desc=a.desc;c.page_title=b;c.max_threads_config=5;c.naming&&bb.Tb(c.naming);return c}switch(a.cmd){case "open_ui":Q.h({c:a.activate,l:a.tabId});k("y");break;case "open_options":Q.R({V:a.section,C:a.uiWinId,J:a.pos});break;case "clear_noty":a.tid?ob(a.tid):a.type&&Za(a.type);break;case "reschedule":T.U();break;case "blog":console.log(a.data);break;case "browse":return!0;case "path_list":k({list:ab.ta()});
break;case "naming_list":k({list:bb.ta()});break;case "dlg_options":k({fontSize:N.get("font_size"),taskDef:N.H()});break;case "new_task":if(a.tasks){for(var d=c=!1,e=a.add_paused,v=a.addtop,x=a.page_title,w=S.a.length+10,z=a.notify&&N.get("notify_oneclick"),B=0,u=a.tasks.length;B<u;++B){var q=b(a.tasks[B],x);if(-1==q){c=!0;break}else if(null!=q){e||(q.state=C,T.enqueue(q),d=!0);var r=S.ea(q,v);r<w&&(w=r);z&&hb(q,e)}}Va("fe_us","dl_src",a.source||"unkown",a.tasks.length||1);w<S.a.length&&(h({cmd:"u_new",
idx:w,addtop:v,scroll_id:S.a[v?0:S.a.length-1].id}),S.Ka(),d&&T.K());c&&Q.h({c:!0},function(){h({cmd:"u_alert",data:Qa.noID})})}k("y");break;case "url_desc":cb.Gb(a.url,a.download,a.text,a.title,a.page_title||(c.tab?c.tab.title:""));break;case "poll_progress":X.i();break;case "import":if("chrome"==a.src)return S.ib(k),!0}}return{oa:function(){return a},$:function(){return c}}}();var rb=Date.now()/1E3,S={Wb:window.location.href,m:-1,Ca:-1,T:!1};
(function(){function a(a){for(var b=S.a.length,c=0;c<b;++c)if(S.a[c].id==a)return c;return-1}function c(){h({cmd:"u_updated",data:O})}function b(a,b){return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}function e(a){a=a.split(".");for(var b=Array(3),c=0;c<a.length&&3>c;++c){var d=parseInt(a[c]);if(isNaN(d)||!isFinite(d))d=0;b[c]=d}for(;3>c;++c)b[c]=0;return b}function k(a){a=e(a);if(0>b(a,[0,7,3]))for(var c in N.items)if(!c.indexOf("tip_")&&"tip_rateshare"!=c&&"tip_translate"!=c){var d=N.items[c];0<d.value&&(d.value=
100,localStorage["#"+c]=d.value)}0>b(a,[0,10,0])&&N.set("tip_translate",0);console.log("onVerUpdated process")}function g(){function a(a,b){var c=Math.floor(1E3*Math.random())<b?b:0;if(c){var d=Ta(a);if(d){var e=d._t;if(e&&(e=Math.round(Math.max(0,(Date.now()-e)/864E5-.1999)),!(1>e))){var c="pus"+c+"_"+a+"_ag_1",t;for(t in d)if("_t"!=t){var F=Math.round(d[t]/e);if(isNaN(F)||!isFinite(F))F=0;var g=t.split(";");fa(c,g[0],g[1],F,!0)}ha.removeItem(Sa+a)}}}}(function(){var a=Date.now(),b=N.get("_glst");
if(!b)N.set("_glst",a);else if(!(1>Math.round(Math.max(0,(a-b)/864E5-.1999)))&&(b=10>Math.floor(1E3*Math.random())?10:0)){var b="pus"+b+"_ss",c=["ui_mode",1==N.get("ui_grid_list")?"list":"table"],d;d=N.get("bg_image_enable")?(d=N.get("bg_image_url"))?"#"==d[0]?"color":d.startsWith("../")||d.startsWith("chrome-extension://")?"builtin":"url":"unknown":"disabled";ga(b,[c,["bg_theme",d],["search_mode",""+N.get("search_mode")],["fnconflict",""+N.get("fnconflict")],["override_cr",""+N.get("override_cr")],
["dbclick_action",""+N.get("dbclick_action")],["oneclick_enabled",""+N.get("doneclick_rule")],["slide_details_panel",""+N.get("slide_details_panel")],["pop_ing_first",""+N.get("poplist_showd_first")],["custom_naming",""+("*name*.*ext*"!=N.get("def_naming"))],["match_mode",""+N.get("match_mode")],["autoclear",0<N.get("autoclear_timer")?N.get("autoclear_type"):"disabled"],["task_n",void 0,S.a.length],["pop_max_items",void 0,N.get("poplist_max_items")],["max_con_tasks",void 0,N.get("dy_max_con_tasks")],
["max_per_server",void 0,N.get("dy_max_per_server")],["file_access",""+S.O]]);N.set("_glst",a)}})();a("fe_us",10);a("dz",5);a("sf",5)}function d(){var a=/((ftp)|(https?)):\/\/.+/;chrome.windows.getAll({populate:!0},function(b){var c,d;c=["cs/sniffer.js","cs/main.js"];d=[!0,!1];for(var e=0;e<b.length;e++)for(var t=b[e].tabs,F=0;F<t.length;F++)if(a.test(t[F].url))for(var g=0;g<c.length;++g)chrome.tabs.executeScript(t[F].id,{file:c[g],allFrames:d[g]},function(){chrome.runtime.lastError&&console.log(chrome.runtime.lastError)})})}
function m(){N.load();ab.load([N.get("def_folder")]);var a=["*page_title*.*ext*","*title*.*ext*","*text*.*ext*","*name*.*ext*"];a.push(N.get("def_naming"));bb.load(a);r&&k(r);chrome.downloads.setShelfEnabled(0==N.get("hide_cr_bar"));cb.start();qb.start();N.get("override_cr")&&Q.da(!0);chrome.tabs.onActivated.addListener(function(a){chrome.tabs.get(a.tabId,function(a){S.F=a&&0==a.url.indexOf(Q.jb);S.F&&N.get("notify_progress")&&Za("task_")})});chrome.windows.onFocusChanged.addListener(function(a){-1!=
S.m?chrome.tabs.get(S.m,function(b){chrome.runtime.lastError?S.F=!1:(S.F=b&&b.windowId==a&&b.active,S.F&&N.get("notify_progress")&&Za("task_"))}):S.F=!1});1==N.get("pop_content")?(chrome.browserAction.setPopup({popup:"pop/sniffer.htm"}),chrome.browserAction.setTitle({title:f("tipBrowserAction")})):(chrome.browserAction.setPopup({popup:"pop/pop.htm"}),chrome.browserAction.setTitle({title:f("extName")}));Ya.Ha();chrome.runtime.onMessage.addListener(db.$());chrome.runtime.onMessageExternal.addListener(db.oa());
W.Mb();ba&&Q.h({c:!0},function(){c();A=!0});chrome.webRequest.onBeforeRequest.addListener(function(){return{cancel:!0}},{urls:[S.Wb+"*"]},["blocking"]);d();setTimeout(function(){chrome.runtime.requestUpdateCheck(function(){})},3E4);setInterval(function(){chrome.runtime.requestUpdateCheck(function(){})},18E6);T.K();(function(){for(var a=[],b=V.ra(),c=0;c<b.length;++c)if(b[c].as_filter){var d=Y.compile(b[c].condition);d&&(a.push(b[c].condition),a.push(d))}ea.add(function(a,b){a._cf||(a._cf={});for(var c=
0;c<b.length;c+=2)if(void 0==a._cf[b[c]])try{a._cf[b[c]]=Y.Qb(b[c+1],a)}catch(sb){console.log("Invalid filter expression: "+sb)}},S.a,200,!1,0,a)})();chrome.alarms.clear("auto-clear-tasks",function(){var a=N.get("autoclear_type"),b=N.get("autoclear_timer");u(a,b)&&(a=N.get("autoclear_lasttime"),-1==a&&(a=Date.now(),N.set("autoclear_lasttime",a)),a=b-Math.max(0,Date.now()-a)/6E4,a=Math.max(1,Math.ceil(a)),chrome.alarms.create("auto-clear-tasks",{delayInMinutes:a,periodInMinutes:b}),console.log("auto_clear will run in "+
a+" mins"))});console.log("done");S.isInited=!0}function v(a){h({cmd:"u_hi"},function(b){"hi"==b?(console.log("ui connected"),a&&a()):(console.log("connecting to ui, try again"),v(a))})}function x(a){if(!a.filename)return null;var b=S.Z(a.url,a.referrer);if(!b)return-1;var c=a.filename.replace(/^.*(\\|\/|\:)/,"");b.full_path=a.filename;b.naming="*name*.*ext*";b.file_ext=c;b.finished_bytes=a.bytesReceived;b.size=a.fileSize||a.totalBytes;b.exists=a.exists;b.gc=a.mime;b.time_add=new Date(a.startTime);
a.endTime&&(b.time_finish=new Date(a.endTime),b.time_elapsed=(b.time_finish-b.time_add)/1E3);a.error&&(b.error_str=a.error);b.state=D;"in_progress"==a.state?a.paused||(b.state=y):"complete"==a.state?b.state=H:"interrupted"==a.state&&(b.state=J);b.state==H?(b.size=b.finished_bytes,b.progress=100):b.progress=0<b.size?b.finished_bytes/b.size*100:0;"safe"!=a.danger&&"accepted"!=a.danger&&(b.W=!0);return b}function w(){R=!0;S.B=function(){}}function z(){S.B=h;R=!1}function B(){I+=1/36;aa.save();aa.clearRect(0,
0,19,19);aa.translate(Math.ceil(9.5),Math.ceil(9.5));aa.rotate((1-Math.sin(Math.PI/2+I*Math.PI))/2*Math.PI*2);aa.drawImage(K,-Math.ceil(9.5),-Math.ceil(9.5));aa.restore();chrome.browserAction.setIcon({imageData:aa.getImageData(0,0,19,19)});1>=I?setTimeout(B,10):(I=0,chrome.browserAction.setIcon({path:"../icons/logo/19.png"}))}function u(a,b){ma=void 0;da&&(clearTimeout(da),da=void 0);if(0>b)return!1;var c=6E4*b;switch(a){case "finished":cmp_func=function(a){return a.state==H&&Date.now()-a.time_add>
c};break;case "interrupted":cmp_func=function(a){return a.state==J&&Date.now()-a.time_add>c};break;case "both":cmp_func=function(a){return(a.state==H||a.state==J)&&Date.now()-a.time_add>c};break;default:return!1}console.log("setup auto_clear: "+a+", "+b+" mins, now: "+(new Date).toLocaleString());ma=cmp_func;return!0}S.O=!0;chrome.extension.isAllowedFileSchemeAccess(function(a){S.O=a});var q=new ca(9999);S.g=new ca(9999);S.a=[];S.Ya=function(){return S.a};S.$a=function(a){a||(a=15);for(var b=[],c=
S.a.length,d=0;d<c;++d)S.a[d].recycled||b.push(d);N.get("poplist_showd_first")?b.sort(function(a,b){var c=S.a[a],d=S.a[b];return c.state==d.state?d.time_add-c.time_add:c.state<=Aa?c.state-d.state:d.state<=Aa?1:d.time_add-c.time_add}):b.sort(function(a,b){return S.a[b].time_add-S.a[a].time_add});return b.slice(0,a)};S.fa=function(b){b=a(b);return-1==b?null:S.a[b]};chrome.runtime.onUpdateAvailable.addListener(function(a){fb(a.version)});var r,ba=!1,A=!1,O=!1;(function(){var a=localStorage.ver,d=chrome.runtime.getManifest().version,
g=!1,k=a||d;localStorage.ver1&&localStorage.ver1_t||(localStorage.ver1=k,localStorage.ver1_t=Date.now());if(a){var k=e(a),m=e(d);k[2]=m[2]=0;0>b(k,m)&&(g=!0);a!=d&&(r=a)}else g=O=!0;g&&(ba=!0,A&&c());localStorage.ver=d})();window.addEventListener("load",function(){W.open(function(){W.Ua(function(a){for(var b=0;b<a.length;++b){var c=a[b];q.set(c.id);c.state==y&&(c.state=C,S.g.set(c.id),T.enqueue(c));-1==c.cr_id&&(c.cr_id=-2)}S.a=a;X.Jb()&&(m(),setTimeout(g,8E3))})})});window.onunload=function(){chrome.runtime.onMessage.removeListener(db.$());
chrome.runtime.onMessageExternal.removeListener(db.oa());W.Ob();ab.s();bb.s();cb.stop();qb.stop();Q.da(!1);W.s(W.close)};var P=[];S.Fb=function(a){P.push(a)};var G=1;S.Vb=function(a){S.m=a;v(function(){for(;0<P.length;)P.shift()()});a=new XMLHttpRequest;a.open("GET","http://www.chronodownloader.net?i="+G++,!0);a.send()};S.Ub=function(){S.m=-1;console.log("ui disconnected")};S.ib=function(a){function b(a){chrome.downloads.getFileIcon(a.cr_id,{size:16},function(b){chrome.runtime.lastError||S.j(a,"iconURL16",
b)});chrome.downloads.getFileIcon(a.cr_id,{size:32},function(b){chrome.runtime.lastError||(S.j(a,"iconURL32",b),a.state==y&&nb(a,b))})}chrome.downloads.search({},function(c){if(c&&c.length){w();for(var d=S.a.length+10,e=0;e<c.length;++e){var g=x(c[e]);if(g){if(-1==g){Q.h({c:!0},function(){h({cmd:"u_alert",data:Qa.noID})});break}X.ga(g,c[e].id,c[e].filename,!0);g=S.ea(g,!1);g<d&&(d=g)}}z();d<S.a.length&&(h({cmd:"u_new",idx:d,scroll_id:S.a[S.a.length-1].id}),c=S.a.slice(d),c.reverse(),ea.add(b,c,15,
!1,100))}a&&a()})};var U,Z=0;S.u=function(a){if(!R&&!U){var b=Date.now(),c=Z;Z=b;500>b-c?U=setTimeout(function(){U=void 0;S.u(-1)},500):(b="",N.get("badge_downnum")&&(c=X.za(),99<c?b="99+":0<c&&(b=c.toString(),-1==a&&(a=0<T.vb()),a&&(b+="+"))),chrome.browserAction.setBadgeText({text:b}))}};S.B=h;var R=!1;S.A=function(a,b,c){S.g.set(a.id);a._cf={};0!=c&&S.B({cmd:"u_fields",id:a.id,fields:b})};S.j=function(a,b,c,d){a[b]=c;S.A(a,[b],d)};var aa=document.createElement("canvas").getContext("2d"),K;K=new Image;
K.src="../icons/logo/19.png";var I=0;S.Ka=B;S.ha=function(a,b){var c=N.H().addtop,d=S.ea(a,c);S.B({cmd:"u_new",ids:[a.id],idx:d,addtop:c,scroll_id:a.id});Q.qa(function(a){chrome.tabs.sendMessage(a.id,{cmd:"d_anim",addpause:b})});B();N.get("notify_oneclick")&&hb(a,b);Va("fe_us","dl_src","chrome")};S.Z=function(a,b){var c=new M;c.id=q.ya(!0);if(-1==c.id)return null;c.referer=b||"";c.eurl=c.url=a;return c};S.ea=function(a,b){if(!a)return-1;a.naming_auto=!a.naming;a.folder_auto=!a.folder;var c;b?(S.a.unshift(a),
c=0):(S.a.push(a),c=S.a.length-1);S.g.set(a.id);return c};S.Lb=function(a){a||(a=S.a);var b=-1234;N.get("start_interrupted")&&(b=J);for(var c=[],d=0,e=a.length;d<e;++d){var g=a[d];if(g.state==D||g.state==b)S.j(g,"state",C,!1),T.enqueue(g),c.push(g.id)}c.length&&(T.K(),h({cmd:"u_tasks_by_field",ids:c,field:"state"}))};S.Nb=function(a){a||(a=S.a);for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c];e.state==C?(S.j(e,"state",D,!1),T.Ta(e),b.push(e.id)):e.state==y&&(X.pause(e),b.push(e.id))}b.length&&(h({cmd:"u_tasks_by_field",
ids:b,field:"state"}),T.U())};S.Eb=function(a){a||(a=S.a);var b=!1,c=[];w();for(var d=0,e=a.length;d<e;++d){var g=a[d];X.erase(g,!0);g.reset();g.state==y?X.download(g):(g.state=C,T.enqueue(g),b=!0);c.push(g.id);g._cf={};S.g.set(g.id)}z();b&&T.U();h({cmd:"u_tasks",ids:c})};S.Da=function(b,c,d){b.state==C&&(b.state=D);X.erase(b,c);q.clear(b.id);S.g.clear(b.id);W.Ab(b.id);c=a(b.id);-1!=c&&S.a.splice(c,1);setTimeout(function(){ob(b.id)},200);d&&h({cmd:"u_clear",src:d})};S.Cb=function(a,b,c){w();for(var d=
0,e=a.length;d<e;++d){var g=a[d];g.state==C&&(g.state=D);X.erase(g,b);q.clear(g.id);S.g.clear(g.id)}z();ea.add(W.Bb,a,200,!0);ea.add(pb,a,50,!1,150);c&&h({cmd:"u_clear",src:c,count:1<a.length?a.length:0})};S.pa=function(a){for(var b=[],c=S.a.length-1;0<=c;--c)a(S.a[c])&&b.push(c);return b};S.Pa=function(a){return S.ia(S.pa(a),!1,"bg")};S.ia=function(a,b,c){if(!a||!a.length)return 0;console.log("Begin clearing tasks");var d=!1,e=[];w();for(var g=0;g<a.length;++g){var k=a[g],m=S.a[k];d||m.state!=y&&
m.state!=C||(d=!0);X.erase(m,b);q.clear(m.id);S.g.clear(m.id);e.push(m.id);S.a.splice(k,1)}z();ea.add(W.zb,e,200,!0);ea.add(ob,e,50,!1,150);h({cmd:"u_clear",count:e.length,src:c});d&&S.u(-1);console.log(e.length+" task(s) cleared");return e.length};var ma,da;S.Hb=function(a,b){chrome.alarms.clear("auto-clear-tasks",function(){N.set("autoclear_type",a);N.set("autoclear_timer",b);u(a,b)?(N.set("autoclear_lasttime",Date.now()),chrome.alarms.create("auto-clear-tasks",{delayInMinutes:b,periodInMinutes:b})):
console.log("autoclear disabled")})};chrome.alarms.onAlarm.addListener(function(a){a&&"auto-clear-tasks"==a.name&&ma&&(a={type:"basic",title:f("tipBtnClear"),priority:1,message:f("statusScheduledAutoClear",[60]),contextMessage:"@"+(new Date(Date.now()+6E4)).toLocaleString(),iconUrl:"../icons/logo/48.png"},chrome.notifications.create("int_auto_clear",a,function(){}),da&&(clearTimeout(da),da=void 0),da=setTimeout(function(){if(ma){var a=S.Pa(ma);N.set("autoclear_lasttime",Date.now());0<a&&(a={type:"basic",
title:f("tipBtnClear"),priority:1,message:f("statusTasksCleared",[a]),iconUrl:"../icons/logo/48.png"},chrome.notifications.create("int_auto_clear",a,function(){}))}},6E4))});S.reset=function(){w();for(var a=0;a<S.a.length;++a)X.erase(S.a[a],!1,!0,!1);S.a.splice(0,S.a.length);var a=localStorage.ver1,b=localStorage.ver1_t;localStorage.clear();a&&(localStorage.ver1=a);b&&(localStorage.ver1_t=b);W.clear(function(){chrome.runtime.reload()})};S.lb=function(){return ea.Ma()};var ea=function(){function a(){c=
void 0;if(b.length){var d=b[0];if(d.La)d.ma(d.p.slice(d.I,d.I+d.X),d.la);else for(var e=d.I,g=e+d.X;e<g&&e<d.Fa;++e)d.ma(d.p[e],d.la);(d.I+=d.X)>=d.Fa&&b.shift();b.length?c=setTimeout(a,b[0].qb):(h({cmd:"u_bgbusy",data:!1}),console.log("work queue empty"))}}var b=[],c;return{add:function(d,e,g,k,m,q){m=m||150;b.push({ma:d,p:e,Fa:e.length,X:g,La:k,qb:m,I:0,la:q});c||(c=setTimeout(a,m),h({cmd:"u_bgbusy",data:!0}))},Ma:function(){return void 0!=c||0<b.length}}}()})();S.canFileAccess=function(){return S.O};
S.setPopListOpen=function(a){S.T=a};S.isPopListOpen=function(){return S.T};S.setPopSnifferTabId=function(a){S.Ca=a};S.getRecents=S.$a;S.getDatas=S.Ya;S.task_by_id=S.fa;S.start_tasks=S.Lb;S.stop_tasks=S.Nb;S.restart_tasks=S.Eb;S.remove_tasks=S.Cb;S.remove_task_completely=S.Da;S.clear_tasks=S.ia;S.getFilteredTaskIndices=S.pa;S.reset=S.reset;S.update_field=S.j;S.set_auto_clear=S.Hb;S.isBusy=S.lb;S.ui_ready=S.Vb;S.ui_close=S.Ub;window.dy_bkg=S;

