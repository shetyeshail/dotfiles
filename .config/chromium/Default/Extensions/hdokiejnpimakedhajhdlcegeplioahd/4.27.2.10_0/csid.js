var CS_table=[];function CS_t(){var n=null,t=null,e=null,l=null,i=null,o=null,r=null,u=null,a=null,s=null,d=null,c=null,f=null,_=0,m=0,g=0}function getcsid(n,t){var e;return("function"==typeof lp_sha256?lp_sha256:SHA256)(n+""+t)}function getcsinfo(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=getcsid(n,t);if(null===e)return null;var l=CS_table[e];return void 0===l&&(l=null),l}function setcsinfo(n,t,e){if(null===n||null===t||!e||void 0===n||void 0===t)return null;if(null===e.docnum||null===e.tabid||null===e.url)return null;"number"==typeof n&&(n=n.toString());var l=getcsid(n,t);return e.csid&&l&&l!=e.csid&&L("warn: csid!=obj.csid"),null!==e.csid&&void 0!==e.csid||(e.csid=l),e.last_ts=(new Date).getTime(),void 0===CS_table&&(CS_table=[]),CS_table[l]=e,!0}function register_new_cs(n,t,e,l,i,o){if(null===n||null===t||!e||void 0===n||void 0===t)return null;write_history({cmd:"register_new_cs",docnum:t,tabid:n,docstate:i}),void 0===i&&(i=null),void 0===o&&(o=null),"number"==typeof n&&(n=n.toString());var r=0,u=new CS_t;if(u){if(u.docnum=t,u.tabid=n,u.url=e,u.lastfill_aid=0,l?u.parent_docnum=t:(u.parent_docnum=g_CS_tops[n],u.parent_docnum),u.docstate=i,u.flags=null,null!==o&&"object"==typeof o&&(u.flags=o,void 0!==o.domain&&(u.domain=o.domain,delete u.flags.domain),void 0!==o.origin&&(u.origin=o.origin,delete u.flags.origin)),u.start_ts=(new Date).getTime(),g_cpwbot&&CPWbot_bg){var a={url:e,docnum:t};r=CPWbot_bg.score_frame(n,a)}return u.importance=r,setcsinfo(n,t,u)}return null}function delete_cs_for_docnum(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=!1,l;for(l in CS_table)CS_table.hasOwnProperty(l)&&l==getcsid(n,t)&&(e=!0,delete CS_table[l]);return e}function delete_cs_for_tab(n){if(null===n||void 0===n)return null;"number"==typeof n&&(n=n.toString());var t=!1,e;for(e in CS_table)if(CS_table.hasOwnProperty(e)){var l=CS_table[e];l&&l.tabid==n&&(t=!0,delete CS_table[e])}return t}function update_cs_docstate(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var l=t.docstate;if(null===l||void 0===l)return null;var i=!1,o=getcsinfo(n,e);return o&&(o.docstate=l,i=setcsinfo(n,e,o)),i}function update_cs_timestamp(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var l=getcsinfo(n,e);return l?setcsinfo(n,e,l):null}function count_cs_for_tabid(n){if(null===n||void 0===n)return-1;"number"==typeof n&&(n=n.toString());var t=0,e,l;for(e in CS_table)CS_table.hasOwnProperty(e)&&(l=CS_table[e]).tabid===n&&t++;return t}function dumpinfo_for_tabid(n){var t,e,l;if(null!==n&&void 0!==n)for(e in"number"==typeof n&&(n=n.toString()),console.log("dumping info for tabid="+n),CS_table)CS_table.hasOwnProperty(e)&&(l=CS_table[e],t=(new Date).getTime(),l.tabid===n&&console.log("DUMPINFO [tabid:"+n+"][docnum:"+l.docnum+"] url="+l.url+" last_ts="+(t-l.last_ts)/1e3+"secs score="+l.importance+" killswitch?="+l.killswitch+" isTop?="+(l.parent_docnum==l.docnum?"true":"false")))}function find_docnum_for_tabid_by_url(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;var e,l,i;for(e in"number"==typeof n&&(n=n.toString()),CS_table)if(CS_table.hasOwnProperty(e)&&(i=CS_table[e]).tabid===n&&i.url==t){l=i.docnum;break}return l}function set_killswitch_value(n,t,e){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var l=getcsinfo(n,t);return!!l&&(l.killswitch=e,setcsinfo(n,t,l))}function get_killswitch_value(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=getcsinfo(n,t),l=0;return e&&(l=parseInt(e.killswitch),isNaN(l)&&(l=0)),l}function skip_CS_by_score(n,t){if(null===n||null===t)return!0;var e=-25,l=getcsinfo(n,t);return!l||(L("skip? [tabid="+n+"][docnum="+t+"] score="+l.importance),l.importance<e)}function get_top_url(n,t){var e="",l=0,i,o=getcsinfo_top(n,t);if(o&&o.parent_docnum==o.docnum)e=o.url;else for(var r in CS_table)if(CS_table.hasOwnProperty(r)&&(o=CS_table[r]).tabid===n&&o.parent_docnum==o.docnum){e=o.url;break}return e}function get_top_docnum(n,t){var e=0;i;var l=getcsinfo_top(n,t);if(l&&l.parent_docnum==l.docnum)e=l.docnum;else for(var o in CS_table)if(CS_table.hasOwnProperty(o)&&(l=CS_table[o]).tabid===n&&l.parent_docnum==l.docnum){e=l.docnum;break}return e}function update_cs_docflags(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var l=t.docflags,i=!1,o=getcsinfo(n,e);return o&&"object"==typeof l&&(o.flags=l,void 0!==l.domain&&(o.domain=l.domain,delete o.flags.domain),void 0!==l.origin&&(o.origin=l.origin,delete o.flags.origin),i=setcsinfo(n,e,o)),i}function getcsinfo_top(n,t){for(var e=null,l=-1,i,o=getcsinfo(n,t),r=null,u=0;u<10&&o;u++){if((r=getcsinfo(n,o.parent_docnum))&&o.parent_docnum==r.docnum){l=r.docnum;break}if(null==o.parent_docnum)break;o=r}return l>=0&&(r=getcsinfo(n,l)),r&&!isEmptyObject(r)&&(e=r),e}function update_cs_lastfill_aid(n,t){var e=!0;if(null===n||void 0===n||void 0===t)return!1;"number"==typeof n&&(n=n.toString());var l=get_top_docnum(n),i=getcsinfo(n,l);return i&&(i.lastfill_aid=t,e=setcsinfo(n,l,i)),e}function rebuild_cs_table(n){var t;function e(t){if(0!=t.url.indexOf("chrome:")&&0!=t.url.indexOf("safari:")){var e=gettabid(t);for(var l in g_CS[e]){var i=l,o=g_CS[e][l],r=gettaburl(t),u=t.status,a=0,s=!1;if(l&&g_CS_tops[e]==l&&(s=!0),n){var d=getcsinfo(e,i);d?(r!=d.url&&console.log(sprintf("[%s][%s] url mismatch %s != %s",e,i,r,d.url)),s!=(d.parent_docnum==d.docnum)&&console.log(sprintf("[%s][%s] isTop mismatch %s != %s ",e,i,r,s,d.parent_docnum==d.docnum))):console.log(sprintf("[%s][%s] seems like this frame exists but no entry found in CS table for it",e,i))}else register_new_cs(e,i,r,s,u,0)}}}get_all_windows({},function(n){var t,l;for(t=0;t<n.length;t++)if(g_ischrome)chrome.tabs.query({windowId:n[t].id},function(n){if(n&&n.length>0)for(var t=0;t<n.length;t++){var l;e(n[t])}});else{var i=get_tabs(n[t]);if(i&&void 0!==i.length)for(l=0;l<i.length;l++)e(i[l])}})}
//# sourceMappingURL=sourcemaps/csid.js.map
