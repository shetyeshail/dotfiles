var CPWbot_bg,g_v2engine=!0,g_v3engine=!1;CPWbot_bg||(CPWbot_bg=new CPWbot_bg_lib);var g_cpw_server_initiated_tabid=null,g_cpw_do_fakeui=!1,TYPE_ID="id",TYPE_NAME="name",TYPE_XPATH="xpath",FN_LOGIN=1,FN_PASSWORD=2,FN_LOGIN_OTHER=5,FN_CURRENT_PASS=10,FN_NEW_PASS=11,FN_NEW_PASS_CONFIRM=12,FN_CPW_OTHER=13,FN_CPW_INVALID=14,FN_LOGIN_INVALID=15,FN_LOGIN_SUCCESS=16,FN_LOGIN_SUCCESS_INVALID=17,FN_NAVIGATE_TO_CPW=18,FN_CPW_SUCCESS=19,FN_CPW_SUCCESS_INVALID=20,FN_NAVIGATE_TO_ACCTMGMT=21,FN_CPW_SUBMIT=22,FN_IS_LOGGED_IN=23,FN_IS_LOGGED_IN_NEGATION=24,FN_LOGIN_SUBMIT=25,FN_POPUP_EXISTS=26,FN_POPUP_DISMISS=27,FN_REVEAL_LOGIN=28,FN_CHALLENGE_LOGIN=29,FN_CHALLENGE_PASSWORD=30,FN_CHALLENGE_OTHER=31,FN_CHALLENGE_SUBMIT=32,FN_CHALLENGE_INVALID=33,FN_CHALLENGE_SUCCESS=34,FN_CHALLENGE_SUCCESS_INVALID=35,FN_EPHEMERAL_STATE=37,FN_NAVIGATE_TO_LOGOUT=38,FN_CAPTCHA=39,FN_MULTI_FACTOR=40,FN_PASSWORD_HINT=41,FN_POPUP_EXISTS_INVALID=42,FN_FAKEUI_LOGGED_OUT_1=43,FN_FAKEUI_LOGGED_OUT_2=44,FN_FAKEUI_LOGGED_OUT_3=45,FN_FAKEUI_LOGGED_OUT_INPUT=46,FN_FAKEUI_LOGGED_IN_1=47,FN_FAKEUI_LOGGED_IN_2=48,FN_FAKEUI_LOGGED_IN_3=49,FN_FAKEUI_LOGGED_IN_INPUT=50,FN_FORCE_FAIL=51,FN_CAPTCHA_SUCCESS=52,FN_MULTI_FACTOR_SUCCESS=53,FN_PASSWORD_HINT_SUCCESS=54,FN_LOGIN_ENTRY_INVALID=55,FN_LOGIN_ENTRY_USERNAME=56,FN_LOGIN_ENTRY_SUBMIT=57,FN_LOGIN_ENTRY_PASSWORD=58,FN_LOGIN_ENTRY_SUCCESS_INVALID=59,FN_LOGIN_ENTRY_SUCCESS=60,FN_REVEAL_LOGOUT=61,CONST_CLICK_NOMINAL=0,CONST_CLICK_NO_FOCUS=1,CONST_CLICK_MOUSEDOWN=2,CONST_CLICK_STRANGE=3,JS_PRE_NAVIGATE_CPW=1,JS_PRE_LOGIN=2,JS_POST_NAVIGATE_CPW=3,JS_POST_LOGIN=4,JS_PRE_CPW=5,JS_POST_CPW=6,JS_PRE_ACCTMGMT=7,JS_POST_ACCTMGMT=8,JS_LOGIN_REVEAL=9,JS_VALIDATE_LOGIN_SUCCESS=10,JS_VALIDATE_CPW_SUCCESS=11,JS_LOGIN_SUBMIT=12,JS_FINISH=13,JS_PRE_CHALLENGE=14,JS_POST_CHALLENGE=15,JS_CHALLENGE_SUBMIT=16,JS_VALIDATE_CHALLENGE_SUCCESS=17,JS_BEGIN=18,JS_PRE_LOGOUT=19,JS_POST_LOGOUT=20,JS_LOGIN_ENTRY_SUBMIT=21,JS_PRE_LOGIN_ENTRY=22,JS_POST_LOGIN_ENTRY=23,JS_VALIDATE_LOGIN_ENTRY_SUCCESS=24,JS_PRE_DOCAPTCHA=25,JS_POST_DOCAPTCHA=26;function replace_constants(e){if(!e)return null;if(void 0!==e.field_info)for(var t=0;t<e.field_info.length;t++){if(void 0!==e.field_info[t].id_type)switch(e.field_info[t].id_type){case"TYPE_ID":e.field_info[t].id_type=TYPE_ID;break;case"TYPE_NAME":e.field_info[t].id_type=TYPE_NAME;break;case"TYPE_XPATH":e.field_info[t].id_type=TYPE_XPATH}if(void 0!==e.field_info[t].id_function)switch(e.field_info[t].id_function){case"FN_LOGIN":e.field_info[t].id_function=FN_LOGIN;break;case"FN_PASSWORD":e.field_info[t].id_function=FN_PASSWORD;break;case"FN_LOGIN_OTHER":e.field_info[t].id_function=FN_LOGIN_OTHER;break;case"FN_CURRENT_PASS":e.field_info[t].id_function=FN_CURRENT_PASS;break;case"FN_NEW_PASS":e.field_info[t].id_function=FN_NEW_PASS;break;case"FN_NEW_PASS_CONFIRM":e.field_info[t].id_function=FN_NEW_PASS_CONFIRM;break;case"FN_CPW_OTHER":e.field_info[t].id_function=FN_CPW_OTHER;break;case"FN_CPW_INVALID":e.field_info[t].id_function=FN_CPW_INVALID;break;case"FN_LOGIN_INVALID":e.field_info[t].id_function=FN_LOGIN_INVALID;break;case"FN_LOGIN_SUCCESS":e.field_info[t].id_function=FN_LOGIN_SUCCESS;break;case"FN_LOGIN_SUCCESS_INVALID":e.field_info[t].id_function=FN_LOGIN_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_CPW":e.field_info[t].id_function=FN_NAVIGATE_TO_CPW;break;case"FN_CPW_SUCCESS":e.field_info[t].id_function=FN_CPW_SUCCESS;break;case"FN_CPW_SUCCESS_INVALID":e.field_info[t].id_function=FN_CPW_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_ACCTMGMT":e.field_info[t].id_function=FN_NAVIGATE_TO_ACCTMGMT;break;case"FN_CPW_SUBMIT":e.field_info[t].id_function=FN_CPW_SUBMIT;break;case"FN_IS_LOGGED_IN":e.field_info[t].id_function=FN_IS_LOGGED_IN;break;case"FN_IS_LOGGED_IN_NEGATION":e.field_info[t].id_function=FN_IS_LOGGED_IN_NEGATION;break;case"FN_LOGIN_SUBMIT":e.field_info[t].id_function=FN_LOGIN_SUBMIT;break;case"FN_POPUP_EXISTS":e.field_info[t].id_function=FN_POPUP_EXISTS;break;case"FN_POPUP_DISMISS":e.field_info[t].id_function=FN_POPUP_DISMISS;break;case"FN_REVEAL_LOGIN":e.field_info[t].id_function=FN_REVEAL_LOGIN;break;case"FN_CHALLENGE_LOGIN":e.field_info[t].id_function=FN_CHALLENGE_LOGIN;break;case"FN_CHALLENGE_PASSWORD":e.field_info[t].id_function=FN_CHALLENGE_PASSWORD;break;case"FN_CHALLENGE_OTHER":e.field_info[t].id_function=FN_CHALLENGE_OTHER;break;case"FN_CHALLENGE_SUBMIT":e.field_info[t].id_function=FN_CHALLENGE_SUBMIT;break;case"FN_CHALLENGE_INVALID":e.field_info[t].id_function=FN_CHALLENGE_INVALID;break;case"FN_CHALLENGE_SUCCESS":e.field_info[t].id_function=FN_CHALLENGE_SUCCESS;break;case"FN_CHALLENGE_SUCCESS_INVALID":e.field_info[t].id_function=FN_CHALLENGE_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_LOGOUT":e.field_info[t].id_function=FN_NAVIGATE_TO_LOGOUT;break;case"FN_EPHEMERAL_STATE":e.field_info[t].id_function=FN_EPHEMERAL_STATE;break;case"FN_CAPTCHA":e.field_info[t].id_function=FN_CAPTCHA;break;case"FN_MULTI_FACTOR":e.field_info[t].id_function=FN_MULTI_FACTOR;break;case"FN_PASSWORD_HINT":e.field_info[t].id_function=FN_PASSWORD_HINT;break;case"FN_POPUP_EXISTS_INVALID":e.field_info[t].id_function=FN_POPUP_EXISTS_INVALID;break;case"FN_FORCE_FAIL":e.field_info[t].id_function=FN_FORCE_FAIL;break;case"FN_CAPTCHA_SUCCESS":e.field_info[t].id_function=FN_CAPTCHA_SUCCESS;break;case"FN_MULTI_FACTOR_SUCCESS":e.field_info[t].id_function=FN_MULTI_FACTOR_SUCCESS;break;case"FN_PASSWORD_HINT_SUCCESS":e.field_info[t].id_function=FN_PASSWORD_HINT_SUCCESS;break;case"FN_LOGIN_ENTRY_INVALID":e.field_info[t].id_function=FN_LOGIN_ENTRY_INVALID;break;case"FN_LOGIN_ENTRY_USERNAME":e.field_info[t].id_function=FN_LOGIN_ENTRY_USERNAME;break;case"FN_LOGIN_ENTRY_PASSWORD":e.field_info[t].id_function=FN_LOGIN_ENTRY_PASSWORD;break;case"FN_LOGIN_ENTRY_SUBMIT":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUBMIT;break;case"FN_LOGIN_ENTRY_SUCCESS":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUCCESS;break;case"FN_LOGIN_ENTRY_SUCCESS_INVALID":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUCCESS_INVALID;break;case"FN_REVEAL_LOGOUT":e.field_info[t].id_function=FN_REVEAL_LOGOUT;break;case"FN_FAKEUI_LOGGED_IN_1":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_1;break;case"FN_FAKEUI_LOGGED_IN_2":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_2;break;case"FN_FAKEUI_LOGGED_IN_3":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_3;break;case"FN_FAKEUI_LOGGED_IN_INPUT":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_INPUT;break;case"FN_FAKEUI_LOGGED_OUT_1":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_1;break;case"FN_FAKEUI_LOGGED_OUT_2":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_2;break;case"FN_FAKEUI_LOGGED_OUT_3":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_3;break;case"FN_FAKEUI_LOGGED_OUT_OUTPUT":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_INPUT}}if(void 0!==e.jsfrags)for(var t=0;t<e.jsfrags.length;t++)if(void 0!==e.jsfrags[t].jstype)switch(e.jsfrags[t].jstype){case"JS_PRE_NAVIGATE_CPW":e.jsfrags[t].jstype=JS_PRE_NAVIGATE_CPW;break;case"JS_PRE_LOGIN":e.jsfrags[t].jstype=JS_PRE_LOGIN;break;case"JS_POST_NAVIGATE_CPW":e.jsfrags[t].jstype=JS_POST_NAVIGATE_CPW;break;case"JS_POST_LOGIN":e.jsfrags[t].jstype=JS_POST_LOGIN;break;case"JS_PRE_CPW":e.jsfrags[t].jstype=JS_PRE_CPW;break;case"JS_POST_CPW":e.jsfrags[t].jstype=JS_POST_CPW;break;case"JS_PRE_ACCTMGMT":e.jsfrags[t].jstype=JS_PRE_ACCTMGMT;break;case"JS_POST_ACCTMGMT":e.jsfrags[t].jstype=JS_POST_ACCTMGMT;break;case"JS_LOGIN_REVEAL":e.jsfrags[t].jstype=JS_LOGIN_REVEAL;break;case"JS_VALIDATE_LOGIN_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_LOGIN_SUCCESS;break;case"JS_VALIDATE_CPW_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_CPW_SUCCESS;break;case"JS_LOGIN_SUBMIT":e.jsfrags[t].jstype=JS_LOGIN_SUBMIT;break;case"JS_FINISH":e.jsfrags[t].jstype=JS_FINISH;break;case"JS_PRE_CHALLENGE":e.jsfrags[t].jstype=JS_PRE_CHALLENGE;break;case"JS_POST_CHALLENGE":e.jsfrags[t].jstype=JS_POST_CHALLENGE;break;case"JS_CHALLENGE_SUBMIT":e.jsfrags[t].jstype=JS_CHALLENGE_SUBMIT;break;case"JS_VALIDATE_CHALLENGE_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_CHALLENGE_SUCCESS;break;case"JS_BEGIN":e.jsfrags[t].jstype=JS_BEGIN;break;case"JS_PRE_LOGOUT":e.jsfrags[t].jstype=JS_PRE_LOGOUT;break;case"JS_POST_LOGOUT":e.jsfrags[t].jstype=JS_POST_LOGOUT;break;case"JS_PRE_LOGIN_ENTRY":e.jsfrags[t].jstype=JS_PRE_LOGIN_ENTRY;break;case"JS_POST_LOGIN_ENTRY":e.jsfrags[t].jstype=JS_POST_LOGIN_ENTRY;break;case"JS_LOGIN_ENTRY_SUBMIT":e.jsfrags[t].jstype=JS_LOGIN_ENTRY_SUBMIT;break;case"JS_PRE_DOCAPTCHA":e.jsfrags[t].jstype=JS_PRE_DOCAPTCHA;break;case"JS_POST_DOCAPTCHA":e.jsfrags[t].jstype=JS_POST_DOCAPTCHA}if(void 0!==e.click_flavor)switch(e.click_flavor){case"CLICK_NO_FOCUS":e.click_flavor=CONST_CLICK_NO_FOCUS;break;case"CLICK_MOUSEDOWN":e.click_flavor=CONST_CLICK_MOUSEDOWN;break;case"CLICK_STRANGE":e.click_flavor=CONST_CLICK_STRANGE;break;case"CLICK_NOMINAL":default:e.click_flavor=CONST_CLICK_NOMINAL}return e}var DEFAULT_CLICK_DELAY=250,DEFAULT_FILL_DELAY=250,DEFAULT_SESSION_TIMEOUT=12e4,DEFAULT_VALIDATE_TIMEOUT=1e4,CLICK_RETRY_TIME=5e3,recipe_template={version:1,symbolic:"",login_url:"",acctmgmt_url:null,cpw_url:"",logout_url:"",login_entry_url:"",fakeui_loggedout_url:"",fakeui_loggedin_url:"",validate_timeout:5e3,field_info:[],jsfrags:[],cpw_delay:250,login_delay:250,acctmgmt_delay:250,login_reveal_delay:250,logout_reveal_delay:250,logout_delay:250,fill_field_delay:250,click_field_delay:250,trigger_cpw_delay:0,cpw_change_success_url:null,cpw_change_failure_url:null,login_failure_url:null,login_success_url:null,login_entry_failure_url:null,login_entry_success_url:null,challenge_invalidate_url:null,challenge_validate_url:null,click_flavor:CONST_CLICK_NOMINAL,generate_pref_overrides:null,reveal_login_js_delay:0,reveal_cpw_js_delay:0,navigate_acctmgmt_js_delay:0,postreveallogin_sleep:0,postacctmgmt_sleep:0,postrevealcpw_sleep:0,posttrigger_sleep:0,postlogout_sleep:0,start_delay:0,post_login_submit_delay:1100,post_js_begin_delay:5555,js_finish_delay:2e3,session_timeout:DEFAULT_SESSION_TIMEOUT,document_complete_timeout:0,proceed_on_interactive:0,click_on_fields_on_fill:0,fill_password_fields_via_keys:0},r_tesco={},r_netflix={},minimal_recipe={symbolic:"",login_url:"",field_info:[],generate_pref_overrides:{minlength:6}},telegraph={symbolic:"Daily Telegraph"},amex={symbolic:"American Express",field_info:[],jsfrag:[]},boa={symbolic:"Bank of America",login_url:"https://www.bankofamerica.com/sitemap/hub/signin.go",field_info:[{id_type:"TYPE_ID",id_value:"userId",id_function:"FN_LOGIN"},{id_type:"TYPE_ID",id_value:"password",id_function:"FN_PASSWORD"}],jsfrag:[]},capitalone={generate_pref_overrides:{mindigits:2,digits:1,special:0}},capitalone360={},testrig={symbolic:"Test",login_url:"http://www.netrot.net/~chang/form/formtest1.html",field_info:[{id_type:"TYPE_ID",id_value:"email",id_function:"FN_LOGIN"},{id_type:"TYPE_NAME",id_value:"password",id_function:"FN_PASSWORD"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",id_function:"FN_LOGIN_SUBMIT"},{id_type:"TYPE_ID",id_value:"email",id_function:"FN_IS_LOGGED_IN_NEGATION"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",id_function:"FN_CPW_SUBMIT"}],jsfrag:[],generate_pref_overrides:{mindigits:1,digits:1,special:0,minlength:6}};function CPWbot_bg_lib(){var e=this,t=0,n=null,i=null,_=null,o=null,r=0,a=null,l=null,s=null,c=null,u=null;Me();var d=null,f=[],g=!1,p=!1,b=!1,v=!1,m=!1,C=!1,h="",N=!1,S=!1,E=!1,P=!1,w=!1,I=!1,A=!1,T=!1,O=!1,k=!1,F=!1,W=!1,G={},y=!1,D=!1,U=!1,R=!1,M=!0,j=!1,H=!1,V=!1,J=!1,B=!1,K=!1,Y=!1,x=q,q=0,z=1,X=2,Z=3,Q=4,$=5,ee=6,te=7,ne=8,ie=9,_e=63,oe=64,re=65,ae=66,le=67,se=68,ce=69,ue=70,de=71,fe=72,ge=73,pe=74,be=75,ve=76,me=128,Ce=129,he=130,Ne=131,Se=132,Le=133,Ee=134,Pe=135,we=136,Ie=137,Ae=138,Te=139,Oe=140,ke=141,Fe=192,We=224,Ge=240,ye=248,De=[];function Ue(){return m_last_overlay_msg}function Re(e){m_last_overlay_msg=e}function Me(){Re("")}function je(e){return e?e.login_url:null}function He(e){return e?e.cpw_url:null}function Ve(e){return e?e.acctmgmt_url:null}function Je(e){return e?e.logout_url:null}function Be(e){return e?e.login_entry_url:null}function Ke(e){return e?e.fakeui_loggedout_url:null}function Ye(e){return e?e.fakeui_loggedin_url:null}function xe(e){if(!e)return null;var t=e.click_flavor;if("string"==typeof t){var n=parseInt(t);if(!isNaN(n))return n}return e.click_flavor}function qe(e){return Ct(e,FN_PASSWORD)}function ze(e){return Ct(e,FN_LOGIN)}function Xe(e){return Ct(e,FN_CURRENT_PASS)}function Ze(e){return Ct(e,FN_NEW_PASS)}function Qe(e){return Ct(e,FN_NEW_PASS_CONFIRM)}function $e(e){return Ct(e,FN_NAVIGATE_TO_CPW)}function et(e){return Ct(e,FN_NAVIGATE_TO_ACCTMGMT)}function tt(e){return Ct(e,FN_NAVIGATE_TO_LOGOUT)}function nt(e){return Ct(e,FN_CPW_SUBMIT)}function it(e){return Ct(e,FN_LOGIN_SUBMIT)}function _t(e){return Ct(e,FN_REVEAL_LOGIN)}function ot(e){return Ct(e,FN_CHALLENGE_PASSWORD)}function rt(e){return Ct(e,FN_CHALLENGE_LOGIN)}function at(e){return Ct(e,FN_CHALLENGE_SUBMIT)}function lt(e){return Ct(e,FN_LOGIN_ENTRY_USERNAME)}function st(e){return Ct(e,FN_LOGIN_ENTRY_PASSWORD)}function ct(e){return Ct(e,FN_LOGIN_ENTRY_SUBMIT)}function ut(e){return Ct(e,FN_FAKEUI_LOGGED_IN_1)}function dt(e){return Ct(e,FN_FAKEUI_LOGGED_IN_2)}function ft(e){return Ct(e,FN_FAKEUI_LOGGED_IN_3)}function gt(e){return Ct(e,FN_FAKEUI_LOGGED_IN_INPUT)}function pt(e){return Ct(e,FN_FAKEUI_LOGGED_OUT_1)}function bt(e){return Ct(e,FN_FAKEUI_LOGGED_OUT_2)}function vt(e){return Ct(e,FN_FAKEUI_LOGGED_OUT_3)}function mt(e){return Ct(e,FN_FAKEUI_LOGGED_OUT_INPUT)}function Ct(e,t){if(!e||!e.field_info)return null;var n,i=null,_=null;for(n=0;n<e.field_info.length;n++)if((i=e.field_info[n]).id_function==t){_={id_type:i.id_type,id_value:i.id_value};break}return _}function ht(e){return nn(e,JS_PRE_NAVIGATE_CPW)}function Nt(e){return nn(e,JS_POST_NAVIGATE_CPW)}function St(e){return nn(e,JS_PRE_ACCTMGMT)}function Lt(e){return nn(e,JS_POST_ACCTMGMT)}function Et(e){return nn(e,JS_PRE_CPW)}function Pt(e){return nn(e,JS_POST_CPW)}function wt(e){return nn(e,JS_PRE_LOGIN)}function It(e){return nn(e,JS_POST_LOGIN)}function At(e){return nn(e,JS_LOGIN_REVEAL)}function Tt(e){return nn(e,JS_LOGIN_SUBMIT)}function Ot(e){return nn(e,JS_LOGIN_ENTRY_SUBMIT)}function kt(e){return nn(e,JS_VALIDATE_LOGIN_SUCCESS)}function Ft(e){return nn(e,JS_VALIDATE_CPW_SUCCESS)}function Wt(e){return nn(e,JS_FINISH)}function Gt(e){return nn(e,JS_PRE_CHALLENGE)}function yt(e){return nn(e,JS_POST_CHALLENGE)}function Dt(e){return nn(e,JS_CHALLENGE_SUBMIT)}function Ut(e){return nn(e,JS_VALIDATE_CHALLENGE_SUCCESS)}function Rt(e){return nn(e,JS_BEGIN)}function Mt(e){return nn(e,JS_PRE_LOGOUT)}function jt(e){return nn(e,JS_POST_LOGOUT)}function Ht(e){return nn(e,JS_PRE_LOGIN_ENTRY)}function Vt(e){return nn(e,JS_POST_LOGIN_ENTRY)}function Jt(e){return nn(e,JS_VALIDATE_LOGIN_ENTRY_SUCCESS)}function Bt(e){return nn(e,JS_PRE_DOCAPTCHA)}function Kt(e){return nn(e,JS_POST_DOCAPTCHA)}function Yt(e){var t=null;return e&&void 0!==e.cpw_change_success_url&&(t=e.cpw_change_success_url),t}function xt(e){var t=null;return e&&void 0!==e.cpw_change_failure_url&&(t=e.cpw_change_failure_url),t}function qt(e){var t=null;return e&&void 0!==e.login_failure_url&&(t=e.login_failure_url),t}function zt(e){var t=null;return e&&void 0!==e.login_success_url&&(t=e.login_success_url),t}function Xt(e){var t=null;return e&&void 0!==e.login_entry_failure_url&&(t=e.login_entry_failure_url),t}function Zt(e){var t=null;return e&&void 0!==e.login_entry_success_url&&(t=e.login_entry_success_url),t}function Qt(e){var t=null;return e&&void 0!==e.challenge_invalidate_url&&(t=e.challenge_invalidate_url),t}function $t(e){var t=null;return e&&void 0!==e.challenge_validate_url&&(t=e.challenge_validate_url),t}function en(e){return null}function tn(e){return null}function nn(e,t){if(!e||!e.jsfrags)return null;var n,i,_;for(n=0;n<e.jsfrags.length;n++)if((i=e.jsfrags[n]).jstype==t){_=i.jsfrag;break}return _}function _n(e,t,n){if(!t||!n)return null;var i=n(t);if(i){var _=(new Date).getTime();null===_&&(_=0);var o="function"==typeof lp_sha256?lp_sha256:SHA256,r=o(e.toString()+i+_.toString()),a,l,a=(l="function"==typeof fasthash?fasthash:"function"==typeof crc32?crc32:"function(j) { if (j) { return j.length; } return 0; }")(i);return verbose_log("injecting javascript fragment into CS: "+i),Ni(vi,"Injected Javascript into Document"),sendCS(e,{cmd:"run_cpwbot_js",req_id:r,js:i,hash:a},"all"),!0}return!1}function on(e){return"undefined"!=typeof g_sites?g_sites[e]:"undefined"!=typeof lpaccts?lpaccts[e]:null}function rn(e,t,n,i,_,o,r){if(!n)return!1;null===i&&(i=0),null===o&&(o=0),void 0!==_&&null!==_||(_=DEFAULT_FILL_DELAY),Ni(vi,"Filling Field");var a=(new Date).getTime();null===a&&(a=0);var l,s=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+n.id_value+a.toString());return sendCS(e,{cmd:"cpwbot_fill_field",req_id:s,id_type:n.id_type,id_value:n.id_value,field_value:t,type:"text",formname:"",should_click:i,should_fill_via_keys:o,delay:_},"all"),!0}function an(e,t,n,i,_,o,r){if(!n)return!1;null===i&&(i=0),null===o&&(o=0),void 0!==_&&null!==_||(_=DEFAULT_FILL_DELAY),Ni(vi,"Filling Password Field");var a=(new Date).getTime();null===a&&(a=0);var l,s=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+n.id_value+a.toString());return sendCS(e,{cmd:"cpwbot_fill_field",req_id:s,id_type:n.id_type,id_value:n.id_value,field_value:t,type:"password",formname:"",should_click:i,should_fill_via_keys:o,delay:_,flavor:r},"all"),!0}function ln(e,t,i,_){if(!t)return!1;void 0!==i&&null!==i||(i=DEFAULT_CLICK_DELAY),void 0===_&&(_=CONST_CLICK_NOMINAL),S_=(new Date).getTime()+CLICK_RETRY_TIME+i,L_=!1,Ni(vi,"Clicking");var o=(new Date).getTime();null===o&&(o=0);var r,a=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+t.id_value+o.toString());verbose_log("click_field id="+a+" saved to m_pwchange_last_click_field_id"),u=a,E_=0;var l={cmd:"cpwbot_click_field",msgid:a,pwchangestate:n,id_type:t.id_type,id_value:t.id_value,delay:i,flavor:_};return sendCS(e,l,"all"),m_lastclick_metadata=l,!0}function sn(e,t,n,i){if(!e)return!1;var _=!0,o;if(g_isfirefox){var r=n(e);for(o=0;o<r.length;o++){var a=r[o].id_type,l=r[o].id_value,s;if(!(s=getElementByIdentifier(doc,a,l))){_=!1;break}}if(_){var c=i(e);for(o=0;o<c.length;o++){var a=c[o].id_type,l=c[o].id_value,s;if(s=getElementByIdentifier(doc,a,l)){_=!1;break}}}return _}console_log("this probably will only works for firefox")}function cn(e,t,n){if(!t||!n)return!1;var i="",_="",o=on(n.aid);if(!o)return J_("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(e,se,t),L("pre-login-form-js"),_n(e,t,wt);var r=ze(t),a=qe(t),l=fi(t),s=gi(t),c=0,u=rnd2=0;Y&&(u=io(),rnd2=io());var d=0,f=xe(t);return r&&(d++,rn(e,i=getusernamefromacct(o),r,l,0*d+u,!1,f)),a&&(d++,an(e,_=getpasswordfromacct(o),a,l,0*d+u+rnd2,s,f)),L("post-login-form-js"),_n(e,t,It),!0}function un(e,t,n){if(!t)return!1;CPWbot_bg.do_milestone(e,ce,t);var i=!1;P=!1;var _=it(t);if(_){var o=DEFAULT_CLICK_DELAY,r;void 0!==t.login_delay&&(o=t.login_delay),P=!0,ln(e,_,o,xe(t)),i=!0}return _n(e,t,Tt)&&(i=!0),!i||null}function dn(e,t,n){if(!t||!n)return!1;var i="",_="",o=on(n.aid);if(!o)return J_("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(e,be,t),_n(e,t,Ht);var r=lt(t),a=st(t),l=fi(t),s=gi(t),c=0,u=rnd2=0;Y&&(u=io(),rnd2=io());var d=0,f=xe(t);return r&&(d++,rn(e,i=getusernamefromacct(o),r,l,0*d+u,!1,f)),a&&(d++,an(e,_=getpasswordfromacct(o),a,l,0*d+u+rnd2,s,f)),_n(e,t,Vt),!0}function fn(e,t,n){if(!t)return!1;CPWbot_bg.do_milestone(e,pe,t);var i=!1;W=!1;var _=ct(t);if(_){var o=DEFAULT_CLICK_DELAY,r;void 0!==t.login_delay&&(o=t.login_delay),W=!0,ln(e,_,o,xe(t)),CPWbot_bg.mark_timestamp("wait_for_click_ack_M"),i=!0}return _n(e,t,Ot)&&(i=!0),!i||null}function gn(e,t,n){if(!t||!n)return!1;Ni(mi,"Updating with New Password");var i=!0,_=n.aid;console_log("cpwbot initiate: save_replace for aid="+_);var o=on(_),r,a;if(!o)return J_("given invalid aid - data consistency error?"),!1;var r=lpdec_acct(n.newpw,o,"undefined"==typeof g_shares?lpshares:g_shares),a=lpdec_acct(n.curpw,o,"undefined"==typeof g_shares?lpshares:g_shares);if(o&&r&&a)if(o.pwprotect&&(i=!1),console_log("cpwbot initiate: calling changepw logic for aid="+_),g_isfirefox)(i||LP.securityPrompt())&&lpchangepw(null,r,_,null,null,null,!0);else{var l={singleaid:_.toString(),newpw:r,autochange:1};i?changepw_wrapper(l):security_prompt(function(){changepw_wrapper(l)})}else verbose_log("no passwords to save? acct.aid = "+(o?o.aid:"null")+" cur="+(g_show_pw_in_logs||g_isadmin?a:"REDACTED")+" newpw="+(g_show_pw_in_logs||g_isadmin?r:"REDACTED"));return!0}function pn(e){if(verbose_log("entered cpwbot_cs_finish to clean up "+e),null!==i)if(i==e){var t={aid:r,recipe:o,desc:"cpwbot_finish"};g_v2engine?CPWbot_bg.wait_for_doc_complete(e,null,function(e){verbose_log("cpwbot_finish callback!  on tabid="+e),sendCS(e,{cmd:"cpwbot_finish"},"all")},t):sendCS(e,{cmd:"cpwbot_finish"})}else null!==i&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+e+" g_pwchangetabid="+i)}function bn(e){var t=[],n=[FN_CPW_OTHER,FN_CURRENT_PASS,FN_NEW_PASS,FN_NEW_PASS_CONFIRM],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function vn(e){var t=[],n=[FN_CPW_INVALID],i,_;for(i=0;i<n.length;i++){var o=Kn(e,n[i]);if(o&&o.length>0)for(_=0;_<o.length;_++){var r=o[_];r&&t.push(r)}}return t}function mn(e){var t=[],n=[FN_CURRENT_PASS,FN_NEW_PASS,FN_NEW_PASS_CONFIRM],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}}function Cn(e){var t=[],n=[FN_PASSWORD,FN_LOGIN_OTHER],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function hn(e){var t=[],n=[FN_LOGIN_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Nn(e){var t=[],n=[FN_LOGIN_ENTRY_USERNAME,FN_LOGIN_ENTRY_PASSWORD,FN_LOGIN_ENTRY_SUBMIT],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Sn(e){var t=[],n=[FN_LOGIN_ENTRY_USERNAME],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Ln(e){var t=[],n=[FN_LOGIN_ENTRY_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function En(e){var t=[],n=[FN_LOGIN_SUCCESS],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Pn(e){var t=[],n=[FN_LOGIN_SUCCESS_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function wn(e){var t=[],n=[FN_LOGIN_ENTRY_SUCCESS],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function In(e){var t=[],n=[FN_LOGIN_ENTRY_SUCCESS_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function An(e){var t=[],n=[FN_CPW_SUCCESS],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Tn(e){var t=[],n=[FN_CPW_SUCCESS_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function On(e){var t=[],n=[FN_IS_LOGGED_IN],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function kn(e){var t=[],n=[FN_IS_LOGGED_IN_NEGATION],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Fn(e){var t=[],n=[FN_CHALLENGE_PASSWORD,FN_CHALLENGE_OTHER],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Wn(e){var t=[],n=[FN_CHALLENGE_INVALID],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Gn(e){return Ct(recipe_obj,FN_CHALLENGE_SUCCESS)}function yn(e){return Ct(recipe_obj,FN_CHALLENGE_SUCCESS_INVALID)}function Dn(e){var t=[],n=[FN_CAPTCHA],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Un(e){var t=[],n=[FN_MULTI_FACTOR],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Rn(e){var t=[],n=[FN_PASSWORD_HINT],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Mn(e){var t=[],n=[FN_CAPTCHA,FN_PASSWORD_HINT,FN_MULTI_FACTOR],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function jn(e){var t=[],n=[FN_CAPTCHA_SUCCESS,FN_PASSWORD_HINT_SUCCESS,FN_MULTI_FACTOR_SUCCESS],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Hn(e){var t=[],n=[FN_FAKEUI_LOGGED_IN_1,FN_FAKEUI_LOGGED_IN_2,FN_FAKEUI_LOGGED_IN_3],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Vn(e){var t=[],n=[FN_FAKEUI_LOGGED_OUT_1,FN_FAKEUI_LOGGED_OUT_2,FN_FAKEUI_LOGGED_OUT_3],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Jn(e){var t=[],n=[FN_FAKEUI_LOGGED_IN_INPUT],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Bn(e){var t=[],n=[FN_FAKEUI_LOGGED_OUT_INPUT],i;for(i=0;i<n.length;i++){var _=Kn(e,n[i]);_&&_.length>0&&(t=t.concat(_))}return t}function Kn(e,t){var n=[],i,_,o;if(!e||!e.field_info)return n;for(i=0;i<e.field_info.length;i++)(_=e.field_info[i]).id_function==t&&(o={id_type:_.id_type,id_value:_.id_value},n.push(o));return n}function Yn(e){var t=DEFAULT_VALIDATE_TIMEOUT;if(!e)return t;if(void 0!==e.validate_timeout){var n=parseInt(e.validate_timeout);n&&!isNaN(n)&&(t=n)}return t}function xn(e,t,n){if(null===n&&(n=1),null===e||!t)return!1;var i=t.desc,_=t.recipe,o=t.fn_url_failed,r=t.fn_url_success,c=t.fn_required,u=t.fn_rejected,g=t.fn_captcha;Xi=!0,zi=(new Date).getTime(),y=!1,D=!1;var p=!0;console_log("cpwbot check_tab_for_state for "+i);var b=c?c(_):[],v=u?u(_):[],m=CPWbot_bg.JSON.stringify(b),C=CPWbot_bg.JSON.stringify(v),h=Mn(_),N=CPWbot_bg.JSON.stringify(h);if(d=Ri(e),0==b.length&&0==v.length&&!r&&!o)return L("WARN: "+i+" has no field or url criteria defined to validate against"),!0;var S=Yn(_),E=r?r(_):null,P=o?o(_):null,w=(new Date).getTime();null===w&&(w=0);var I,A=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+i+w.toString());l=A,m_=m,C_=C,verbose_log("interrogate id="+l+" desc="+i),f=[];var T={cmd:"cpwbot_validate_state",desc:i,required_fields:m,rejected_fields:C,id:l,validate_timeout:S,timestamp:w,proceed_on_interactive:ai(_)?1:0,interactive_fields:N};return E&&(T.required_url=E),P&&(T.rejected_url=P),a=T,s=i,sendCS(e,T,"all"),verbose_log("setup setimeout for "+S/1e3+" seconds finish_cpwbot_validate_state"),setTimeout(function(){CPWbot_bg&&CPWbot_bg.finish_cpwbot_validate_state(e,A,m,C,i)},S),null}function qn(){return null}function zn(e,t,n,i){if(i||!CPWbot_bg.get_docaptchastate()){t?Re(t):t=Ue(),n||(n=o);var _={msg:t,symbolic:no(n)},r=CPWbot_bg.JSON.stringify(_);sendCS(e,{cmd:"do_cpwbot_overlay",msg:r},g_CS_tops[e])}}function Xn(e){return sendCS(e,{cmd:"hide_cpwbot_overlay"},"all"),!0}function Zn(e){var t=null;return e?(void 0!==e.generate_pref_overrides&&(t=e.generate_pref_overrides),t):t}function Qn(e){var t=0;return e?(void 0!==e.postacctmgmt_sleep&&(t=e.postacctmgmt_sleep),t):null}function $n(e){var t=0;return e?(void 0!==e.postrevealcpw_sleep&&(t=e.postrevealcpw_sleep),t):null}function ei(e){var t=0;return e?(void 0!==e.posttrigger_sleep&&(t=e.posttrigger_sleep),t):null}function ti(e){var t=0;return e?(void 0!==e.postreveallogin_sleep&&(t=e.postreveallogin_sleep),t):null}function ni(e){var t=0;return e?(void 0!==e.postlogout_sleep&&(t=e.postlogout_sleep),t):null}function ii(e){var t=!1;return e?(void 0!==e.reveal_login_js_delay&&(t=!!e.reveal_login_js_delay),t):null}function _i(e){var t=!1;return e?(void 0!==e.navigate_acctmgmt_js_delay&&(t=!!e.navigate_acctmgmt_js_delay,"0"===e.navigate_acctmgmt_js_delay&&(t=!1)),t):null}function oi(e){var t=!1;return e?(void 0!==e.reveal_cpw_js_delay&&(t=!!e.reveal_cpw_js_delay,"0"===e.reveal_cpw_js_delay&&(t=!1)),t):null}function ri(e){var t=!1;return e?(void 0!==e.logout_js_delay&&(t=!!e.logout_js_delay,"0"===e.logout_js_delay&&(t=!1)),t):null}function ai(e){var t=!1;return e?(void 0!==e.proceed_on_interactive&&(t=!!e.proceed_on_interactive,"0"===e.proceed_on_interactive&&(t=!1)),t):null}function li(e){var t=0;return e?(void 0!==e.start_delay&&(t=e.start_delay),t):null}function si(e){var t=0;return e?(void 0!==e.post_login_submit_delay&&(t=e.post_login_submit_delay),t):null}function ci(e){var t=0;return e?(void 0!==e.post_js_begin_delay&&(t=e.post_js_begin_delay),t):null}function ui(e){var t=0;return e?(void 0!==e.js_finish_delay&&(t=e.js_finish_delay),t):null}function di(e){var t=0;return e?(void 0!==e.session_timeout&&"number"==typeof e.session_timeout&&(t=e.session_timeout),t):null}function fi(e){var t=0;return e?(void 0!==e.click_on_fields_on_fill&&(t=e.click_on_fields_on_fill?1:0),t):null}function gi(e){var t=0;return e?(void 0!==e.fill_password_fields_via_keys&&(t=e.fill_password_fields_via_keys?1:0),t):null}function pi(e){if(!e)return null;var t=DEFAULT_FILL_DELAY;return"number"==typeof e.fill_field_delay&&(t=e.fill_field_delay),verbose_log("fill field delay : "+t),t}function bi(e){var t=!1;return e?(void 0!==e.document_complete_timeout&&(t=e.document_complete_timeout),t):null}De[q]="",De[1]=gs("LastPass is loading..."),De[2]=gs("LastPass is loading website..."),De[Z]=gs("LastPass is logging in..."),De[Q]=gs("LastPass is changing your password now..."),De[$]=gs("LastPass is changing your password now..."),De[ee]=gs("LastPass is changing your password now..."),De[te]=gs("LastPass is changing your password now..."),De[8]=gs("LastPass is logging in..."),De[ie]=gs("The website needs you to enter information. Please switch to the tab and enter it."),De[63]=gs("Congratulations! Your password for %s was updated, and is now saved in your LastPass vault. Your change will sync on every device."),De[me]=gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),De[ye]=De[me]+" "+gs("The random password that was generated has been saved to your vault."),De[we]=De[me],De[Le]=gs("Timed out waiting for the page to load.  Retry?"),De[he]=De[me],De[Ce]=De[me],De[Ee]=De[me],De[Pe]=De[me],De[Ne]=De[me],De[Se]=De[me],De[Ie]=De[me],De[Ae]=gs("Halt Requested"),De[Te]=gs("Unable to proceed, the website does not allow automated password change."),De[Oe]=gs("Timed out"),De[ke]=De[me],"function"==typeof alertfrombg&&(this.alert=alertfrombg),g_isfirefox&&(this.alert=alert),this.JSON=JSON,JSON||(this.JSON=LPJSON),LPJSON,this.get_pwchangestate=function(){return n},this.get_pwchangetabid=function(){return i},this.get_login_url=function(e){return je(e)},this.get_cpw_url=function(e){return He(e)},this.get_acctmgmt_url=function(e){return Ve(e)},this.conditional_js_exec=function(e,t,n){return _n(e,t,n)},this.show_cpwbot_overlay=function(e,t,n){return zn(e,t,n)},this.in_validate=function(){return a&&l&&null!=s&&""!=s&&void 0!==s},this.in_validate_outer=function(){return e.in_validate()||Xi||g_},this.get_last_overlay_message=function(){return Ue()},this.get_fakeui_loggedout_url=function(e){return Ke(e)},this.get_fakeui_loggedin_url=function(e){return Ye(e)},this.reveal_cpw=function(e,t){if(!t)return!1;var i=t.recipe,r=t.payload,a=r.aid;if(!i||!r)return!1;L("reveal_cpw called after wait-for-document-complete tabid="+e),CPWbot_bg.mark_timestamp("reveal_cpw"),Ni(mi,"Reveal Change-Password Form"),n="D",p=!1,_n(e,i,ht);var l=He(i);if(l){L("call cpw:loadurl with "+l);var s=null;return g_CS_tops&&(s=g_CS_tops[e],g_ischrome&&0!=s&&L("loadurl is not sending to docnum==0 ! "+s)),sendCS(e,{cmd:"loadurl",url:l},s),n_=!0,verbose_log("m_in_loadurl set"),o=i,_=r,p=!0,null}I=!1;var c=$e(i),u;if(c){verbose_log("click on FN_NAVIGATE_TO_CPW field!");var d=DEFAULT_CLICK_DELAY,f;void 0!==i.cpw_delay&&(d=i.cpw_delay),I=!0,L("now waiting for click_ack_D"),ln(e,c,d,xe(i)),CPWbot_bg.mark_timestamp("wait_for_click_ack_D")}return oi(i)&&(p=!0,$n(i))?null:(_n(e,i,Nt),t.didcallout?(L("end of reveal_cpw thread with callout to CS - hack Dpickup to resume for aid="+a),n="Dpickup",null):(L("no callout to CS, so reveal_cpw does not end thread, returning to initiate"),!0))},this.navigate_to_acctmgmt=function(e,t){if(!t)return!1;var i=t.recipe,r=t.payload,a=r.aid;if(L("navigate_to_acctmgmt called after wait-for-document-complete tabid="+e),CPWbot_bg.mark_timestamp("acctmgmt_nav"),n="C",!i)return!1;Ni(mi,"Navigate to Account Management Page"),b=!1,_n(e,i,St);var l=Ve(i);if(l){L("call acctmgmt:loadurl with "+l);var s=null;return g_CS_tops&&(s=g_CS_tops[e]),sendCS(e,{cmd:"loadurl",url:l},s),n_=!0,verbose_log("m_in_loadurl set"),o=i,_=r,b=!0,null}w=!1;var c=et(i),u;if(c){verbose_log("click on FN_NAVIGATE_TO_ACCTMGMT field!");var d=DEFAULT_CLICK_DELAY,f;void 0!==i.acctmgmt_delay&&(d=i.acctmgmt_delay),w=!0,L("now waiting for click_ack C"),ln(e,c,d,xe(i)),CPWbot_bg.mark_timestamp("wait_for_click_ack_C")}return _i(i)&&(b=!0,Qn(i))?null:(_n(e,i,Lt),t.didcallout?(L("end of navigate_to_acctmgmt thread with callout to CS - hack Cpickup to resume for aid="+a),n="Cpickup",null):(g_v2engine||L("no callout to CS, so nav_to_acctmgmt does not end thread, returning to initiate"),!0))},this.trigger_cpw=function(e,t){if(K)return!1;if(K=!0,verbose_log("trigger_cpw entered"),CPWbot_bg.mark_timestamp("trigger_cpw"),!t)return!1;var i=t.recipe,o=t.payload;if(!i||!o)return!1;var r=fi(i),a=gi(i);L("trigger_cpw called after wait-for-document-complete tabid="+e),n="E";var l=!0,s=o.aid,u=on(s),d="";if(!u)return J_("given invalid aid - data consistency error?"),!1;d=u.url,_n(e,i,Et);var f=Xe(i),g=Ze(i),p=Qe(i),b=nt(i),v=xe(i),m=15,C=1,h=1,N=1,S=0,P=1,w=0,I=1,A=null,T,O;g_isfirefox?(LP.lpprefsHasUserValue("genpw_passlen")&&(m=LP.lpprefsGetIntPref("genpw_passlen")),LP.lpprefsHasUserValue("genpw_upper")&&(C=LP.lpprefsGetBoolPref("genpw_upper")?1:0),LP.lpprefsHasUserValue("genpw_lower")&&(h=LP.lpprefsGetBoolPref("genpw_lower")?1:0),LP.lpprefsHasUserValue("genpw_digits")&&(N=LP.lpprefsGetBoolPref("genpw_digits")?1:0),LP.lpprefsHasUserValue("genpw_special")&&(S=LP.lpprefsGetBoolPref("genpw_special")?1:0),LP.lpprefsHasUserValue("genpw_mindigits")&&(P=LP.lpprefsGetIntPref("genpw_mindigits")?1:0),LP.lpprefsHasUserValue("genpw_ambig")&&(w=LP.lpprefsGetBoolPref("genpw_ambig")?1:0),LP.lpprefsHasUserValue("genpw_reqevery")&&(I=LP.lpprefsGetBoolPref("genpw_reqevery")?1:0),LP.lpprefsHasUserValue("genpw_pronounceable")&&(A=LP.lpprefsGetBoolPref("genpw_pronounceable")?1:0)):(m=parseInt(lpGetPref("generate_length",m)),C=parseInt(lpGetPref("generate_upper",C)),h=parseInt(lpGetPref("generate_lower",h)),N=parseInt(lpGetPref("generate_digits",N)),S=parseInt(lpGetPref("generate_special",S)),P=parseInt(lpGetPref("generate_mindigits",P)),w=parseInt(lpGetPref("generate_ambig",w)),I=parseInt(lpGetPref("generate_reqevery",I)),A=parseInt(lpGetPref("generate_pronounceable",A))),0==C&&0==h&&0==N&&0==S&&(C=h=N=1);var k=getpasswordfromacct(u);k.length>m&&(m=k.length);var F=Zn(i);null!==F&&(void 0!==F.length&&null!==F.length&&(m=F.length),void 0!==F.maxlength&&null!==F.maxlength&&m>F.maxlength&&(m=F.maxlength),void 0!==F.minlength&&null!==F.minlength&&m<F.minlength&&(m=F.minlength),void 0!==F.special&&null!==F.special&&(S=F.special?1:0),void 0!==F.digits&&null!==F.digits&&(N=F.digits?1:0),void 0!==F.upper&&null!==F.upper&&(C=F.upper?1:0),void 0!==F.lower&&null!==F.lower&&(h=F.lower?1:0),void 0!==F.mindigits&&null!==F.mindigits&&(P=F.mindigits)),Ni(mi,"Generating a new password that is "+m+" chars long, "+(C?"with":"without")+" uppercase chars, "+(h?"with":"without")+" lowercase chars, "+(N?"with":"without")+" numeric chars, "+(S?"with":"without")+" special chars, with at least "+P+" numbers,");var W,G=(g_isfirefox?LP.lpCreatePass:lpCreatePass)(m,C,h,N,S,P,w,I,A);L("generated new password: "+(g_show_pw_in_logs||g_isadmin?G:"REDACTED")),L("saving "+(g_show_pw_in_logs||g_isadmin?G:"REDACTED")+" to "+d+" as generated password"),g_isfirefox?ff_save_generated_password(G,d,!0,!0):savePassword(G,d,e,1),g_isfirefox?null!==LP.lpgenpwlist&&LP.lpgenpwlist.unshift(G):null!==g_genpws&&g_genpws.unshift(G),CPWbot_bg.do_milestone(e,73,i),o.newpw=lpenc_acct(G,u,"undefined"==typeof g_shares?lpshares:g_shares),o.curpw=lpenc_acct(k,u,"undefined"==typeof g_shares?lpshares:g_shares),_=o,c=o.newpw,Ni(mi,"Filling Change-Password Form");var y=pi(i),D=rnd2=rnd3=rnd4=0;Y&&(D=io(),rnd2=io(),rnd3=io(),rnd4=io());var U=0;if(f&&an(e,k,f,r,y*(U+=1)+D,a,v),g&&an(e,G,g,r,y*(U+=1)+D+rnd2,a,v),p&&an(e,G,p,r,y*(U+=1)+D+rnd2+rnd3,a,v),b){E=!0,L("now waiting for click_ack E");var R=null;void 0!==i.trigger_cpw_delay&&(R=i.trigger_cpw_delay),verbose_log("trigger cpw delay : "+R+" + "+y*U);var M=R,v;ln(e,b,M=null===R?y*U:R+y*U+rnd4,v=xe(i)),CPWbot_bg.mark_timestamp("wait_for_click_ack_E")}return pass,_n(e,i,Pt),t.didcallout?(L("end of trigger_cpw thread with callout to CS - hack Epickup to resume for aid="+s),n="Epickup",null):(L("no callout to CS, so trigger_cpw does not end thread, returning to initiate"),!0)},this.navigate_to_login=function(e,t){if(!t)return!1;var i=t.recipe;if(n="B",g=!1,!i)return!1;var r=!1;Ni(mi,"Navigate to Login");var a=je(i),l;if(a){L("call login:loadurl with "+a);var s=null;return g_CS_tops&&(s=g_CS_tops[e],g_ischrome&&0!=s&&L("loadurl is not sending to docnum==0 ! "+s)),sendCS(e,{cmd:"loadurl",url:a},s),n_=!0,verbose_log("m_in_loadurl set"),o=i,_=t,g=!0,null}return!g_v2engine&&(ii(i)&&(g=!0,ti(i))?null:(_n(e,i,At),!0))},this.check_is_logged_in=function(e,t,n){if(!t)return!1;var i,_={recipe:t,desc:"validate_website_is_loggedin",fn_required:On,fn_rejected:kn,fn_url_success:qn,fn_url_failed:qn},i=null,o,r;return CPWbot_bg.should_wait_for_document_complete(e,_)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,_),null):(L("validate_website_is_loggedin returns true, no wait "),!0)},this.validate_login_success=function(e,t,n){if(!t)return!1;_n(e,t,kt);var i={recipe:t,desc:"validate_login_success",fn_required:En,fn_rejected:Pn,fn_url_success:zt,fn_url_failed:qt};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_login_success returns true, no wait "),!0)},this.validate_login_entry_success=function(e,t,n){if(!t)return!1;_n(e,t,Jt);var i={recipe:t,desc:"validate_login_entry_success",fn_required:wn,fn_rejected:In,fn_url_success:Zt,fn_url_failed:Xt};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_login_entry_success returns true, no wait "),!0)},this.validate_cpw_success=function(e,t,n){if(!t)return!1;_n(e,t,Ft);var i={recipe:t,desc:"validate_cpw_success",fn_required:An,fn_rejected:Tn,fn_url_success:Yt,fn_url_failed:xt};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_cpw_success returns true, no wait "),!0)},this.validate_login_form=function(e,t,n){if(!t)return!1;var i={recipe:t,desc:"validate_login_form",fn_required:Cn,fn_rejected:hn,fn_url_success:qn,fn_url_failed:qn};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_login_form returns true, no wait "),!0)},this.validate_cpw_form=function(e,t,n){if(!t)return!1;var i={recipe:t,desc:"validate_cpw_form",fn_required:bn,fn_rejected:vn,fn_url_success:qn,fn_url_failed:qn};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_cpw_form returns true, no wait "),!0)},this.validate_login_entry_form=function(e,t,n){if(!t)return!1;var i={recipe:t,desc:"validate_login_entry_form",fn_required:Sn,fn_rejected:Ln,fn_url_success:qn,fn_url_failed:qn};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_login_entry_form returns true, no wait "),!0)},this.revert_password=function(e,t,n){return!!t&&(alert("REVERT: TODO"),!0)},this.initiate=function(e,t,n,i){},this.cpwbot_cs_finish_complete=function(e){verbose_log("cpwbot_cs_finish_complete on tabid="+e),i==e?(null!==CPWbot_bg.session_timeout_st_id&&clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null,null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=null,CPWbot_bg.mark_timestamp("finish_complete"),CPWbot_bg.logout(),Xn(e),CPWbot_bg.do_milestone(e,66,null)):null!==i&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+e+" g_pwchangetabid="+i)},this.finish_cpwbot_validate_state=function(e,t,_,c,u){verbose_log("ENTERED finish_cpwbot_validate_state");var g=!1,p,b=!1;if(i!=e)return verbose_log("finish_cpwbot_validate_state: !tabid, abort"),!1;if(t!=l){var v="";return verbose_log("finish_cpwbot_validate_state: ignoring stale request, current validate is "+s+"/"+l+", stale req is "+u+"/"+t+" "),!1}var m,C=Yn(o),h=l;if(y&&!D)return y=!1,D=!0,L("finish_cpwbot_validate_state: reload1 extending timeout for "+u),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(e,h,_,c,u)},C),!1;if(verbose_log("finish_cpwbot_validate_state: closing out request "+u+"/"+t),null===f)return verbose_log("finish_cpwbot_validate_state: dup, abort"),!1;if(null===g_CS[e])return lploggedin?(L("finish_cpwbot_validate_state: reload2 extending timeout for "+u),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(e,h,_,c,u)},C),!1):(verbose_log("finish_cpwbot_validate_state: tab "+e+" closed "),CPWbot_bg.panic("logged out?"),!1);var N=d;for(g_CS[e].length==f.length&&(b=!0),p=0;p<f.length;p++)if(f[p]){g=!0;break}b||verbose_log("finish_cpwbot_validate_state: sent out "+g_CS[e].length+" messages, received "+f.length+" messages, skipped "+N+" frames");var S=0,E=0,P;for(P in G)G.hasOwnProperty(P)&&(this.skip_frame_by_score(P)||(S++,f[P]&&E++));if(E<S&&console_warn("CASE : still waiting to hear from important frames, expected to hear from "+S+", heard from "+E),!g){var w=JSON.parse(_),I=JSON.parse(c);0==w.length&&I.length>0&&(g=!0)}if(f=null,a=null,d=0,g_v2engine)Xi=!1,g_=!1,L("VALIDATE_IN_DOCWAIT=false"),p_=g,b_={},console_log("finish_cpwbot_validate_state complete result="+g+", wait for next engine cycle at "+n),pass;else{var A={aid:r,recipe:o,validate_result:g};console_log("finish_cpwbot_validate_state resumed initiate with state="+n),CPWbot_bg.initiate(e,A,n)}return!1},this.chk_cpw_resume=function(e,t){return!1},this.cpwbot_validate_state_result_handler=function(e,t){var _=!1;if(CPWbot_bg&&null!==i&&e==i){var o=t.docnum;if(void 0!==o&&CPWbot_bg&&null!==f){var r=JSON.parse(t.result),c=JSON.parse(t.rejected_fields),u=JSON.parse(t.required_fields),d=!1,g=null;t.result_obj&&(g=JSON.parse(t.result_obj));var p=t.desc,b=t.id;if(L("received a "+p+" validate result from ["+e+"]["+o+"]["+t.url+"]["+t.docstate+"]["+t.state+"]="+r),s&&s!=p||l&&l!=b)return L("unexpected validate msg - perhaps from the last validate call.... ignoring it"),void L("got "+p+"/"+b+" expected "+s+"/"+l);var v=!1;g&&(t.required_url&&Ni(vi,"["+e+"]["+o+"] validate given success_url, result="+g.url_success_match+" when matching success url = "+t.required_url),t.rejected_url&&Ni(vi,"["+e+"]["+o+"] validate given bad_url, result="+g.url_failure_match+" when matching failure url = "+t.rejected_url),Ni(vi,sprintf("[%s][%d] %s found %d/%d success fields, given %d invalid fields and %s invalid fields, %s captcha-ish fields",e,o,p,g.num_ok_matches,g.num_okfields,g.num_badfields,g.found_bad_match?"found":"did not find",g.found_interactive?"found":"did not find")),g.num_ok_matches>0?(Gi(e,t),g.found_interactive&&(v=!0)):g.found_bad_match?(Gi(e,t),v=!0):yi(e,t),g.found_interactive&&(d=!0)),f[o]=r;var m=Ri(e);if(null===g_CS[e]&&CPWbot_bg&&a)return L("interrupted by a page load/refresh, reissuing validate for state "+n),f=[],void sendCS(e,a,"all");g_CS[e]&&g_CS[e].length==f.length&&(_=!0),null===g_CS[e]?verbose_log("tab is reloading but cannot retry validate ? WTF"):verbose_log("["+e+"] "+p+" sent "+g_CS[e].length+" messages, heard from "+f.length+", skipped "+m+" frames"),(r||_||v||d)&&(f=null,null===r&&(r=!1),a=null,Xi=!1,g_=!1,L("VALIDATE_IN_DOCWAIT=false"),L("validate complete, result is "+r+" current state="+n),p_=r,b_=g)}else debug&&L("stale2? validate result tabid="+e+" g_pwchangetabid="+i+" g_pwchange_validate_desc="+s)}else debug&&L("stale1? validate result tabid="+e+" g_pwchangetabid="+i+" g_pwchange_validate_desc="+s)},this.cpwbot_finish_ack_handler=function(e,t){if(null!==e&&t)if(sendCS(e,{cmd:"cpwbot_finish_ack"},"all"),sendCS(e,{cmd:"hide_cpwbot_overlay"},"all"),g_CS_tops[e]==t.docnum)CPWbot_bg.cpwbot_cs_finish_complete(e);else{if(null==g_CS_tops[e]||void 0===g_CS_tops[e])console_error("webpage has not finished loading");else{console_error("WTF : top "+g_CS_tops[e]+" but docnum is "+t.docnum);var n=getcsinfo(e,t.docnum),i=getcsinfo(e,g_CS_tops[e]);i&&verbose_log("["+g_CS_tops[e]+"] topdoc is "+i.url),n&&verbose_log("["+t.docnum+"] other doc is "+n.url),n&&n.parent_docnum==n.docnum?verbose_log("CS table says that "+t.docnum+" is top"):i&&i.parent_docnum==i.docnum?verbose_log("CS table says that "+g_CS_tops[e]+" is top"):verbose_log("CS table mismatch, or reloading ? ")}CPWbot_bg.cpwbot_cs_finish_complete(e)}},this.cpwbot_skip_url=function(e,t){return!1},this.originating_tabid=null,this.destination_tabid=null,this.originating_tab=null,this.destination_tab=null,this.logout=function(){n=null,r=null,o=null,_=null,a=null,s=null,l=null,t=0,i=null,c=null,Me(),S=!1,N=!1,G=null,y=!1,D=!1,u=null,this.clear_event_queue(),A=!1,T=!1,w=!1,I=!1,F=!1,E=!1,W=!1},this.initialize=function(e){e?(i=e.tabid,debug&&(N_=e.tabid),o=e.recipe,r=e.aid,n=0,Me(),N=!1,E=!1,S=!1,g_robots_txt&&sendCS(e.tabid,{cmd:"get_robots_txt"},g_CS_tops[e.tabid]),G={},y=!1,D=!1,u=null,Ji="",U=!1,R=!1,j=!1,H=!1,V=!1,J=!1,B=!1,e_=0,CPWbot_bg.clear_event_queue(),R_=1,wi(),K=!1,CPWbot_bg.broken_hearted_st_id=null,n_=!1,i_=!1,__=!1,o_=!1,E_=0,this.cpw_dialog_minimize_state=0):console_error("passed invalid params")},this.pwchangetabid_is_still_valid=function(){if(!CPWbot_bg)return!1;var e=i;return!(null===e||!g_CS||void 0===g_CS[e]||null===g_CS[e])},this.panic=function(e){e||(e="UNEXPECTED ERROR"),L("panic="+e+", g_pwchangetabid == "+i),CPWbot_bg.do_milestone(i,me,o,e),pn(i),CPWbot_bg.cpwbot_cs_finish_complete(i)},this.setmsg_cpwbot_overlay=function(e,t){zn(e,t)},this.initiate_on_complete=function(e,t,n){var i=null,_=900,o=45;if(!g_cpwbot||!CPWbot_bg||n>45)return CPWbot_bg.do_milestone(e,Le,a,"initiate_on_complete"),CPWbot_bg.panic("TIMEOUT-initiate"),null;var r=t.aid,a=t.recipe;if(void 0!==n&&null!==n||(n=1),!Li(a)){var l=on(r),s="(null)";l&&l.url&&(s=this.JSON.stringify(l.url));var c="Bad Recipe";Ni(hi,c);var u="Error for recipe on aid="+r+", url="+s,d={severity:"fatal",msg:c};return CPWbot_bg.phone_home(null,null,d),CPWbot_bg.panic(u),null}if(!I_){var f=bi(a);f||(f=_);var g=g_CS_tops[e];if(null!==g&&(i=getcsinfo(e,g_CS_tops[e]))&&"complete"==i.docstate){CPWbot_bg.mark_timestamp("doc_complete"),ping(e);var p=n?n*f/1e3:0;if(isNaN(p)&&verbose_log("WTF NaN: ctr="+n+" url="+s+" aid="+r),M_){var b=M_.doc_complete-M_.openurl_callback;b>0&&0!=M_.doc_complete&&M_.openurl_callback&&(p=b/1e3)}return p>0&&Ni(vi,"Waited "+p+" seconds for document-complete before calling initialize_engine"),CPWbot_bg.initialize_engine(e,t)}return I_||!lploggedin?(L("abort wait-for-doc-complete initiate"),!1):(null!==g?ping(e,g):ping(e),verbose_log("waiting for tabid "+e+" topdocnum="+g+" docstate="+(i?i.docstate:"null")),setTimeout(function(){CPWbot_bg.initiate_on_complete(e,t,n+1)},f),!0)}H_(e,a)},this.get_user_debug_messages=function(e,t){return h};var vi=0,mi=1,Ci=2,hi=3;function Ni(e,t){var n;if((e<vi||e>hi)&&(e=vi),g_isfirefox&&lpisadmin||g_isdebug||g_isadmin){var i="["+["DEBUG","INFO","WARN","ERR"][e]+"] "+t+"\n";return h+=i,verbose_log(i),write_history({cmd:"CPW",msg:i}),!0}return!1}function Si(e,t){var n=!1;if(!t||!e)return debug&&L("validate_xpath: none"),n;try{var i=g_isfirefox?new e.defaultView.XPathEvaluator:new XPathEvaluator;if(!i&&debug)return L("NO XPATH EVALUATOR AVAILABLE ????"),!0;var _=i.evaluate(t,e.documentElement,null,g_isfirefox?e.defaultView.XPathResult.FIRST_ORDERED_NODE_TYPE:XPathResult.FIRST_ORDERED_NODE_TYPE,null);n=!0}catch(e){console_error("error validating '"+t+"', exception: "+e),n=!1}return n}function Li(e){var t=g_isfirefox?LP.getBrowser().selectedTab.linkedBrowser.contentDocument:document,n,i,_;if(!t||!e)return L("Bad Recipe: none"),!1;if(!je(e))return L("Bad Recipe: no login url"),!1;if(!no(e))return L("Bad Recipe: no symbolic"),!1;if(!e.field_info||e.field_info.length<=0)return L("Bad Recipe: no fields"),!1;if(!Ei(e))return!1;var o=!1,r=!1,a=!1,l=!1,s=!1,c=!1,u=!1,d=!1,f=!1;for(n=0;n<e.field_info.length;n++)switch((i=e.field_info[n]).id_function){case FN_LOGIN:case FN_LOGIN_SUBMIT:case FN_PASSWORD:o=!0;break;case FN_CURRENT_PASS:case FN_NEW_PASS:case FN_NEW_PASS_CONFIRM:case FN_CPW_SUBMIT:s=!0;break;case FN_CPW_SUCCESS:case FN_CPW_SUCCESS_INVALID:c=!0;break;case FN_LOGIN_SUCCESS:case FN_LOGIN_SUCCESS_INVALID:a=!0;break;case FN_IS_LOGGED_IN:case FN_IS_LOGGED_IN_NEGATION:r=!0;break;case FN_NAVIGATE_TO_LOGOUT:d=!0}if((Yt(e)||xt(e)||Ft(e))&&(u=!0),(zt(e)||qt(e)||kt(e))&&(l=!0),Je(e)&&(f=!0),!(o&&r&&(a||l)&&s&&(d||f)&&(c||u)))return L("Bad Recipe for "+no(e)+": has_login_fields?"+o+" has_logged_in_fields?"+r+" has_login_success_fields?"+a+" has_login_success_alt?"+l+" has_logout_field?"+d+" has_logout_alt?"+f+" has_cpw_fields?"+s+" has_cpw_success_fields?"+c+" has_cpw_success_alt?"+u),!1;for(n=0;n<e.field_info.length;n++)if((i=e.field_info[n]).id_type==TYPE_XPATH){if(!Si(t,i.id_value))return L("Bad Recipe: bad xpath"),!1;if(i.id_value&&i.id_value.indexOf("@clas,")>0)return L("Bad Recipe: @clas mispell"),!1}else if((i.id_type==TYPE_ID||i.id_type==TYPE_NAME)&&i.id_value&&(i.id_value.indexOf("//")>=0||i.id_value.indexOf("text()")>=0||i.id_value.indexOf("contents(")>=0))return L("Bad Recipe: xpath in non-xpath field def"),!1;return!0}function Ei(e){var t,n,i,_=!0,o={id_function:1,id_value:1,id_type:1};if(!e.field_info||e.field_info.length<=0)return!1;for(n=0;n<e.field_info.length;n++)for(i in(t=e.field_info[n])&&"number"!=typeof t.id_function&&(verbose_log(sprintf("field %s has invalid function '%s'",t.id_value,t.id_function)),_=!1),t)t.hasOwnProperty(i)&&(o[i]||(verbose_log(sprintf("found invalid field property '%s'",i)),_=!1));if(o={jsfrag:1,jstype:1},e.jsfrags&&e.jsfrags.length>0)for(n=0;n<e.jsfrags.length;n++)for(i in(t=e.jsfrags[n])&&"number"!=typeof t.jstype&&(verbose_log(sprintf("js with invalid type '%s'",t.jstype)),_=!1),t)t.hasOwnProperty(i)&&(o[i]||(verbose_log(sprintf("found invalid javascript property '%s'",i)),_=!1));if(o={length:1,maxlength:1,minlength:1,special:1,digits:1,upper:1,lower:1,mindigits:1},e.generate_pref_overrides)for(i in e.generate_pref_overrides)e.generate_pref_overrides.hasOwnProperty(i)&&(o[i]||(verbose_log(sprintf("found invalid generate preference '%s'",i)),_=!1));return _}function Pi(){return E||I||w||P||F||W||A||T}function wi(){E=!1,I=!1,w=!1,P=!1,F=!1,W=!1,A=!1,T=!1}function Ii(e,t,n){return!0}function Ai(e,t,n){var i;return Dn(t).length>0||pass,!1}function Ti(e,t,n){var i;return Un(t).length>0||pass,!1}function Oi(e,t,n){var i;return Rn(t).length>0||pass,!1}function ki(e,t,n){var i;return Mn(t).length>0}function Fi(e,t,n){var i;return jn(t).length>0}function Wi(e,t){}function Gi(e,t){var n=t.docnum,i=t.url,_=2;return null!==G&&(null!==G[n]&&void 0!==G[n]||CPWbot_bg.clear_frame_score(e,n,i),G[n]=G[n]+2,!0)}function yi(e,t){var n=t.docnum,i=t.url,_=-2;return null!==G&&(null!==G[n]&&void 0!==G[n]||CPWbot_bg.clear_frame_score(e,n,i),G[n]=G[n]+-2,!0)}function Di(e,t){}function Ui(e,t,n){}function Ri(e){if(null===G||null===e)return 0;var t,n=0,i,_;for(i in CS_table)CS_table.hasOwnProperty(i)&&(_=CS_table[i]).tabid===e&&(t=_.docnum,(CPWbot_bg.skip_frame_by_score(t)||skip_CS_by_score(e,t))&&n++);return n}function Mi(){}function ji(e,t){return!0}function Hi(e,t,n){if(!t||!n)return!1;var i="",_="",o=on(n.aid);if(!o)return J_("given invalid aid - data consistency error?"),!1;L("pre-challenge-form-js"),_n(e,t,Gt);var r=rt(t),a=ot(t),l=fi(t),s=gi(t),c=pi(t),u=rnd2=0;Y&&(u=io(),rnd2=io());var d=0,f=xe(t);return r&&(d++,rn(e,i=getusernamefromacct(o),r,l,c*d+u,!1,f)),a&&(d++,an(e,_=getpasswordfromacct(o),a,l,c*d+u+rnd2,s,f)),L("post-challenge-form-js"),_n(e,t,yt),!0}function Vi(e,t,n){if(!t)return!1;var i=!1;k=!1;var _=at(t);if(_){var o=DEFAULT_CLICK_DELAY,r;void 0!==t.login_delay&&(o=t.login_delay),k=!0,ln(e,_,o,xe(t)),i=!0}return _n(e,t,Dt)&&(i=!0),!i||null}this.userlog=function(e,t){return Ni(e,t)},this.click_ack_handler=function(e,t){var n=t.docnum,i=t.url,_=t.docstate,o=t.msgid,r=t.pwchangestate,a=t.found;return L("[T:"+e+"][D:"+n+"] cpwbot click_ack on "+t.id_value+" found="+a+" url="+i+" docstate="+_+" pwchangestate="+r),u!=o?(console_error("response for last click request overlaps current click-wait, ignoring it, found="+a),L("m_pwchange_last_click_field_id="+u),L("found="+a+" msgid = "+o),a&&console_error("Bad Mojo"),!0):(a&&(E&&(E=!1),P&&(P=!1),I&&(I=!1),w&&(w=!1),A&&(A=!1),T&&(T=!1),F&&(F=!1),W&&(W=!1)),!0)},this.fill_ack_handler=function(e,t){var n=t.docnum,i=t.url,_=t.docstate,o=t.msgid,r=t.pwchangestate,a=t.found;return verbose_log(sprintf("[%s][%s] cpwbot fill ack on %s found=%s docstate=%s url=%s req_id=%s",e,t.docnum,t.id_value,t.found,t.docstate?t.docstate:"null",t.url?t.url:"null",t.req_id?t.req_id:"null")),!0},this.js_ack_handler=function(e,t){var n="";try{n=JSON.parse(t.result)}catch(e){console_warn("js_ack_handler: "+e)}return verbose_log(sprintf("[%s][%s] cpwbot js ack result=%s docstate=%s url=%s req_id=%s",e,t.docnum,n?ofa(n):"null",t.docstate?t.docstate:"null",t.url?t.url:"null",t.req_id?t.req_id:"null")),!0},this.check_for_robots=function(e,t,n){},this.check_robot_txt=function(e,t,n){if(g_robots_txt){if(!e)return!0;var i=je(e);if(null!==t){var _,o=0,r=t.split("\n"),a=!1,l=!1;for(o=0;o<r.length;o++)(0==(_=r[o]).length&&""==_||"\r"==_)&&(a=!1,l=!1),"#"!=_.charAt(0)&&(0!=_.indexOf("User-agent: LastPass")&&0!=_.indexOf("User-agent: *")?0!=_.indexOf("Disallow: /")||(l=!0):a=!0);return!a||!l}g_tmp_recipe=e}},this.score_frame=function(e,t){var n=t.docnum,i=t.url,_,o=-100,r=-100,a=0,l=100,s=lp_gettld_url(i),c=0,u=["doubleclick.net","appads.com","crwdcntrl.net","googleadservices.com","quantserve.com","questionmarket.com","advertising.com","zedo.com","checkm8.com","zvents.com","doubleclick.com","yldmgrimg.net","optmd.com","casalemedia.com","scorecardresearch.com","quotemedia.com","tacoda.net","daylife.com","brightcove.com","wibiya.com","clickability.com","stats.com","google-analytics.com","adfusion.com","2mdn.net","adsonar.com","everyclick.com","shopica.com","yeah.com","vectorportal.com","cnomy.com","phpbb.com","tracking101.com","revsci.net","revsci.com","atdmt.com","mmismm.com","googlesyndication.com","247realmedia.com","pointroll.com","bluekai.com","serving-sys.com","vizu.com","cleanprint.com","outbrain.com","tweetmeme.com","visiblemeasures.com","starwave.com","kaango.com","gabriels.net","overture.com","yieldmanager.net","2mdn.com","eyewonder.com","imgdownloads.com","liverail.com","adnxs.com","addthis.com","addthiscdn.com","imshopping.com","adtech.de","2o7.net","glanceguide.com","performgroup.com","undertone.com","undertonevideo.com","martiniadnetwork.com","chartbeat.net","omtrdc.net","zoomflow.com","crowdscience.com","imrworldwide.com","fwmrm.net","tremormedia.com","webtrends.com","adzerk.net","adzerk.com","qubitproducts.com","maxymiser.net","maxymiser.com","newrelic.com","mathtag.com","adroll.com","criteo.com","liveperson.com","getclicky.com","sitemeter.com","displaymarketplace.com","yieldmanager.com","media6degrees.com","betrad.com","360yield.com","adpredictive.com","burstnet.com","adtechus.com","adsafeprotected.com","turn.com","contextweb.com","p-td.com","lijit.com","rubiconproject.com","ru4.com","admeld.com","openx.net","pubmatic.com","localyokelmedia.com","qnsr.com","wrating.com","audienceiq.com","mydas.mobi","mopub.com","visualrevenue.com","adsymptotic.com","admob.com","adtrking.com","4dsply.com","adshostnet.com","adziff.com","33across.com","vindicosuite.com","securepaths.com","taboola.com","trk4.com","crwdcntrl.com","connexity.com","connexity.net","effectivemeasure.net","visualdna.com","amazon-adsystem.com","4dsply.com","adblade.com","doubleverify.com","technoratimedia.com","adjuggler.com","opbandit.com","iesnare.com","adexcite.com","adadvisor.net","agkn.com","dntx.com","revenuehits.com","tribalfusion.com"],d=["ads.cnn.com","metrics.post-gazette.com","ads.nwsource.com","adbox.sina.com.cn","ads.sina.com.cn","ad.afy11.net","avatar.cnn.com","ads.cnn.com","metrics.apple.com","trailers.apple.com","metrics.philly.com","adsatt.espn.go.com","player.ooyala.com","seg.sharethis.com","edge.sharethis.com","bender.spoutable.com","engine.spoutable.com"],f=["facebook.com/plugins","facebook.com/connect/xd_arbiter","youtube.com/embed/","platform.twitter.com/widget","platform.twitter.com/tweet_button","libsyn.com/embed","amazon.com/gp/widget"];for(g_CS_tops&&g_CS_tops[e]==t.docnum&&(a=l),_=0;_<u.length;_++)if(s==u[_]){a=o,c=1;break}if(!c)for(_=0;_<d.length;_++)if(i.indexOf(d[_])>=0){a=o,c=1;break}if(!c)for(_=0;_<f.length;_++)if(i.indexOf(f[_])>=0){a=r,c=1;break}return G&&(G[n]=a),a},this.score_topdoc=function(e,t,n){var i=100;if(null===G)return!1;null!==G[t]&&void 0!==G[t]||CPWbot_bg.clear_frame_score(e,t,n);var _=getcsinfo(e,t);return!!(_&&(state_param=_.flags,state_param&&state_param.has_frameset))||(G[t]=G[t]+i,!0)},this.clear_frame_score=function(e,t,n){var i=0;return null!==G&&(G[t]=0,!0)},this.reset_scores=function(e){return G=null,!0},this.skip_frame_by_score=function(e){if(null===G||null===e)return!0;var t=0;return L("skip? docnum ="+e+" score="+G[e]),G[e]<0},this.recompute_scores_for_tab=function(e){return!0},this.retry_validate=function(e,t){null===t&&(t="all"),a&&(f=[],sendCS(e,a,t))},this.wait_for_doc_complete=function(e,t,i,_,o,r){var a=900,l,s=_.aid,c,u=null,d=ai(_.recipe);o||(o=0);var f=bi(_.recipe);f||(f=a);var g=g_CS_tops[e];if(void 0===g&&(g=null),null!==t&&void 0!==t||(t=g),null!==t&&(l=getcsinfo(e,t))&&(u=l.docstate,b(l.docstate)&&b(r))){var p=o?o*f/1e3:0;return isNaN(p)&&verbose_log("WTF NaN: recursion_ctr="+o+" aid="+s),p>0&&Ni(vi,sprintf("Waited %d seconds for %s on [tabid:%s][docnum:%d] to execute %s",p,d?"interactive":"complete",e,t,_.desc)),null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()&&(g_=!1,L("WAITED DONE, calling "+_.desc+" VALIDATE_IN_DOCWAIT=false")),i(e,_)}return I_||!lploggedin||null===n?(L("abort wait-for-doc-complete "+_.desc),!1):(ping(e),verbose_log("waiting for tabid "+e+" topdocnum="+g+" passed_docnum="+t+" docstate="+(l?l.docstate:"null")+" last_state="+r),t!=g&&(console_error("edge case - top docnum changed due to page reload?  will wait for that instead"+t+"!="+g),t=g),setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.wait_for_doc_complete(e,t,i,_,o+1,u)},f),!0);function b(e){return d?"complete"==e||"interactive"==e:"complete"==e}},this.should_wait_for_document_complete=function(e,t){if(null===e||!t)return!1;var n=t.desc,i=t.recipe,_=!0,o=t.fn_url_failed,r=t.fn_url_success,a=t.fn_required,l=t.fn_rejected,s=a?a(i):[],c=l?l(i):[],u=t.target_url,d=t.target_field,f=t.target_js;if((void 0!==u&&null!==u||void 0!==d&&null!==d||void 0!==f&&null!==f)&&(_=!1),_){if(0==s.length&&0==c.length&&!r&&!o)return L("should_wait returns false, WARN: "+n+" has no field or url criteria defined to validate against"),!1}else if(!u&&!d&&!f)return L("should_wait returns false, no wait criteria, "+n),!1;return L("should_wait returns true for "+n+" is_validate="+_),!0},this.handle_challenge=function(e,t){},this.validate_challenge_page=function(e,t,n){if(!t)return!1;var i={recipe:t,desc:"validate_challenge_form",fn_required:Fn,fn_rejected:Wn,fn_url_success:$t,fn_url_failed:Qt};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_challenge_form returns false, no criteria to check, no wait"),!1)},this.force_validate_retry=function(e){y=e},this.validate_challenge_success=function(e,t,n){if(!t)return!1;_n(e,t,Ut);var i={recipe:t,desc:"validate_challenge_success",fn_required:Gn,fn_rejected:yn,fn_url_success:qn,fn_url_failed:qn};return CPWbot_bg.should_wait_for_document_complete(e,i)?(Xi=!0,CPWbot_bg.wait_for_doc_complete(e,null,xn,i),null):(L("validate_challenge_success returns true, no wait "),!0)};var Ji="";function Bi(e,t){null!==e&&null!==g_CS_tops[e]&&sendCS(e,{cmd:"do_result_div",msg:t},g_CS_tops[e])}function Ki(e){var t=g_CS_tops[e],n=getcsinfo(e,t);if(n&&n.flags)return n.flags.need_dynamic_delay}this.set_dialog_msg=function(e){return Ji=e,!0},this.get_dialog_msg=function(){return Ji},this.clear_dialog_msg=function(){return Ji="",!0},this.get_failstate=function(){return j},this.get_okstate=function(){return H},this.get_captchastate=function(){return V},this.get_docaptchastate=function(){return J},this.get_brokenheartstate=function(){return B},this.get_failpwsavedstate=function(){return A_},this.get_fail_pending=function(){return N},this.get_success_pending=function(){return S},this.show_selenium_ok=function(e){Bi(e,"OK")},this.show_selenium_fail=function(e){Bi(e,"FAIL")},this.preinit=function(){n="preinit",x=q,Me(),Ji="",h="",null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id),CPWbot_bg.broken_hearted_st_id=null,I_=!1,V=!1,J=!1,j=!1,B=!1,H=!1,A_=!1},this.do_milestone=function(e,t,n,i){var o=null;if(n||(n={symbolic:""}),x=t,void 0!==i&&null!==i||(i=""),"undefined"!=typeof Date){var r="",a=(new Date).toString();if(De[t]){var l=no(n);l||(l=gs("unnamed site")),o=sprintf(De[t],l)}switch(t){case 1:case 2:break;case Z:case 8:break;case Q:verbose_log("C: GOTO ACCTMGMT ");break;case $:verbose_log("D: REVEAL");break;case ee:verbose_log("E: TRIGGER");break;case te:verbose_log("F: VALIDATE");break;case ie:cn(e,n,_),_n(e,n,Bt),J=!0,g_isfirefox&&zn(e,gs("The website needs you to enter information. Please close this overlay and enter it."),n,!0),Xn(e),CPWbot_bg.session_timeout_st_id&&(clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null),CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=setInterval(function(){J&&xn(e,{desc:"docaptcha",recipe:n,fn_required:jn})},1e3);break;case 63:Ni(mi,"Saved and Replaced"),H=!0,(debug||g_isdebug)&&(Ni(mi,"showing selenium ok result"),CPWbot_bg.show_selenium_ok(e)),S=!0,CPWbot_bg.mark_timestamp("success");break;case 65:Ni(mi,g_v2engine?sprintf("[%s] v2 %s",a,gs("BEGIN")):sprintf("[%s] %s",a,gs("BEGIN")));break;case 66:Ni(mi,g_v2engine?sprintf("[%s] v2 %s",a,gs("End").toUpperCase()):sprintf("[%s] %s",a,gs("End").toUpperCase()));break;case 67:verbose_log("USER IS ALREADY LOGGED IN, SKIP LOGIN STATE"),Ni(mi,"Appears to be Logged Into Site");break;case be:case se:Ni(mi,"Filling Login Form");break;case pe:case ce:Ni(mi,"Submit Login Form");break;case ue:Ni(mi,"Going to Login"),verbose_log("B: GOTO LOGIN");break;case de:Ni(mi,"Perform Logout");break;case 72:1!=R_&&Ni(mi,sprintf("Adjusting for %s site, %6.2f",R_>1?"slow":"fast",R_));break;case 73:A_=!0,Ni(mi,"Generated Random Password and Saved to Vault");break;case me:r="UNEXPECTED ERROR";break;case Ne:r="FILL LOGIN FORM [PW CHALLENGE] FAILED!";break;case Se:r="SUBMIT LOGIN FORM [PW CHALLENGE] FAILED!";break;case Ee:r="Expected Change-Password Form";break;case Pe:r="Change Password Failed";break;case he:r="Expected Login Form";break;case Ce:case ke:r="Login to Website Failed!";break;case we:r="Unable to Save New Password";break;case Ie:r="Unable to Log Out of Website";break;case Le:r=gs("Timed out waiting for the page to load.  Retry?"),B=!0;break;case Oe:r="Session Timeout";break;case Ae:r="Halt Requested";break;case Te:V=!0,r="Interaction required; cannot proceed";break;case q:default:o=""}if((t&me)==me){j=!0,Ni(hi,r),(debug||g_isdebug)&&(Ni(mi,"showing selenium fail result"),CPWbot_bg.show_selenium_fail(e)),N=!0,CPWbot_bg.mark_timestamp("fail");var s={severity:"fatal",msg:sprintf("%s[debug=%s]",r,i)};CPWbot_bg.phone_home(e,n,s),A_&&(o=sprintf(De[ye],no(n)))}else 64==(64&t)&&(o="");if(o&&(zn(e,o,n),CPWbot_bg.set_dialog_msg(o)),CPWbatch&&CPWbatch.cpw_get_batchjob_state()!=F_NONE){var c="";63==t?c="OK":t==Le||t==Oe?c="TIMEOUT":(t&me)==me&&t!=Le&&t!=Oe&&(c="FAIL")}return CPWbatch&&CPWbatch.conditional_website_status_update({tabid:e,recipe:n,state:t,msg:o}),!0}};var Yi=null,xi=null,qi=null,zi=null,Xi=!1,Zi=!1,Qi=!1,Xi=!1,$i=[],e_=0,t_=[],n_=!1,i_=!1,__=!1,o_=!1,r_=!1,a_=!1,l_=!1,s_=!1,c_=!1,u_=!1,d_=!1,f_=!1,g_=null,p_=null,b_={},v_=null,m_=null,C_=null,h_=!1,N_=null,S_=null,L_=null,E_=0,P_=10,w_=null,I_=!1,A_=!1;function T_(e,t){var _=di(t);_||(_=DEFAULT_SESSION_TIMEOUT),null!==R_&&R_>0&&!isNaN(R_)&&(_*=R_);var o=CPWbot_bg.get_session();CPWbot_bg.session_timeout_st_id=setTimeout(function(){if(o==CPWbot_bg.get_session()){CPWbot_bg.mark_timestamp("session_timeout");var t=CPWbot_bg.get_timestamp("session_timeout")-CPWbot_bg.get_timestamp("initial_cycle");if(verbose_log(sprintf("session timeout at %6.2f seconds after T=0",t/1e3)),verbose_log("SESSION TIMEOUT WAKEUP"),!N&&!S&&i==e)return V_("timeout: a change is still running ? tabid="+e+"last state ="+n),void CPWbot_bg.panic("session timeout");pn(e),CPWbot_bg.cpwbot_cs_finish_complete(e)}else verbose_log("stale timeout")},_)}this.broken_hearted_st_id=null,this.session_timeout_st_id=null,this.docaptcha_si_id=null;var O_=0;function k_(e,t,i){var _="";verbose_log("B1: validate_login_form "),n="B1";var o=null,r={aid:i.aid,recipe:t};return null===(o=CPWbot_bg.validate_login_form(e,t,r))?(verbose_log("B1: validate_login_form / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null):o?(do_A4(e,t,i),!0):(CPWbot_bg.do_milestone(e,he,t,""),pn(e),!1)}function F_(e,t,n){var i;setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.engine(e,t,n)},250)}function W_(){var e,t;for(e=0;e<t_.length;e++)if("validate_response"==(t=t_[e]).type)return!0;return!1}function G_(e,t){var n=m_lastclick_metadata;E_>P_&&verbose_log("too many click retries"),n&&(Ni(mi,"Retry Click"),verbose_log("tabid="+e+" id_type="+n.id_type+" id_value="+n.id_value),sendCS(e,n,t),E_++)}function y_(e){var t,n;return(new Date).getTime()>S_&&!L_&&(L_=!0,G_(e,"all"),!0)}function D_(e){var t=1e4,n;return M_&&(n=M_.initial_cycle-M_.dopwchange)>t&&0!=M_.initial_cycle&&0!=M_.dopwchange&&U_(e,R_=2),!0}function U_(e,t){return L(sprintf("[%s] time factor adjustment=%6.2f",no(e),t)),!0}this.engine=function(e,i,o){var r=o.aid,u=o.recipe,d=(new Date).getTime(),f=!1;if(0==e_&&(CPWbot_bg.mark_timestamp("initial_cycle"),D_(u),CPWbot_bg.do_milestone(e,72,u),null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id),CPWbot_bg.broken_hearted_st_id=null,T_(e,u)),oe("engine awaken tick="+ ++e_),null!==n){if(!I_&&lploggedin){if(!J){var C=di(u);C||(C=DEFAULT_SESSION_TIMEOUT);var h=CPWbot_bg.get_timestamp("docaptcha_success");if(h||(h=CPWbot_bg.get_timestamp("initial_cycle")),h||(h=Yi),d>h+C*R_)return f=!0,CPWbot_bg.do_milestone(e,Oe,u,"engine"),void CPWbot_bg.panic("TIMEOUT-engine")}var N=Yn(u);if(Xi&&zi>0&&d>zi+N&&(W_(u)?pass:(g_=!1,L("ENGINE - VALIDATE_IN_DOCWAIT=false"),CPWbot_bg.finish_cpwbot_validate_state(e,l,m_,C_,s))),i&&m){if(!(d>qi))return oe("CONTINUE SLEEPING"),void F_(e,n,o);oe("AWAKEN FROM SLEEP")}var S={},O=null,k,W;for(k=0;k<t_.length;k++){var G=(W=t_[k]).data.docnum;switch(oe(sprintf("[%s][%s] processing event#%d cmd=%s",e,G,k,W.data.cmd)),W.type){case"validate_response":CPWbot_bg.cpwbot_validate_state_result_handler(W.tabid,W.data);break;case"fill_ack":CPWbot_bg&&CPWbot_bg.fill_ack_handler(W.tabid,W.data);break;case"click_ack":CPWbot_bg&&CPWbot_bg.click_ack_handler(W.tabid,W.data);break;case"js_ack":CPWbot_bg&&CPWbot_bg.js_ack_handler(W.tabid,W.data);break;case"finish_ack":CPWbot_bg&&CPWbot_bg.cpwbot_finish_ack_handler(W.tabid,W.data);break;case"loadurl":if(g_CS_tops&&g_CS_tops[e]==G)switch(n_&&(n_=!1,oe("m_in_loadurl cleared")),oe("loadurl/setprefs against top :"+g_CS_tops[e]+" == "+G+" start_state="+CPWbot_bg.get_pwchangestate()),n){case"A1":case"A2":case"A3":case"M":case"B1":case"F":CPWbot_bg&&a&&(CPWbot_bg.force_validate_retry(!0),CPWbot_bg.retry_validate(e));break;case"B1R":case"A3R":break;case"FK0":case"FKLL0":break;case 0:case"0":oe("engine called in initial state - ignoring")}else null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()?(L("processing loadurl event, reissue last validate to new doc ["+e+"]["+G+"]"),CPWbot_bg.retry_validate(e,G)):null!==CPWbot_bg.get_pwchangetabid()&&Pi()&&(L("loadurl sent while waiting for a click, issue last click to new frame"+G),f_=!0,G_(e,G));break;case"unload":break;default:oe("need to handle this msg: "+W.data.cmd)}}CPWbot_bg.clear_event_queue(),oe("current state is "+n);var y=_;switch(n&&null===y&&(y={aid:r}),n){case 0:Je(e,u,y);break;case"A1":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(__)oe("waiting for doc-complete for Cnav, "+n),pass;else if(Xi)oe("A1: wait on m_in_validate");else{var D=O=p_;D?M?(CPWbot_bg.do_milestone(e,67,u),Be(e,u,o)):(verbose_log("short-circuiting logout/L state"),CPWbot_bg.do_milestone(e,67,u),re(e,u,o)):null===D?CPWbot_bg.alert("A1 unexpected"):Te(e,u,o)}break;case"A3R":A?(oe("waiting for click_ack, "+n),y_(e),pass):n_?(oe("waiting for loadurl , "+n),pass):Fe(e,u,o);break;case"B1Rpre":Re(e,u,o);break;case"B1R":T?(oe("waiting for click_ack, "+n),y_(e),pass):n_?(oe("waiting for loadurl , "+n),pass):Xi?oe("B1R: wait on m_in_validate"):k_(e,u,o);break;case"B1":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(Xi)oe("B1: wait on m_in_validate");else{var U=O=p_;if(b_&&b_.found_interactive)return console_error("B1: found interactive field"),void to(e,u);if(!U){debug&&g_innerHTML_debug&&b_.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+b_.innerhtml);var R="";return CPWbot_bg.do_milestone(e,he,u,R),void pn(e)}Ge(e,u,o)}break;case"A2":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(Xi)oe("A2: wait on m_in_validate");else if(__)oe("A2: wait on navigate");else{if(b_&&b_.found_interactive)return console_error("A2: found interactive field"),void to(e,u);var j;if(!(j=O=p_)){var R="";return CPWbot_bg.do_milestone(e,Ce,u,R),void pn(e)}re(e,u,o)}break;case"A3":if(CPWbot_bg.in_validate()||g_||Xi)oe("waiting for validate to end, "+n),pass;else{var U=O=p_;if(b_&&b_.found_interactive)return console_error("A3: found interactive field"),void to(e,u);U?(oe("A3: has login form, calling do_A4"),b_&&b_.found_interactive&&oe("A3: found_interactive=true"),Ge(e,u,o)):(debug&&g_innerHTML_debug&&b_.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+b_.innerhtml),Ue(e,u,o))}break;case"M":if(CPWbot_bg.in_validate()||g_||Xi)oe("waiting for validate to end, "+n),pass;else{var H=O=p_;if(b_&&b_.found_interactive)return console_error("M: found interactive field"),void to(e,u);H?qe(e,u,o):(verbose_log("did not find initial stage login form"),b_.innerhtml&&verbose_log("final innerHTML is "+b_.innerhtml),o.check_login_entry_form=!1,We(e,u,o))}break;case"M2":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(Xi)oe("M2: wait on m_in_validate");else if(__)oe("M2: wait on navigate");else{if(b_&&b_.found_interactive)return console_error("M2: found interactive field"),void to(e,u);var j;if(!(j=O=p_)){var R="";return b_&&(R=sprintf("found_bad_match=%s, num_ok_matches=%s, retval=%s, url_success_match=%s, url_failure_match=%s",b_.found_bad_match,b_.num_ok_matches,b_.retval,b_.url_success_match,b_.url_failure_match)),CPWbot_bg.do_milestone(e,ke,u,R),void pn(e)}o.check_login_entry_form=!1,We(e,u,o)}break;case"A4":break;case"A5":De(e,u,o);break;case"M5":Xe(e,u,o);break;case"A":console_warn("engine state=A todo");break;case"B":n_?(oe("waiting for loadurl to complete, "+n),pass):r_?(oe("waiting for doc-complete after loadurl, "+n),pass):Me(e,u,o);break;case"Bsleep":r_?(oe("waiting for doc-complete after loadurl, "+n),pass):Me(e,u,o);break;case"C":if(w)oe("waiting for click_ack, "+n),y_(e),pass;else if(n_)oe("waiting for loadurl , "+n),pass;else if(o_)oe("waiting for reveal-cpw doc-complete, "+n),pass;else{var V;void 0===(V=g_CS_tops[e])&&(V=null);var B=null;if(null!==V)if(B=getcsinfo(e,V)){var K=B.docstate;"complete"==B.docstate&&"complete"==K?(oe("C: wait completed "+n),ae(e,u,o)):oe("C: wait docstate:"+B.docstate+",last:"+K)}else oe("C: fail");else oe("C: wtf - wait for page to finish loading?");null!==V?ping(e,V):ping(e)}break;case"Cnav":L("aid = "+v_.payload.aid),CPWbot_bg.navigate_to_acctmgmt(e,v_),v_=null;break;case"Cpickup":w&&(L("still waiting for click-C"),oe("waiting for click_ack, "+n),y_(e)),o_?L("still waiting for document-complete to run reveal_cpw"):ae(e,u,o);break;case"A3Rsleep":Fe(e,u,o);break;case"B1Rsleep":We(e,u,o);break;case"Csleep":o_?L("still waiting for document-complete to run reveal_cpw"):ae(e,u,o);break;case"Dpickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:r,state:76,msg:"SLOW"}),I?(L("still waiting for click-D"),oe("waiting for click_ack, "+n),y_(e)):se(e,u,o);break;case"Dsleep":se(e,u,o);break;case"Epickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:r,state:76,msg:"SLOW"}),E?(L("still waiting for click-E"),oe("waiting for click_ack, "+n),y_(e)):(o.validate_result=null,me(e,u,o));break;case"Esleep":o.validate_result=null,me(e,u,o);break;case"D":if(oe("engine handle D"),I||n_)I?(oe("waiting for click_ack, "+n),y_(e)):oe("waiting for load to complete, "+n),pass;else{var V;void 0===(V=g_CS_tops[e])&&(V=null);var B=null;if(null!==V)if(B=getcsinfo(e,V)){var K=B.docstate;"complete"==B.docstate&&"complete"==K?(oe("D: wait completed "+n),se(e,u,o)):oe("D: wait docstate:"+B.docstate+",last:"+K)}else oe("D: fail");else oe("D: wtf - wait for page to finish loading?");null!==V?ping(e,V):ping(e)}break;case"Dreveal":var Y=CPWbot_bg.reveal_cpw(e,v_);v_=null;break;case"D1":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(Xi)oe("D1: wait on m_in_validate");else if(i_)oe("D1: wait on doc-complete for trigger_cpw");else{var x=O=p_;if(b_&&b_.found_interactive)return console_error("D1: found interactive field"),void to(e,u);x?ve(e,u,o):fe(e,u,o)}break;case"D2":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(Xi)oe("D2: wait on m_in_validate");else{var q;if(!(O=p_)){var R="";return CPWbot_bg.do_milestone(e,Ee,u,R),void pn(e)}ge(e,u,o)}break;case"D4":break;case"D5":P?(oe("waiting for click_ack, "+n),y_(e)):i_?oe("D5: wait on doc-complete for trigger_cpw"):ve(e,u,o);break;case"D3":console_error("D3 reached - should not happen");break;case"D_validate_cpw_form":xn(e,v_),v_=null;break;case"E":console_error("E: should not occur");break;case"Etrigger":E?(oe("waiting for click_ack, "+n),y_(e)):n_?console_error("Etrigger: m_in_loadurl should not happen"):Xi?console_error("Etrigger: m_in_validate should not happen"):(CPWbot_bg.trigger_cpw(e,v_),v_=null);break;case"F":if(CPWbot_bg.in_validate()||g_)oe("waiting for validate to end, "+n),pass;else if(n_)oe("waiting for loadurl and doc-complete"),pass;else if(Xi)oe("F: wait on m_in_validate"),pass;else{CPWbot_bg.bagration();var z=O=p_;if(null!==z){verbose_log("F: VALIDATE return from CS, returned "+z),debug&&g_innerHTML_debug&&p_.innerhtml&&!z&&verbose_log("VALIDATE FAILURE, final innerHTML is "+p_.innerhtml);var R="";if(z)if(verbose_log("cpwbot initiate: validate cpw succeeded, now updating user record"),gn(e,u,y)){CPWbot_bg.do_milestone(e,63,u);var X=on(r),ne,ne=lpdec_acct(c,X,"undefined"==typeof g_shares?lpshares:g_shares),ie=je(u),_e=lp_gettld_url(ie);verbose_log('remember to g_didchangepw for pw="'+(g_show_pw_in_logs||g_isadmin?ne:"REDACTED")+'" tld='+_e),remember_changed_pw(ne,_e)||verbose_log('save to g_didchangepw failed for pw="'+(g_show_pw_in_logs||g_isadmin?ne:"REDACTED")+'" tld='+_e),Ae(e,u,o)}else CPWbot_bg.do_milestone(e,we,u,R);else CPWbot_bg.do_milestone(e,Pe,u,R)}pn(e),f=!0}break;case"G":break;case"L":if(F)oe("waiting for click_ack, "+n),y_(e),pass;else if(n_)oe("waiting for loadurl , "+n),pass;else{var V;void 0===(V=g_CS_tops[e])&&(V=null);var B=null;null!==V&&((B=getcsinfo(e,V))?"complete"==B.docstate&&(oe("L: wait completed "+n),Ke(e,u,o)):oe("L: fail")),null!==V?ping(e,V):ping(e)}break;case"Lsleep":Ke(e,u,o);break;case"Bagration":break;case"FK0":Y_(e,u,o);break;case"FK1":x_(e,u,o);break;case"FK2":q_(e,u,o);break;case"FKI":z_(e,u,o);break;case"FK3":Te(e,u,o);break;case"FKLL0":X_(e,u,o);break;case"FKLL1":Z_(e,u,o);break;case"FKLL2":Q_(e,u,o);break;case"FKLLI":$_(e,u,o);break;case"FKLL3":re(e,u,o);break;default:pass}return void(f||F_(e,n,o))}H_(e,u)}else pn(e);function oe(e){if(debug){var e=sprintf("[%s][%s] : %s",(new Date).toString(),"engine",e);console_log(e)}}function re(e,t,i){var _,o={aid:i.aid,recipe:i.recipe};verbose_log("do_C "+n),CPWbot_bg.do_milestone(e,Q,t);var r={desc:"navigate_to_acctmgmt",didcallout:!1,payload:o,recipe:t,target_field:et(t),target_js:St(t)+""+Lt(t),target_url:Ve(t)};return CPWbot_bg.should_wait_for_document_complete(e,r)?(L("wrapped navigate_to_acctmgmt around wait-for-document-complete"),r.didcallout=!0,__=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,t){L("Cnav milestone"),n="Cnav",v_=t},r),_=null):(r.didcallout=!1,L("execute navigate_to_acctmgmt, no wait "),_=CPWbot_bg.navigate_to_acctmgmt(e,r)),null===_?(L("callout to CS : navigate_to_acctmgmt"),_):(!1===_&&console_error("C error"),L("execute navigate_to_acctmgmt, no wait "),le(e,t,i))}function ae(e,t,i){m=!1;var _=Qn(t);return _||(_=2500),_&&!s_?(n="Csleep",L("C sleeping "+_),m=!0,xi=d,qi=d+_,s_=!0,null):(s_=!0,b&&_n(e,t,Lt),le(e,t,i))}function le(e,t,i){var _;verbose_log("do_D "+n);var o={aid:i.aid,recipe:i.recipe};o_=!1,CPWbot_bg.do_milestone(e,$,t);var r={desc:"reveal_cpw",payload:o,recipe:t,didcallout:!1,target_field:$e(t),target_js:ht(t)+""+Nt(t),target_url:He(t)};return CPWbot_bg.should_wait_for_document_complete(e,r)?(L("wrapped reveal_cpw around wait-for-document-complete"),r.didcallout=!0,o_=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,t){L("Dreveal milestone"),n="Dreveal",v_=t},r),_=null):(r.didcallout=!1,L("execute reveal_cpw, no wait "),_=CPWbot_bg.reveal_cpw(e,r)),_?(L("execute reveal_cpw, no wait "),ve(e,t,i)):(L("callout to CS : reveal_cpw"),_)}function se(e,t,i){m=!1;var _=$n(t);return _||(_=2500),_&&!c_?(n="Dsleep",L("D sleeping "+_),m=!0,xi=d,qi=d+_,c_=!0,null):(c_=!0,p&&_n(e,t,Nt),ce(e,t,i))}function ce(e,t,i){L("entered do_D1");var _={aid:i.aid,recipe:t};n="D1";var o=null;return null===(o=CPWbot_bg.validate_cpw_form(e,t,_))?(verbose_log("D1: validate_cpw_form / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null):o?void 0:fe(e,t,i)}function fe(e,t,i){var _="",o={aid:i.aid,recipe:t};n="D2";var r=null;return null===(r=CPWbot_bg.validate_login_form(e,t,o))?(g_=!0,L("VALIDATE_IN_DOCWAIT=true"),verbose_log("D2: validate_login_form / CS callout "),null):z?ge(e,t,i):(CPWbot_bg.do_milestone(e,Ee,t,""),pn(e),!1)}function ge(e,t,i){var _="";n="D4",verbose_log("D4: FILL LOGIN/CHALLENGE");var o=null;return(o=cn(e,t,y))?pe(e,t,i):(CPWbot_bg.do_milestone(e,Ne,t,""),pn(e),!1)}function pe(e,t,i){var _="";verbose_log("D5: SUBMIT LOGIN"),n="D5";var o=1100,r=si(t);r&&(o=r),o&&verbose_log("waiting "+o+" ms after login waiting for site to bootstrap");var a=un(e,t,y);return!1===a?(CPWbot_bg.do_milestone(e,Se,t,""),pn(e),!1):null===a?(o&&(m=!0,xi=d,qi=d+o),null):ve(e,t,i)}function be(e,t,n){}function ve(e,t,i){var _;verbose_log("do_E "+n);var o={aid:i.aid,recipe:i.recipe};CPWbot_bg.do_milestone(e,ee,t);var r={desc:"trigger_cpw",payload:o,recipe:t,target_field:nt(t),target_js:Et(t)+""+Pt(t),target_url:null};return CPWbot_bg.should_wait_for_document_complete(e,r)?(L("wrapped trigger_cpw around wait-for-document-complete"),r.didcallout=!0,i_=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,t){L("Etrigger milestone"),n="Etrigger",v_=t},r),_=null):(r.didcallout=!1,L("execute trigger_cpw, no wait "),_=CPWbot_bg.trigger_cpw(e,r)),_?(L("execute trigger_cpw, no wait "),me(e,t,i)):(L("callout to CS : trigger_cpw"),_)}function me(e,t,i){m=!1;var _=ei(t);return _||(_=2500),_&&!u_?(n="Esleep",L("E sleeping "+_),m=!0,xi=d,qi=d+_,u_=!0,null):(u_=!0,i.validate_result=null,Le(e,t,i))}function Le(e,t,i){var _;return CPWbot_bg.mark_timestamp("verify_cpw"),CPWbot_bg.do_milestone(e,te,t),n="F",null===(_=CPWbot_bg.validate_cpw_success(e,t,y))?(verbose_log("F: VALIDATE callout to CS"),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("F: VALIDATE no callout to CS"),V_("no verify-cpw criteria defined"),CPWbot_bg.panic("fail"),!1)}function Ae(e,t,n){if(Wt(t)){var i=1234,_=ui(t);_&&(i=_),setTimeout(function(){CPWbot_bg.conditional_js_exec(e,t,Wt)},i)}return console_error("The End."),!0}function Te(e,t,i){CPWbot_bg.do_milestone(e,Z,t);var _=_t(t);if(_){n="A3R",verbose_log("A3R: login-form-reveal");var o=DEFAULT_CLICK_DELAY,r;return void 0!==t.login_reveal_delay&&(o=t.login_reveal_delay),A=!0,L("now waiting for click_ack A3R"),ln(e,_,o,xe(t)),CPWbot_bg.mark_timestamp("wait_for_click_ack_A3R"),null}return Fe(e,t,i)}function Fe(e,t,i){L("post_A3R"),m=!1;var _=ti(t);return verbose_log("A3R sleepval="+_),_||(_=1e3),_&&!a_?(n="A3Rsleep",L("A3R sleeping "+_),m=!0,xi=d,qi=d+_,a_=!0,null):(a_=!0,i.validate_result=null,verbose_log("calling reveal JS after A3 state"),_n(e,t,At),We(e,t,i))}function We(e,t,i){CPWbot_bg.do_milestone(e,Z,t);var _=!0;if(void 0!==i.check_login_entry_form&&(_=!!i.check_login_entry_form),n="A3",_&&Nn(t)){verbose_log("M: validate_login_entry_form"),CPWbot_bg.mark_timestamp("login_entry"),n="M";var o=null;if(verbose_log("calling validate_login_entry_form"),null===(o=CPWbot_bg.validate_login_entry_form(e,t,y)))return verbose_log("M: validate_login_entry_form / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("M: validate_login_entry_form returns "+o+" no call to CS")}verbose_log("A3: validate_login_form"),n="A3";var r=null;return verbose_log("calling validate_login_form"),null===(r=CPWbot_bg.validate_login_form(e,t,y))?(verbose_log("A3: validate_login_form / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("A3: validate_login_form returns "+r+" no call to CS"),r?Ge(e,t,i):Ue(e,t,i))}function Ge(e,t,i){CPWbot_bg.mark_timestamp("login_cpw");var _="";verbose_log("A4: FILL LOGIN"),n="A4";var o=null;return(o=cn(e,t,y))?ye(e,t,i):(CPWbot_bg.do_milestone(e,he,t,""),pn(e),!1)}function ye(e,t,i){verbose_log("A5: SUBMIT LOGIN"),n="A5";var _="",o=1100,r=si(t);r&&(o=r),o&&verbose_log("waiting "+o+" ms after login waiting for site to bootstrap");var a=un(e,t,y);return!1===a?(CPWbot_bg.do_milestone(e,Ce,t,""),pn(e),!1):null===a?(o&&(m=!0,xi=d,qi=d+o),null):De(e,t,i)}function De(e,t,i){verbose_log("A2: validate_login_success "),n="A2";var _=null;if(null===(_=CPWbot_bg.validate_login_success(e,t,y)))return verbose_log("A2: validate_login_success / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null;if(verbose_log("A2: validate_login_success "+_+" no CS callout "),!_)return CPWbot_bg.do_milestone(e,Ce,t,R),pn(e),retval;if(g_cpw_do_fakeui){var o=K_(e,t,i),r=pi(t),a;setTimeout(function(){re(e,t,i)},r*o+1021)}else re(e,t,i)}function Ue(e,n,i){CPWbot_bg.mark_timestamp("navlogin_cpw"),t++,CPWbot_bg.do_milestone(e,ue,n);var _={aid:i.aid,recipe:i.recipe},o=CPWbot_bg.navigate_to_login(e,_);o&&Me(e,n,i)}function Re(e,t,i){T=!1;var _=_t(t);if(_){n="B1R",verbose_log("B1R: login-form-reveal"),verbose_log("click on FN_REVEAL_LOGIN field!");var o=DEFAULT_CLICK_DELAY,r;return void 0!==t.login_reveal_delay&&(o=t.login_reveal_delay),T=!0,verbose_log("now waiting for click_ack B1R"),ln(e,_,o,xe(t)),CPWbot_bg.mark_timestamp("wait_for_click_ack_B1R"),null}k_(e,t,i)}function Me(e,t,i){verbose_log("post_B"),m=!1;var _=ti(t);_||(_=1e3),_&&!l_?(n="Bsleep",L("B sleeping "+_),m=!0,xi=d,qi=d+_,l_=!0):(l_=!0,i.desc="post_B/Breveal",i.validate_result=null,(g_v2engine||g)&&(verbose_log("calling reveal JS after B state"),_n(e,t,At)),r_=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,t){L("B-reveal milestone"),n="B1Rpre",v_=t},i))}function Je(e,t,i){n="A1";var _=CPWbot_bg.check_is_logged_in(e,t,i);null===_?(verbose_log("A1: check_is_logged_in / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true")):(verbose_log("A1: check_is_logged_in returns "+_+" no CS callout "),(_=O=p_)?M?Be(e,t,o):re(e,t,o):Te(e,t,o))}function Be(e,t,i){var _="";CPWbot_bg.do_milestone(e,de,t),n="L",CPWbot_bg.mark_timestamp("logout_cpw");var o=CPWbot_bg.navigate_to_logout(e,i);return null===o?verbose_log("L: navigate_to_logout / CS callout "):o?Te(e,t,i):(CPWbot_bg.do_milestone(e,Ie,t,""),pn(e)),!0}function Ke(e,t,i){L("post_L"),m=!1;var _=ni(t);if(_||(_=1e3),_&&!d_)return n="Lsleep",L("L sleeping "+_),m=!0,xi=d,qi=d+_,d_=!0,null;if(d_=!0,v&&_n(e,t,jt),g_cpw_do_fakeui){var o=B_(e,t,i),r=pi(t),a;return setTimeout(function(){Te(e,t,i)},r*o+1017),null}return Te(e,t,i)}function Ye(e,t,n){L("do_Z")}function qe(e,t,i){CPWbot_bg.mark_timestamp("login_entry");var _="";verbose_log("M4: FILL LOGIN"),n="M4";var o=null;return(o=dn(e,t,y))?ze(e,t,i):(CPWbot_bg.do_milestone(e,he,t,""),pn(e),!1)}function ze(e,t,i){verbose_log("M5: SUBMIT LOGIN ENTRY"),n="M5";var _="",o=1100,r=si(t);r&&(o=r),o&&verbose_log("waiting "+o+" ms after login waiting for site to bootstrap");var a=fn(e,t,y);return!1===a?(CPWbot_bg.do_milestone(e,ke,t,""),pn(e),!1):null===a?(o&&(m=!0,xi=d,qi=d+o),null):Xe(e,t,i)}function Xe(e,t,i){verbose_log("M2: validate_login_entry_success "),n="M2";var _=null;return null===(_=CPWbot_bg.validate_login_entry_success(e,t,y))?(verbose_log("M2: validate_login_entry_success / CS callout "),g_=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("M2: validate_login_entry_success "+_+" no CS callout "),_?(i.check_login_entry_form=!1,void We(e,t,i)):(CPWbot_bg.do_milestone(e,ke,t,R),pn(e),retval))}function Ze(e,t,n){}},this.initialize_engine=function(e,t){Yi=(new Date).getTime();var n=t.recipe,i=t.aid;_=t,CPWbot_bg.mark_timestamp("initialize_engine");var o=0;n_=!1,i_=!1,__=!1,o_=!1,r_=!1,m_in_logout_reveal=!1,a_=!1,l_=!1,s_=!1,c_=!1,u_=!1,d_=!1,m=!1,Xi=!1,A_=!1,CPWbot_bg.do_milestone(e,65,n);var r=li(n);if(r)U||(U=!0,setTimeout(function(){return F_(e,0,t),!1},r));else if(Rt(n)&&!R){var a=5e3,l=ci(n);l&&(a=l),R=!0,verbose_log("initial JS inject before beginning - inject, and wait "),CPWbot_bg.conditional_js_exec(e,n,Rt),setTimeout(function(){return F_(e,0,t),!1},a)}else F_(e,0,t)},this.push_event_queue=function(e,t,i){if("validate_response"!=e||void 0===i.desc||"docaptcha"!=i.desc){var r={};r.type=e,r.data=i,r.tabid=t,r.docnum=i.docnum,r.addtime=new Date,null===t_&&(t_=[]),void 0!==r.docnum&&verbose_log(sprintf("[%s][%d] pushed event : %s cmd=%s",t,r.docnum,e,i.cmd)),t_.push(r)}else J&&JSON.parse(i.result_obj).num_ok_matches>0&&(CPWbot_bg.mark_timestamp("docaptcha_success"),_n(t,o,Kt),J=!1,CPWbot_bg.show_cpwbot_overlay(t,null,null),T_(t,o),a=null,Xi=!1,b_.found_interactive=!1,p_=!0,F_(t,n,_))},this.clear_event_queue=function(){t_=[]},this.select_execute=function(e,t,n,i){var _},this.select=function(){},this.bagration=function(){n="Bagration"},this.in_bagration=function(){return"Bagration"==n},this.get_selenium_tabid=function(){return N_},this.navigate_to_logout=function(e,t){if(!t)return!1;n="L",v=!1;var i=t.recipe;if(!i)return!1;var r=t.aid,a=!1,l=!1;l=_n(e,i,Mt),Ni(mi,"Navigate to Logout");var s=Je(i);if(s){L("call logout:loadurl with "+s);var c=null;return g_CS_tops&&(c=g_CS_tops[e]),sendCS(e,{cmd:"loadurl",url:s},c),n_=!0,verbose_log("m_in_loadurl set"),o=i,_=t,v=!0,null}F=!1;var u=tt(i),d;if(u){verbose_log("click on FN_NAVIGATE_TO_LOGOUT field!");var f=DEFAULT_CLICK_DELAY,g;void 0!==i.logout_delay&&(f=i.logout_delay),F=!0,verbose_log("now waiting for click_ack L"),ln(e,u,f,xe(i)),CPWbot_bg.mark_timestamp("wait_for_click_ack_L"),a=null}return ri(i)&&(v=!0,ni(i))?null:(l=l||_n(e,i,jt),!1===a&&l&&(a=!0),a)};var R_=1,M_=null;function j_(){var e=0,t=0,n=0,i=0,_=0,o=0,r=0,a=0,l=0,s=0,c=0,u=0,d=0,f=0,g=0,p=0,b=0,v=0,m=0,C=0,h=0,N=0,S=0,L=0,E=0,P=0,w=0,I=0}function H_(e,t){return CPWbot_bg.do_milestone(e,Ae,t),pn(e),CPWbot_bg.cpwbot_cs_finish_complete(e),!0}function V_(e){if(CPWbot_bg){Ni(hi,e);var t={severity:"fatal",msg:e};CPWbot_bg.phone_home(null,null,t)}}function J_(e){Ni(Ci,e);var t={severity:"warning",msg:e};return CPWbot_bg.phone_home(null,null,t)}function B_(e,t,i){if(!t||!i||null===e)return 0;if(!g_cpw_do_fakeui)return 0;n="FK0",verbose_log("entered do_logged_out_fake_ui");var _=0;return 0}function K_(e,t,i){if(!t||!i||null===e)return 0;if(!g_cpw_do_fakeui)return 0;n="FKLL0",verbose_log("entered do_logged_in_fake_ui");var _=0;return 0}function Y_(e,t,n){}function x_(e,t,n){}function q_(e,t,n){}function z_(e,t,n){}function X_(e,t,n){}function Z_(e,t,n){}function Q_(e,t,n){}function $_(e,t,n){}function eo(e,t,n){return!(!t||!n||null===e)}function to(e,t){Fi(e,t)?CPWbot_bg.do_milestone(e,ie,t):(CPWbot_bg.do_milestone(e,Te,t),pn(e))}function no(e){return e?e.symbolic:""}function io(e){return e||(e=100),"undefined"==typeof Math?0:Math.floor(Math.random(e)+10)}function _o(e,t){return e||(e=100),!1;var n}return this.get_timestamp=function(e){return e?(null===M_&&(M_=new j_),M_[e]):null},this.get_timestamps=function(){return M_},this.mark_timestamp=function(e){null!==M_&&"dopwchange"!=e||(M_=new j_);var t=(new Date).getTime();return M_[e]=t,!0},this.dump_timestamps=function(){var e;if(M_)for(e in M_)L(sprintf("[%s] timestamp %s : %d",no(o),e,M_[e]));return U_(o,R_),!0},this.get_last_timestamp=function(e){var t,n="dopwchange";if(M_){for(t in M_)(!e||"fail"!==t&&"finish_complete"!=t&&"success"!=t)&&M_[t]>M_[n]&&(n=t);return n}return null},this.broken_hearted=function(e){if(CPWbot_bg){if(e!=CPWbot_bg.get_session())return void Ni(vi,"stale setTimeout - clearTimeout did not work");var t=CPWbot_bg.get_timestamp("initial_cycle"),_=(new Date).getTime();if(void 0===t&&(t=null),!(t||"preinit"!=n&&n||CPWbot_bg.get_okstate()||CPWbot_bg.get_failstate()||CPWbot_bg.in_bagration())){var r=i,a=o;CPWbot_bg.do_milestone(r,Le,a,"brokenhearted"),CPWbot_bg.panic("TIMEOUT-brokenhearted")}}else;},this.new_session=function(e){e||(e="");var t=(new Date).getTime();null===t&&(t=0);var n="function"==typeof lp_sha256?lp_sha256:SHA256;return w_=n(e.toString()+t.toString())},this.get_session=function(){return w_},this.clear_session=function(){w_=""},this.halt=function(e){if(e&&void 0!==e.aid&&CPWbot_bg.getpwchangeaid()!==e.aid)return!1;null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=null,I_=!0,L("Halt Requested")},this.cpw_dialog_minimize_state=0,this.getpwchangeaid=function(){return r},this.phone_home=function(e,t,n){if(!n)return!1;t||(t=o);var i=(new Date).getTime(),_=(i-CPWbot_bg.get_timestamp("dopwchange"))/1e3;(_<0||isNaN(_))&&(_=0);var r=(i-CPWbot_bg.get_timestamp("initial_cycle"))/1e3;(r<0||isNaN(r))&&(r=0);var a=!0,l=CPWbot_bg.get_last_timestamp(!0),s=n.severity?n.severity:"",c=n.msg?n.msg:"",u=sprintf("[%s][%s][R=%s][L=%s][M=%s][%6.2fsec elapsed][%2.1f TF][%6.2fsec TiE]","cpw",s,t?no(t):"bad-recipe",l,c,_,R_,r);return L(u),lpReportError(u,null),!0},this.warning_phone_home=function(e){return J_(e)},this.site_html_url="","undefined"!=typeof g_iscasper&&g_iscasper&&(this.get_validate_timeout=function(e){return Yn.apply(this,arguments)},this.get_symbolic=function(e){return no.apply(this,arguments)},this.get_logout_url=function(e){return Je.apply(this,arguments)},this.get_generate_prefs_from_recipe=function(e){return Zn.apply(this,arguments)},this.set_last_overlay_message=function(e){return Re.apply(this,arguments)},this.clear_last_overlay_message=function(e){return Me.apply(this,arguments)},this.validate_xpath=function(e){return Si.apply(this,arguments)},this.validate_recipe=function(e){return Li(e)},this.get_cpw_login_password_field=function(e){return qe.apply(this,arguments)},this.get_cpw_login_username_field=function(e){return ze.apply(this,arguments)},this.get_login_submit_field=function(e){return it.apply(this,arguments)},this.get_login_reveal_field=function(e){return _t.apply(this,arguments)},this.replace_constants=function(e){return replace_constants.apply(this,arguments)},this.set_pwchangestate=function(e){return n=e,!0},this.in_wait_for_click=function(){return Pi()},this.submit_login_form=function(e,t,n){return un(e,t,n)},this.fill_login_form=function(e,t,n){return cn(e,t,n)},this.clear_wait_for_clicks=function(){return wi()},this.get_event_queue=function(){return t_},this.reset_private_test_vars=function(){K=!1,Xi=!1,g_=!1},this.should_click_on_fill=function(e){return fi(e)},this.should_fill_password_fields_via_keys=function(e){return gi(e)},this.get_fill_delay=function(e){return pi(e)},this.random_delay=function(e){return io(e)},this.random_sleep=function(e,t){return _o(e,t)},this.get_cpw_session_timeout=function(e){return di(e)},this.fill_login_entry_form=function(e,t,n){return dn(e,t,n)},this.submit_login_entry_form=function(e,t,n){return fn(e,t,n)},this.set_pwchange_validate_desc=function(e){return s=e,!0},this.check_recipe_symbols=function(e){return Ei(e)},this.set_in_validate_outer=function(){return Xi=!0,g_=!0,!0},this.set_in_validate_inner=function(t,n){a={cmd:"cpwbot_validate_state",desc:n,id:t},l=t,e.set_pwchange_validate_desc(n),null===f&&(f=[])},this.get_in_sleep=function(){return m},this.clear_sleeps=function(){a_=!1,l_=!1,s_=!1,c_=!1,u_=!1,d_=!1,m=!1}),!0}function get_recipe_for_url(e,t){var n=lp_gettld_url(e),i=null,_,o;return g_isfirefox?(_=LP.lpMakeRequest,o=LP.lp_base):(_=lpMakeRequest,o=base_url),void _(o+"get_recipe.php","url="+encodeURIComponent(e),function(e){if(4==e.readyState){if(200==e.status&&null!=e.responseXML&&null!=e.responseXML.documentElement){var n=e.responseXML.documentElement.getElementsByTagName("result");if(n.length>0){var i=n[0].getAttribute("recipe");if(""!=i)return void t(replace_constants(JSON.parse(i)));CPWbatch&&CPWbatch.cpw_get_batchjob_state()||CPWbot_bg.alert("This url is not supported yet");var _=128;CPWbot_bg.do_milestone(null,_,null,"no recipe")}}t(null)}},function(){t(null)})}function ping_ack_handler(e,t){var n=t.docnum,i=t.url,_=t.id,o=t.delta,r,a=(new Date).getTime()-t.timestamp;debug&&L("received ping response from [tabid:"+e+"][docnum:"+n+"][id:"+_+" sent: "+o+"ms, response: "+a+"ms docstate="+t.docstate+" url="+i);var l=getcsinfo(e,n);l||((l=new CS_t).docnum=n,l.tabid=e),l.url=i,l.docstate=t.docstate,l.flags=t.flags,setcsinfo(e,n,l)}function ping(e,t){var n=(new Date).getTime(),i=!1;void 0!==e&&null!==e||(i=!0),void 0!==t&&null!==t||(t="all");var _,o=("function"==typeof lp_sha256?lp_sha256:SHA256)(g_username+""+e+t+n);if(debug&&L("sending ping id="+o),i)for(e in g_CS)void 0!==e&&null!==e&&sendCS(e,{cmd:"ping_req",id:o,timestamp:n},t);else sendCS(e,{cmd:"ping_req",id:o,timestamp:n},t)}function cpwbot_getpwchangestate(){return g_cpwbot&&CPWbot_bg?"Bagration"==CPWbot_bg.get_pwchangestate()?!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":"FAIL":!0===CPWbot_bg.get_okstate()?"OK":null:!0===CPWbot_bg.get_captchastate()?"CAPTCHA":!0===CPWbot_bg.get_docaptchastate()?"DOCAPTCHA":!0===CPWbot_bg.get_brokenheartstate()?"TIMEOUT":"preinit"==CPWbot_bg.get_pwchangestate()?null:!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":"FAIL":!0===CPWbot_bg.get_okstate()?"OK":CPWbot_bg.get_pwchangestate():"FAIL"}function cpwbot_preinit(){CPWbot_bg&&CPWbot_bg.preinit()}function cpwbot_get_user_debug_messages(){if(CPWbot_bg)return CPWbot_bg.get_user_debug_messages()}function cpwbot_get_dialog_msg(){if(CPWbot_bg)return CPWbot_bg.get_dialog_msg()}function cpwbot_halt(){if(CPWbot_bg)return CPWbot_bg.halt()}function cpwbot_minimize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1)}function cpwbot_maximize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0)}function cpwbot_get_minimize_dialog_state(){if(CPWbot_bg)return CPWbot_bg.cpw_dialog_minimize_state}
//# sourceMappingURL=sourcemaps/cpwbot_bg.js.map
