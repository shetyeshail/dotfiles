(function(){"use strict";var e=this,t,r,o;!function(e){var i,n,s,a,u={},c={},l={},d={},p=Object.prototype.hasOwnProperty,f=[].slice,m=/\.js$/;function v(e,t){return p.call(e,t)}function g(e,t){var r,o,i,n,s,a,u,c,d,p,f,v,g=t&&t.split("/"),y=l.map,h=y&&y["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&m.test(e[s])&&(e[s]=e[s].replace(m,"")),"."===e[0].charAt(0)&&g&&(e=(v=g.slice(0,g.length-1)).concat(e)),d=0;d<e.length;d++)if("."===(f=e[d]))e.splice(d,1),d-=1;else if(".."===f){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((g||h)&&y){for(d=(r=e.split("/")).length;d>0;d-=1){if(o=r.slice(0,d).join("/"),g)for(p=g.length;p>0;p-=1)if((i=y[g.slice(0,p).join("/")])&&(i=i[o])){n=i,a=d;break}if(n)break;!u&&h&&h[o]&&(u=h[o],c=d)}!n&&u&&(n=u,a=c),n&&(r.splice(0,a,n),e=r.join("/"))}return e}function y(t,r){return function(){var o=f.call(arguments,0);return"string"!=typeof o[0]&&1===o.length&&o.push(null),n.apply(e,o.concat([t,r]))}}function h(e){return function(t){return g(t,e)}}function b(e){return function(t){u[e]=t}}function S(t){if(v(c,t)){var r=c[t];delete c[t],d[t]=!0,i.apply(e,r)}if(!v(u,t)&&!v(d,t))throw new Error("No "+t);return u[t]}function w(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function P(e){return e?w(e):[]}function _(e){return function(){return l&&l.config&&l.config[e]||{}}}s=function(e,t){var r,o=w(e),i=o[0],n=t[1];return e=o[1],i&&(r=S(i=g(i,n))),i?e=r&&r.normalize?r.normalize(e,h(n)):g(e,n):(i=(o=w(e=g(e,n)))[0],e=o[1],i&&(r=S(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:r}},a={require:function(e){return y(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:_(e)}}},i=function(t,r,o,i){var n,l,p,f,m,g,h=[],w=typeof o,_;if(g=P(i=i||t),"undefined"===w||"function"===w){for(r=!r.length&&o.length?["require","exports","module"]:r,m=0;m<r.length;m+=1)if("require"===(l=(f=s(r[m],g)).f))h[m]=a.require(t);else if("exports"===l)h[m]=a.exports(t),_=!0;else if("module"===l)n=h[m]=a.module(t);else if(v(u,l)||v(c,l)||v(d,l))h[m]=S(l);else{if(!f.p)throw new Error(t+" missing "+l);f.p.load(f.n,y(i,!0),b(l),{}),h[m]=u[l]}p=o?o.apply(u[t],h):void 0,t&&(n&&n.exports!==e&&n.exports!==u[t]?u[t]=n.exports:p===e&&_||(u[t]=p))}else t&&(u[t]=o)},t=r=n=function(t,r,o,u,c){if("string"==typeof t)return a[t]?a[t](r):S(s(t,P(r)).f);if(!t.splice){if((l=t).deps&&n(l.deps,l.callback),!r)return;r.splice?(t=r,r=o,o=null):t=e}return r=r||function(){},"function"==typeof o&&(o=u,u=c),u?i(e,t,r,o):setTimeout(function(){i(e,t,r,o)},4),n},n.config=function(e){return n(e)},t._defined=u,(o=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),v(u,e)||v(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}();var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o,i,n,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(n=(n=r.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(6===s[0]&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{o=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},a=this&&this.__decorate||function(e,t,r,o){var i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},u=this&&this.__extends||(c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c;o("common/services/form-detection/form-profile",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/services/form-detection/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/enums/auto-fill-action",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.AutoFillAction||(t.AutoFillAction={})).Login="Login",o.Email="Email",o.Address="Address",o.PersonalName="PersonalName"}),o("common/enums/auto-fill-input-category",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.AutoFillInputCategory||(t.AutoFillInputCategory={})).Name="name",o.FullName="fullName",o.FirstName="firstName",o.LastName="lastName",o.Address="address",o.Email="email",o.Password="password",o.UserName="userName"}),o("common/enums/auto-fill-method",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.AutoFillAlgorithm||(t.AutoFillAlgorithm={})).Legacy="Legacy",o.Euclidean="Euclidean"}),o("common/enums/feature-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.FeatureType||(t.FeatureType={})).AngularFrontendEnabled="angularFrontendEnabled",o.AutoFillControl="autofill_control",o.AutoFillTest="autofill_test",o.BetterGeneratePasswordEnabled="better_generate_password_enabled",o.Block30="block_3_0",o.EmergencyAccessRestricted="emergency_access_restricted",o.FamiliesEnabled="families_enabled",o.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",o.FamilySharedFoldersEnabled="family_shared_folders_enabled",o.FormfillMigration="formfill_migration",o.Freamon="freamon",o.HealthMonitoring="health_monitoring",o.ICOB="icob",o.IntroTutorialVersion="intro_tutorial_version",o.IsDogfood="isDogfood",o.IsInfieldEnabled="is_infield_enabled",o.IsMobileActive="is_mobile_active",o.NewSaveSite="new_save_site",o.OmarDrawer="omardrawer",o.OmarIa="omaria",o.OmarInfieldB="omar_infield_b",o.OmarInfieldC="omar_infield_c",o.OneToOneSharingRestricted="one_to_one_sharing_restricted",o.PasswordSubmittedEvent="password_submitted_event",o.Pdkdf2IterationsMigration="pbkdf2_iterations_migration",o.Retire30="retire_3_0",o.TryFamiliesEnabled="try_families_enabled",o.WebRequestEnabled="save_a_site_web_request",o.Ziggy="ziggy"}),o("common/enums/repository-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.RepositoryType||(t.RepositoryType={})).Feature="Feature",o.AutoFillState="AutoFillState"}),o("common/enums/resolver-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.ResolverType||(t.ResolverType={})).PasswordSubmitted="Password Submitted",o.InjectedPasswordSubmitted="Injected Password Submitted"}),o("common/enums/save-site-action",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.SaveSiteAction||(t.SaveSiteAction={})).Add="Add",o.OK="OK",o.Update="Update",o.NotNow="Not Now",o.Undo="Undo",o.Never="Never"}),o("common/enums/save-site-event-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.SaveSiteDialogEventType||(t.SaveSiteDialogEventType={})).SaveSiteDialogAction="Save a Site Action Clicked",o.SaveSiteDialogDuplicateDeleteClicked="Save a Site Duplicate Delete Clicked",o.SaveSiteDialogDuplicateKeepClicked="Save a Site Duplicate Keep Clicked",o.SaveSiteDialogEditClicked="Save a Site Edit Clicked",o.SaveSiteDialogNewClicked="Save a Site New Clicked",o.SaveSiteDialogSelectClicked="Save a Site Select Clicked",o.SaveSiteDialogViewed="Save a Site Viewed",o.SaveSiteDialogAnotherClicked="Save a Site Another Clicked"}),o("common/enums/segment-event-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.SegmentEventType||(t.SegmentEventType={})).SaveSiteDialog="savesitedialog"}),o("common/enums/service-type",["require","exports"],function(e,t){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=r=t.ServiceType||(t.ServiceType={})).BasicAuth="BasicAuth",o.ContentScriptTools="ContentScriptTools",o.DomUtils="DomUtils",o.FormDetection="FormDetection",o.AutoFill="AutoFill",o.FormParser="FormParser",o.Segment="Segment",o.Site="Site",o.StringUtils="StringUtils",o.Topic="Topic",o.WebRequest="WebRequest",o.WebRequestShim="WebRequestShim"}),o("common/enums/topic-type",["require","exports","common/legacy"],function(e,t,r){var o,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=o=t.TopicType||(t.TopicType={}))[i.ClearData=r.LegacyGlobalCommon.Topics.CLEAR_DATA]="ClearData",i[i.FilledGeneratedPassword=r.LegacyGlobalCommon.Topics.FILLED_GENERATED_PW]="FilledGeneratedPassword",i[i.Initialized=r.LegacyGlobalCommon.Topics.INITIALIZED]="Initialized",i[i.Login=r.LegacyGlobalCommon.Topics.LOGIN]="Login",i[i.LoginFinished=r.LegacyGlobalCommon.Topics.LOGIN_FINISHED]="LoginFinished",i[i.ProcessedFormSubmit=r.LegacyGlobalCommon.Topics.PROCESSED_FORM_SUBMIT]="ProcessedFormSubmit",i[i.RequestFrameworkInitialized=r.LegacyGlobalCommon.Topics.REQUEST_FRAMEWORK_INITIALIZED]="RequestFrameworkInitialized",i[i.PasswordFormSubmitted=r.LegacyGlobalCommon.Topics.PASSWORD_FORM_SUBMITTED]="PasswordFormSubmitted"}),o("common/enums/index",["require","exports","common/enums/auto-fill-action","common/enums/auto-fill-input-category","common/enums/auto-fill-method","common/enums/feature-type","common/enums/repository-type","common/enums/resolver-type","common/enums/save-site-action","common/enums/save-site-event-type","common/enums/segment-event-type","common/enums/service-type","common/enums/topic-type"],function(e,t,r,o,i,n,s,a,u,c,l,d,p){function f(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),f(r),f(o),f(i),f(n),f(s),f(a),f(u),f(c),f(l),f(d),f(p)}),o("common/repositories/auto-fill-state/auto-fill-algorithm-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/repositories/auto-fill-state/auto-fill-frame-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/repositories/auto-fill-state/auto-fill-state",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.tabId=e,this.url=t,this.frames={}}return Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){var r=e.frames[t];return r.isReady||!r.isAllowed})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllowed",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){return e.frames[t].isAllowed})},enumerable:!0,configurable:!0}),e.prototype.tryGetFrame=function(e){return this.frames[e]||(this.frames[e]=this.getEmptyFrame()),this.frames[e]},e.prototype.getEmptyFrame=function(){return{elements:{},isAllowed:!0,isReady:!1}},e.prototype.setFrameAllowed=function(e,t){var r;this.tryGetFrame(e).isAllowed=t},e.prototype.setFrameReady=function(e,t){var r;this.tryGetFrame(e).isReady=t},e.prototype.getFrameAlgorithmState=function(e,t,r){var o=this.tryGetFrame(e);if(o.elements[t])return o.elements[t][r]},e.prototype.setFrameAlgorithmState=function(e,t,r,o){var n=this.tryGetFrame(e),s=n.elements[t];s||(s={},n.elements[t]=s),n.elements[t][r]=i({},s[r],o)},e.prototype.resetFrameState=function(e){this.frames[e]&&(this.frames[e]=this.getEmptyFrame())},e.prototype.deleteFrameState=function(e){this.frames[e]&&delete this.frames[e]},e.prototype.getResults=function(){var e=this,t={count:0};Object.keys(r.AutoFillAlgorithm).forEach(function(e){t[e]=0});var o={allowed:this.isAllowed,userName:i({},t),password:i({},t)};return Object.keys(this.frames).forEach(function(n){var s=e.frames[n];s.isAllowed&&s.isReady&&Object.keys(s.elements).forEach(function(e){return Object.keys(s.elements[e]).forEach(function(n){var a,u=s.elements[e][n].filledWith;if(u&&"none"!==u){o[u]||(o[u]=i({},t));var c=o[u][n]+1;n===r.AutoFillAlgorithm.Legacy&&(o[u].count=c),o[u][n]=c}})})}),o},e}();t.AutoFillState=o}),o("common/repositories/auto-fill-state/index",["require","exports","common/repositories/auto-fill-state/auto-fill-state"],function(e,t,r){function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r)}),o("common/interfaces/auto-fill-state.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/auto-fill.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/feature.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/segment.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/segment-event",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/serializable-callback",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/serializable-value",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/web-request-shim.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/web-request.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("background/interfaces/content-script-target",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("background/services/form-parser/form-meta-data",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.passwordsByValue={},this.textFieldsByValue={},this.textFieldsByType={},this.uniqueTextValues=[],this.uniquePasswords=[],e.fields&&(e.fields.forEach(function(e){"password"===e.type?t.aggregateField(e,e.value,t.passwordsByValue):(t.aggregateField(e,e.value,t.textFieldsByValue),t.aggregateField(e,e.type,t.textFieldsByType))}),this.uniqueTextValues=Object.keys(this.textFieldsByValue),this.uniquePasswords=Object.keys(this.passwordsByValue))}return e.prototype.aggregateField=function(e,t,r){var o=r[t];o?++o.count:r[t]={field:e,count:1}},e}();t.FormMetaData=r}),o("background/interfaces/parsed-form",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("background/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("background/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/legacy",["require","exports"],function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LegacyGlobalCommon=e}),o("common/module.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._isInitialized=!1,this.initializedQueue=[],setTimeout(function(){return n(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.initialize()];case 1:return e.sent(),[4,this.postInitialize()];case 2:for(e.sent(),this._isInitialized=!0;this.initializedQueue.length;)try{this.initializedQueue.pop()()}catch(e){console.error(e)}return[2]}})})})}return e.prototype.isInitialized=function(e){this._isInitialized?e():this.initializedQueue.push(e)},e}();t.ModuleAbstract=r}),o("common/provider.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=!0);var r=this;this.instances={},this.initialized=!1,e&&e.size&&(this.map=e,this.map.forEach(function(e,o){e.delegated&&!t||(r.instances[o]=new e.ctor)}))}return e.prototype.initialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){return e.instances[t].initialize()}),this.initialized=!0},e.prototype.postInitialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){"function"==typeof e.instances[t].postInitialize&&e.instances[t].postInitialize()})},e.prototype.teardown=function(){var e=this;Object.keys(this.instances).forEach(function(t){e.instances[t]&&"function"==typeof e.instances[t].destroy&&e.instances[t].destroy()})},e}();t.ProviderAbstract=r}),o("common/decorators/register-repository.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;function o(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}}function i(){return r}t.RegisterRepository=o,t.getRepositoryRegistry=i}),o("common/decorators/register-service.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;function o(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}}function i(){return r}t.RegisterService=o,t.getServiceRegistry=i}),o("common/messaging/messaging",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap;function o(e,t){var o=e.constructor,i=r.get(o);i&&i.size?i.add(t):i=new Set([t]),r.set(o,i)}t.addVisibleMethod=o;var i=null;function a(){return i}function u(e,t,o,a,u){return void 0===o&&(o=[]),n(this,void 0,void 0,function(){var n,l,d;return s(this,function(s){switch(s.label){case 0:if(s.trys.push([0,3,4,5]),!e||!e.constructor)throw new Error("No target provided!");if(!r.has(e.constructor))throw new Error("Target has no visible methods.");if(!r.get(e.constructor).has(t))throw new Error("Method [ "+t+" ] is not a visible method.");if("function"!=typeof(n=e[t]))throw new Error("Method [ "+t+" ] is not a function or does not exist on the target.");return i=Object.freeze({calleeTab:Object.freeze(u)}),(l=n.bind(e).apply(void 0,o))&&"function"==typeof l.then?[4,l]:[3,2];case 1:l=s.sent(),s.label=2;case 2:return a(null,l),[3,5];case 3:return c(d=s.sent(),a),[3,5];case 4:return i=null,[7];case 5:return[2]}})})}function c(e,t){if("function"==typeof t){var r=void 0;"string"==typeof e?r=e:e instanceof Error&&(r="string"==typeof e.message?e.message:"function"==typeof e.toString?e.toString():"Unknown error"),t(r)}else console.error(e)}t.getInvokatingMessageContext=a,t.callMethod=u,t.handleCallbackError=c}),o("common/decorators/visible.decorator",["require","exports","common/messaging/messaging"],function(e,t,r){function o(e,t,o){r.addVisibleMethod(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Visible=o}),o("common/decorators/index",["require","exports","common/decorators/register-repository.decorator","common/decorators/register-service.decorator","common/decorators/visible.decorator"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),o("common/interfaces/site.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),o("common/services/topic/topic.service",["require","exports","common/decorators/index","common/enums/index","common/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.subscribe=function(e,t){i.LegacyGlobalCommon.Topics.get(e).subscribe(function(e){return t(e)})},e=a([r.RegisterService(o.ServiceType.Topic)],e)}();t.TopicService=n}),o("common/services/utils/string-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;++r)if(e.indexOf(t[r])>-1)return!0}return!1},e.prototype.containsMaskingCharacter=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1},e=a([r.RegisterService(o.ServiceType.StringUtils)],e)}();t.StringUtilsService=i}),o("background/legacy",["require","exports"],function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LegacyGlobal=e}),o("background/repositories/auto-fill-state/auto-fill-state.repository",["require","exports","common/decorators/index","common/enums/index","common/repositories/auto-fill-state/index","background/legacy"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.states=new Map}return e.prototype.tryGetState=function(e){var t;try{t=this.getState(e)}catch(e){if(!(e instanceof ReferenceError))throw e}if(!t){var r=n.LegacyGlobal.LPTabs.get({tabID:e}),o=void 0;r&&(o=r.tabDetails.tabURL),t=new i.AutoFillState(e,o),this.setState(t)}return t},e.prototype.initialize=function(){},e.prototype.getState=function(e,t){var r=this.states.get(e);if(!r){var o="Could not find state for tab: "+e;if("function"==typeof t)return void t(o);throw new ReferenceError(o)}if("function"!=typeof t)return r;t(null,r)},e.prototype.setState=function(e){this.states.set(e.tabId,e)},e.prototype.deleteState=function(e){this.states.delete(e)},e.prototype.resetFrameState=function(e,t){this.states.has(e)&&this.states.get(e).resetFrameState(t)},e.prototype.deleteFrameState=function(e,t){this.states.has(e)&&this.states.get(e).deleteFrameState(t)},e.prototype.getFrameAlgorithmState=function(e,t,r,o,i){var n;try{var s=this.getState(e);n=s.getFrameAlgorithmState(t,r,o)}catch(e){if(!(e instanceof ReferenceError))throw e;n={}}if("function"!=typeof i)return n;i(null,n)},e.prototype.setFrameAlgorithmState=function(e,t,r,o,i){var n;this.tryGetState(e).setFrameAlgorithmState(t,r,o,i)},e.prototype.setFrameAllowed=function(e,t,r){var o;this.tryGetState(e).setFrameAllowed(t,r)},e.prototype.setFrameReady=function(e,t,r){var o;this.tryGetState(e).setFrameReady(t,r)},e.prototype.getFillResults=function(e,t,r){var o;t=t||0;try{var i=this.getState(e);o=i.getResults()}catch(e){o={}}if("function"!=typeof r)return o;r(null,o)},a([r.Visible],e.prototype,"getState",null),a([r.Visible],e.prototype,"setState",null),a([r.Visible],e.prototype,"deleteState",null),a([r.Visible],e.prototype,"resetFrameState",null),a([r.Visible],e.prototype,"deleteFrameState",null),a([r.Visible],e.prototype,"getFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAllowed",null),a([r.Visible],e.prototype,"setFrameReady",null),a([r.Visible],e.prototype,"getFillResults",null),e=a([r.RegisterRepository(o.RepositoryType.AutoFillState)],e)}();t.AutoFillStateRepository=s}),o("background/repositories/feature/feature.repository",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.featureEnumNames=new Set,this.featurePropertyNames=new Set,Object.keys(o.FeatureType).forEach(function(t){e.featureEnumNames.add(t),e.featurePropertyNames.add(o.FeatureType[t])})}return e.prototype.initialize=function(){},e.prototype.get=function(e){return i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]},e.prototype.set=function(e,t){i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]=t},e.prototype.resolvePropertyName=function(e){if(this.featureEnumNames.has(e))return o.FeatureType[e];if(this.featurePropertyNames.has(e))return e;throw new TypeError("Unrecognized feature name: [ "+e+" ]")},a([r.Visible],e.prototype,"get",null),a([r.Visible],e.prototype,"set",null),e=a([r.RegisterRepository(o.RepositoryType.Feature)],e)}();t.FeatureRepository=n}),o("background/repositories/repository-provider",["require","exports","common/provider.abstract","common/messaging/messaging"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getRepository=function(e){return this.instances[e]},t.prototype.call=function(e,t,r,i,n){void 0===r&&(r=[]);try{o.callMethod(this.getRepository(e),t,r,i,n)}catch(e){o.handleCallbackError(e,i)}},t}(r.ProviderAbstract);t.RepositoryProvider=i}),o("background/repositories/index",["require","exports","background/repositories/auto-fill-state/auto-fill-state.repository","background/repositories/feature/feature.repository","background/repositories/repository-provider"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),o("background/services/service-provider",["require","exports","common/provider.abstract","common/enums/index","common/messaging/messaging","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getService=function(e,t){var r=this.map.get(e);if(!r)return null;var o=r.delegated,i;if(!t&&o)throw new Error("Must provide a target for delegated service [ "+e+" ]");if(t&&!o)throw new Error("Target not supported for non-delegated service [ "+e+" ]");return o?new r.ctor(t):this.instances[e]},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this),window.basicAuth=this.getService(o.ServiceType.BasicAuth)},t.prototype.call=function(e,t,r,o,n){void 0===r&&(r=[]);try{i.callMethod(this.getService(e),t,r,o,n)}catch(e){i.handleCallbackError(e,o)}},t}(r.ProviderAbstract);function a(e,t,r,o,s){n.getContentScriptInterfaces(e).then(function(e){return e.forEach(function(e){if("function"!=typeof s)return new Promise(function(i,n){e.LPModule.callService(t,r,o,function(e,t){return e?n(e):i(t)})});e.LPModule.callService(t,r,o,s)})}).catch(function(e){i.handleCallbackError(e,s)})}t.ServiceProvider=s,t.callContentScriptService=a}),o("background/services/auto-fill/delegated-auto-fill.service",["require","exports","common/decorators/index","common/enums/index","background/services/service-provider"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.target=e}return e.prototype.initialize=function(){},e.prototype.fill=function(e){return n(this,void 0,void 0,function(){return s(this,function(t){return i.callContentScriptService(this.target,o.ServiceType.AutoFill,"fill",[e]),[2]})})},e=a([r.RegisterService(o.ServiceType.AutoFill,!0)],e)}();t.DelegatedAutoFillService=u}),o("background/services/basic-auth/auth-credential",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===o&&(o=!1),this.url=e,this.userName=t,this.password=r,this.suppliedBefore=o,this.cancelled=!1}return e}();t.AuthCredential=r}),o("background/services/basic-auth/basic-auth.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/basic-auth/auth-credential"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.authCredentials={}}return e.prototype.initialize=function(){this.subscribeEvents()},e.prototype.subscribeEvents=function(){var e=this;i.LegacyGlobal.LPPlatform.onAuthRequired(function(t,r){if(i.LegacyGlobal.g_basicauth_feature_enabled&&"basic"===t.scheme){var o=e.authCredentials[t.tabId];if(o&&!o.cancelled&&!o.suppliedBefore)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url,o.userName,o.password,!0),e.removeAuth(r),{authCredentials:{username:o.userName,password:o.password}};if(!o)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url),{cancel:!0}}}),i.LegacyGlobal.LPPlatform.onTabClosed(function(t){e.removeAuth(t)})},e.prototype.removeAuth=function(e){var t;this.authCredentials[e]&&delete this.authCredentials[e]},e.prototype.isBasicAuth=function(e,t){var r=!1,o=!1;if(t&&t.tabID){var i=this.authCredentials[t.tabID];i&&(i.url!==t.tabURL?this.removeAuth(t.tabID):i.cancelled||(r=!0,o=i.suppliedBefore))}e(r,o)},e.prototype.setAuthCredential=function(e,t,r,o){var i=this.authCredentials[o.tabID];i.userName=e,i.password=t,r()},e.prototype.cancelBasicAuth=function(e){var t;this.authCredentials[e.tabID]&&(this.authCredentials[e.tabID].cancelled=!0)},e.prototype.hasFeature=function(e){e(!0)},e.prototype.isNotificationClosed=function(e){e("closed"===i.LegacyGlobal.localStorage_getItem("basicAuthPopupState"))},e.prototype.closeNotification=function(){i.LegacyGlobal.localStorage_setItem("basicAuthPopupState","closed")},e=a([r.RegisterService(o.ServiceType.BasicAuth)],e)}();t.BasicAuthService=s}),o("background/services/form-parser/field-parsers/field-parser.abstract",["require","exports","background/legacy"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.operations=[]}return e.regexMatches=function(e,t){var r=!1;if(e){var o=function(e,t){return"string"==typeof t&&e.test(t.toLowerCase())};Array.isArray(t)?t.forEach(function(t){return r=r||o(e,t)}):r=o(e,t)}return r},e.getFormFieldRegex=function(e){var t=r.LegacyGlobal.get_ff_translation(e);if(t)return new RegExp(t)},e.prototype.parse=function(e,t){for(var r=null,o=0,i=this.operations;o<i.length;o++){var n;if((r=(0,i[o])(e,t))||!1===r)break}return r},e}();t.FieldParserAbstract=o}),o("background/services/form-parser/field-parsers/password-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/index","background/background.module","background/legacy"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var s=e.call(this)||this;return s.stringUtils=i.getService(o.ServiceType.StringUtils),s.siteService=i.getService(o.ServiceType.Site),t.excludedFields.length||(t.excludedFields=[{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_ssn_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_cccsc_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_securityanswer_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_captcha_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_ssn_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_cccsc_regexp")}]),n.LegacyGlobal.LPContentScriptFeatures.save_a_site_correct_username_assumptions?s.operations=[s.excludedFieldOperation,s.singlePasswordFieldOperation,s.multiplePasswordsOneExistingOperation,s.multiplePasswordOperation,s.passwordLikeAttribute]:s.operations=[s.excludedFieldOperation,s.multiplePasswordOperation,s.singlePasswordFieldOperation,s.multiplePasswordsOneExistingOperation,s.passwordLikeAttribute],s.operations=s.operations.map(function(e){return e.bind(s)}),s}return u(t,e),t.prototype.excludedFieldOperation=function(e,o){for(var i=0;i<e.fields.length;++i)for(var n=e.fields[i],s=0;s<t.excludedFields.length;++s){var a=t.excludedFields[s];if(a.regex){if("attr"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,[n.id,n.attributes.name]))return!1;if("text"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,n.label))return!1}}return null},t.prototype.singlePasswordFieldOperation=function(e,t){if(1===t.uniquePasswords.length){var r=t.uniquePasswords[0];return 2===t.passwordsByValue[r].count&&(2===e.fields.length?e.passwordChangeForm=!0:e.createAccountForm=!0),r}return null},t.prototype.multiplePasswordOperation=function(e,t){for(var r=0,o=t.uniquePasswords;r<o.length;r++){var i=o[r],n;if(t.passwordsByValue[i].count>1)return 2===t.uniquePasswords.length?(e.passwordChangeForm=!0,e.originalPassword=t.uniquePasswords[0]===i?t.uniquePasswords[1]:t.uniquePasswords[0]):e.createAccountForm=!0,i}return null},t.prototype.multiplePasswordsOneExistingOperation=function(e,t){if(2===t.uniquePasswords.length){var r=this.findMatchingPassword(this.siteService.getSites(e.url),t.uniquePasswords);if(r)return e.passwordChangeForm=!0,e.originalPassword=r,t.uniquePasswords[0]===r?t.uniquePasswords[1]:t.uniquePasswords[0]}return null},t.prototype.passwordLikeAttribute=function(e,t){for(var r=0,o=t.uniquePasswords;r<o.length;r++){var i=o[r],n=t.passwordsByValue[i].field,s=["pw","pass"];if(this.stringUtils.stringContains(n.attributes.name,s)||this.stringUtils.stringContains(n.id,s))return i}},t.prototype.findMatchingPassword=function(e,t){for(var r=0;r<e.length;++r){var o=this.siteService.findMatchingSitePassword(e[r],t);if(o)return o}return null},t.excludedFields=[],t}(r.FieldParserAbstract);t.PasswordFieldParser=s}),o("background/services/form-parser/field-parsers/user-name-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/service-type","background/legacy","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var i=e.call(this)||this;return i.isStrict=t,i.userNameRegEx=r.FieldParserAbstract.getFormFieldRegex("ff_username_regexp"),i.stringUtils=n.getService(o.ServiceType.StringUtils),i.isStrict?i.operations=[i.userNameLikeLabelOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation]:i.operations=[i.userNameLikeLabelOperation,i.singleTextFieldOperation,i.multipleTextFieldOperation,i.nearPasswordFieldOpeartion,i.existingUserNameOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation],i.operations=i.operations.map(function(e){return e.bind(i)}),i}return u(t,e),t.prototype.userNameLikeLabelOperation=function(e,t){if(this.userNameRegEx)for(var o=0,i=e.fields;o<i.length;o++){var n=i[o];if(r.FieldParserAbstract.regexMatches(this.userNameRegEx,n.label))return n.value}return null},t.prototype.userNameLikeAttributeOperation=function(e,t){for(var r=0,o=t.uniqueTextValues;r<o.length;r++){var i=o[r],n=t.textFieldsByValue[i].field,s="user";if(this.stringUtils.stringContains(n.attributes.name,s)||this.stringUtils.stringContains(n.id,s))return i}return null},t.prototype.singleTextFieldOperation=function(e,t){if(1===t.uniqueTextValues.length){var r=t.uniqueTextValues[0];return 2===t.textFieldsByValue[r].count&&(e.createAccountForm=!0),r}return null},t.prototype.multipleTextFieldOperation=function(e,t){for(var r=0,o=t.uniqueTextValues;r<o.length;r++){var i=o[r];if(t.textFieldsByValue[i].count>1)return e.createAccountForm=!0,i}return null},t.prototype.nearPasswordFieldOpeartion=function(e,t){for(var r=e.fields,o=1;o<r.length;++o){var i;if("password"===r[o].type){var n=r[o-1];if("password"!==n.type)return n.value}}return null},t.prototype.existingUserNameOperation=function(e,t){for(var r in i.LegacyGlobal.g_sites)if(t.uniqueTextValues.indexOf(i.LegacyGlobal.g_sites[r].unencryptedUsername)>-1)return i.LegacyGlobal.g_sites[r].unencryptedUsername;return null},t.prototype.uniqueEmailFieldOperation=function(e,r){for(var o=[],i=0,n=r.uniqueTextValues;i<n.length;i++){var s=n[i],a=s.match(t.emailRegex);a&&1===a.length&&o.push(s)}return 1===o.length?o[0]:null},t.emailRegex=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/g,t}(r.FieldParserAbstract);t.UserNameFieldParser=s}),o("background/services/form-parser/field-parsers/index",["require","exports","background/services/form-parser/field-parsers/password-field-parser","background/services/form-parser/field-parsers/user-name-field-parser"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),o("background/services/form-parser/parsed-form",["require","exports","background/background.module","common/enums/index","background/services/form-parser/form-meta-data","background/services/form-parser/field-parsers/index","background/legacy"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.formProfile=null,this.userNameField=null,this.metaData=null,this._succeeded=!1,this._submitted=!1;var a=r.getService(o.ServiceType.Site);if(e.fields=e.fields||[],this.metaData=new i.FormMetaData(e),!e.password)if(s.LegacyGlobal.LPContentScriptFeatures.save_a_site_correct_username_assumptions){var u=(new n.PasswordFieldParser).parse(e,this.metaData);e.generatedPassword?e.password=e.generatedPassword:"string"==typeof u&&(e.password=u)}else{var u;if(e.generatedPassword)e.password=e.generatedPassword;else"string"==typeof(u=(new n.PasswordFieldParser).parse(e,this.metaData))&&(e.password=u)}var c,l=new n.UserNameFieldParser(t&&t.strict).parse(e,this.metaData),d=[],p;"string"==typeof l&&(d=a.getSites(e.url).filter(function(e){return a.hasMatchingSiteUserName(e,l)}),e.username&&0===d.length&&!e.createAccountForm||(e.username=l));if(e.username&&!e.createAccountForm)for(var f=0,m=e.fields;f<m.length;f++){var v=m[f];if(v.value===e.username){this.userNameField=v;break}}this.formProfile=e,this._submitted=!e.generatedPassword}return e.prototype.submitted=function(e){return"boolean"==typeof e&&(this._submitted=e),this._submitted},e.prototype.succeeded=function(e){return"boolean"==typeof e&&(this._succeeded=e),this._succeeded},e.prototype.getUsernameField=function(){return this.userNameField},e.prototype.getUsername=function(){return this.formProfile.username},e.prototype.getPassword=function(){return this.formProfile.password},e.prototype.getOriginalPassword=function(){return this.formProfile.originalPassword},e.prototype.getFormProfile=function(){return this.formProfile},e.prototype.getFormMetaData=function(){return this.metaData},e.prototype.getFields=function(){return this.formProfile.fields},e.prototype.isChangePasswordForm=function(){return!!this.formProfile.passwordChangeForm},e.prototype.isCreateAccountForm=function(){return!!this.formProfile.passwordChangeForm||!!this.formProfile.generatedPassword},e.prototype.isBasicAuthentication=function(){return!!this.formProfile.basicAuthentication},e.prototype.shouldSaveFields=function(){return!this.isChangePasswordForm()&&!this.isCreateAccountForm()},e.prototype.getURL=function(){return this.formProfile.url},e}();t.ParsedForm=a}),o("background/services/form-parser/form-parser.service",["require","exports","common/decorators/index","common/enums/index","background/services/form-parser/parsed-form"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.parse=function(e,t){return new i.ParsedForm(e,t)},e=a([r.RegisterService(o.ServiceType.FormParser)],e)}();t.FormParserService=n}),o("background/services/segment/events/save-site-dialog",["require","exports","common/enums/index","background/legacy","common/enums/save-site-action"],function(e,t,r,o,a){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){if(this.sourceTabId=e,this.properties=t,this.type=r.SegmentEventType.SaveSiteDialog,!e||"number"!=typeof e)throw new TypeError("Missing a valid source tab ID.");if(!t)throw new TypeError('Missing "properties" argument.');if(!t.saveSiteEvent)throw new TypeError('Missing "saveSiteEvent" property.');if(!t.defaultData||void 0===t.matchingSites)throw new TypeError("Unable to retrieve necessary site data from properties.");if(t.saveSiteEvent===r.SaveSiteDialogEventType.SaveSiteDialogAction)throw new TypeError("Action argument required for SaveSiteDialogAction events.")}return e.prototype.getProperties=function(){return n(this,void 0,void 0,function(){var e,t,o;return s(this,function(n){switch(n.label){case 0:return[4,this.getTabState(this.sourceTabId)];case 1:return e=n.sent(),t=this.getCommonProperties(e,this.properties),[2,o=i({},t,{Action:a.SaveSiteAction[this.properties.action],saveSiteEvent:r.SaveSiteDialogEventType[this.properties.saveSiteEvent]})]}})})},e.prototype.getCommonProperties=function(e,t){var r=t.sameDomain,o=t.generatedPassword,i=this.getViewState(),n;return{"Domain Sites":this.getDomainSites(e),"Matching Sites":this.getMatchingSites(e),Domain:this.getDomain(e,t),"Domain Changed":!r,"Generated Password":o,"View State":i}},e.prototype.getTabState=function(e){return n(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){return o.LegacyGlobal.LPTabState.getStateByTabId(e,t)})];case 1:return(t=r.sent())?[2,t]:[2,null]}})})},e.prototype.getViewState=function(){var e=this.properties,t=e.matchingSites,r=e.generatedPassword,o=e.sameDomain,i=e.dialogData;if(!t)return"Unknown";switch(t.length){case 0:return r&&o&&i&&!i.preSubmit?"Add Auto":"Add";case 1:return r&&o&&i&&!i.preSubmit?"Update Auto":"Update";default:return"Update Select"}},e.prototype.getMatchingSites=function(e){var t=this.properties,r=t.matchingSites,o=t.defaultData,i=e.getMatchingSites();return i&&void 0!==i.length?i.length:r?r.length:0},e.prototype.getDomainSites=function(e){var t=this.properties.defaultData,r=e.getDomainSites();return r&&void 0!==r.length?r.length:t&&void 0!==t.domainSites?t.domainSites.length:0},e.prototype.getDomain=function(e,t){var r=t.defaultData,i;return t.sameDomain?e.domain:o.LegacyGlobal.lp_gettld_url(r.url)},e}();t.SaveSiteDialogEvent=u}),o("background/services/segment/events/event.factory",["require","exports","background/services/segment/events/index","common/enums/index"],function(e,t,r,o){function i(e,t,i){return n(this,void 0,void 0,function(){var n,a,u;return s(this,function(s){switch(s.label){case 0:switch(a="properties",e){case o.SegmentEventType.SaveSiteDialog:a="saveSiteDialogProperties",n=new r.SaveSiteDialogEvent(t,i);break;default:throw new Error("Unsupported Segment Event type: "+e)}return[4,n.getProperties()];case 1:return u=s.sent(),[2,[a,u]]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.createSegmentEvent=i}),o("background/services/segment/events/index",["require","exports","background/services/segment/events/save-site-dialog","background/services/segment/events/event.factory"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),o("background/services/segment/segment.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/segment/events/index","common/messaging/messaging"],function(e,t,r,o,i,u,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){i.LegacyGlobal.sendLpImprove(e,t)},e.prototype.sendTypedEvent=function(e,t){return n(this,void 0,void 0,function(){var r,i,n,a,l,d;return s(this,function(s){switch(s.label){case 0:return i=o.SegmentEventType[e],console.assert(i,"Segment event "+e+" is not a valid event!"),i?(n=c.getInvokatingMessageContext(),[4,u.createSegmentEvent(i,n.calleeTab.tabID,t)]):[3,2];case 1:a=s.sent(),l=a[0],(d=a[1])&&this.send(i,((r={})[l]=JSON.stringify(d),r)),s.label=2;case 2:return[2]}})})},a([r.Visible],e.prototype,"sendTypedEvent",null),e=a([r.RegisterService(o.ServiceType.Segment)],e)}();t.SegmentService=l}),o("background/services/site/site.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.siteGroups=new Map}return e.prototype.initialize=function(){this.stringUtils=n.getService(o.ServiceType.StringUtils)},e.prototype.getSites=function(e){var t=i.LegacyGlobal.lp_gettld_url(e),r=this.siteGroups.get(e)||{accountsVersion:NaN,sites:[]};return r.accountsVersion!==i.LegacyGlobal.g_local_accts_version&&(r.accountsVersion=i.LegacyGlobal.g_local_accts_version,r.sites=i.LegacyGlobal.reorderOnURL(i.LegacyGlobal.getsites(t),e),this.siteGroups.set(e,r)),r.sites},e.prototype.findSites=function(e,t,r){var o=this;return this.getSites(e).filter(function(e){return o.hasMatchingSiteUserName(e,t)}).filter(function(e){return o.findMatchingSitePassword(e,r)})},e.prototype.getMatchingSites=function(e,t,r){var o=this,i=this.getSites(e);if(i.length>0){if(t)return i.filter(function(e){return o.hasMatchingSiteUserName(e,t)});if(r)return i.filter(function(e){return o.findMatchingSitePassword(e,r)})}return i},e.prototype.getUserNames=function(e){return this.getSites(e).map(function(e){return e.unencryptedUsername})},e.prototype.decrypt=function(e,t){return i.LegacyGlobal.lpmdec_acct(t,!0,e,i.LegacyGlobal.g_shares)},e.prototype.findMatchingSitePassword=function(e,t){Array.isArray(t)||(t=[t]);var r=t.indexOf(this.decrypt(e,e.password));if(-1===r&&e.fields&&e.fields.length>0)for(var o=0;o<e.fields.length;++o){var i=e.fields[o];if("password"===i.type&&(r=t.indexOf(this.decrypt(e,i.value)))>-1)break}return r>-1?t[r]:null},e.prototype.hasMatchingSiteUserName=function(e,t){if(!t)return!1;if(this.userNamesMatch(e.unencryptedUsername,t))return!0;if(e.fields&&e.fields.length)for(var r=0,o=e.fields;r<o.length;r++){var i=o[r];switch(i.type){case"text":case"email":case"tel":if(this.userNamesMatch(this.decrypt(e,i.value),t))return!0}}return!1},e.prototype.userNamesMatch=function(e,t){return e===t||this.userNameInEmail(e,t)||this.userNameInEmail(t,e)||this.isMaskedUsername(e,t)},e.prototype.userNameInEmail=function(e,t){if(t&&t.indexOf("@")>-1){var r=t.split("@");return 2===r.length&&e===r[0]}return!1},e.prototype.isMaskedUsername=function(e,t){return!!this.stringUtils.containsMaskingCharacter(t)&&(e.length===t.length&&(e[0]===t[0]||e[e.length-1]===t[t.length-1]))},a([r.Visible],e.prototype,"getUserNames",null),e=a([r.RegisterService(o.ServiceType.Site)],e)}();t.SiteService=s}),o("background/services/web-request/web-request-shim.service",["require","exports","common/decorators/index","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){var e=this;this.webRequest=i.getService(o.ServiceType.WebRequest);var t=i.getService(o.ServiceType.Topic);t.subscribe(o.TopicType.LoginFinished,function(){e.webRequest.isEnabled()&&(t.subscribe(o.TopicType.ProcessedFormSubmit,function(t){var r=t.password,o=t.tabId,i=t.inputValues;r&&e.handleOnBefore(o,i,"NONE")}),t.subscribe(o.TopicType.PasswordFormSubmitted,function(t){var r=t.form,o=t.tabId;r&&e.handleOnCompleted(o,"NONE",200)}))})},e.prototype.handleOnBefore=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.addRequest({requestBody:{formData:{inputValues:t}},requestId:r,tabId:e,method:void 0,url:void 0,timeStamp:void 0,frameId:void 0,parentFrameId:void 0,type:void 0})},e.prototype.handleOnCompleted=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r})},e.prototype.handleOnError=function(e,t,r,o){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r,error:o})},a([r.Visible],e.prototype,"handleOnBefore",null),a([r.Visible],e.prototype,"handleOnCompleted",null),a([r.Visible],e.prototype,"handleOnError",null),e=a([r.RegisterService(o.ServiceType.WebRequestShim)],e)}();t.WebRequestShimService=n}),o("background/services/web-request/request-resolvers/request-resolver.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.type=e}return Object.defineProperty(e.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),e}();t.RequestResolverAbstract=r}),o("background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract",["require","exports","background/services/web-request/request-resolvers/request-resolver.abstract","background/legacy","background/services/form-parser/parsed-form","background/background.module","common/enums/index"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var r=e.call(this,t)||this;return r.siteService=n.getService(s.ServiceType.Site),r}return u(t,e),t.prototype.sendSegmentEvent=function(e,t,r){e.send("passwordsubmitted",{type:r,passwordSubmittedProperties:JSON.stringify(this.getPasswordSubmittedProperties(t))})},t.prototype.getPasswordSubmittedProperties=function(e){var t=new i.ParsedForm(e),r=e.fields.filter(function(e){var t;return"password"===e.type}).some(function(t){var r;return t.value===e.generatedPassword}),n=this.siteService.getMatchingSites(e.url,e.username).length,s;return{"Domain Sites":this.siteService.getSites(e.url).length,"Matching Sites":n,"Generated Password":r,"Input Counts":this.getInputCounts(t),"Password Changed":!!n&&this.isChangePassword(t),Settings:{"Show Save Site Notification Bar":o.LegacyGlobal.Preferences.get("showSaveNotificationBar"),"Show Change Notification Bar":o.LegacyGlobal.Preferences.get("showChangeNotificationBar"),"Never Add Site":o.LegacyGlobal.hasNeverSave(o.LegacyGlobal.g_currenturl,o.LegacyGlobal.lp_gettld_url(o.LegacyGlobal.g_currenturl))}}},t.prototype.getInputCounts=function(e){var t=e.getFormMetaData(),r=Object.keys(t.passwordsByValue).reduce(function(e,r){return e+t.passwordsByValue[r].count},0);return{Username:e.getUsername()?1:0,Password:r}},t.prototype.isChangePassword=function(e){var t=e.getFormProfile(),r=e.getPassword();if(t.currentPassword){if(t.originalPassword)return t.currentPassword!==t.originalPassword;if(this.siteService.getSites(t.url).length){var o=e.getUsername();if(o)return 0===this.siteService.findSites(t.url,o,t.originalPassword||r).length}}return!1},t}(r.RequestResolverAbstract);t.PasswordSubmittedRequestResolverAbstract=a}),o("background/services/web-request/request-resolvers/injected-password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.InjectedPasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"inject")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"inject",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.InjectedPasswordSubmittedResolver=n}),o("background/services/web-request/request-resolvers/password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.PasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"webrequest")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"webrequest",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.PasswordSubmittedResolver=n}),o("background/services/web-request/request-resolvers/index",["require","exports","background/services/web-request/request-resolvers/injected-password-submitted","background/services/web-request/request-resolvers/password-submitted"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),o("background/services/web-request/web-request.service",["require","exports","common/enums/index","common/decorators/index","background/legacy","background/background.module","background/services/web-request/request-resolvers/index"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){var e=this;this.requests={},this.trackedFormProfiles={},this.onBeforeRequestListener=function(t){e.shouldTrackRequest(t)&&(e.requests[e.getRequestKey(t.tabId,t.requestId)]=t)},this.onCompletedListener=function(t){var r=t.tabId,o=t.requestId,i=e.getTrackedFormProfile(e.getRequestKey(r,o));i&&e.requestResolvers[i.action].resolveSuccess(i.profile)},this.onErrorOccurredListener=function(t){var r=t.tabId,o=t.requestId,i=t.statusCode,n=t.error,s=e.getTrackedFormProfile(e.getRequestKey(r,o));s&&e.requestResolvers[s.action].resolveError(n,i)},"undefined"!=typeof browser?this.webRequestApi=browser.webRequest:"undefined"!=typeof chrome&&(this.webRequestApi=chrome.webRequest)}return e.prototype.trackFormSubmission=function(e,t){this.trackedFormProfiles[e]={profiles:t}},e.prototype.isApiSupported=function(){return!!this.webRequestApi&&this.features.get(r.FeatureType.WebRequestEnabled)&&!i.LegacyGlobal.g_isedge},e.prototype.isEnabled=function(){return this.features.get(r.FeatureType.PasswordSubmittedEvent)},e.prototype.addRequest=function(e){this.onBeforeRequestListener(e)},e.prototype.resolveRequest=function(e){var t=e.tabId,r=e.requestId,o=e.statusCode,i=e.error;i?this.onErrorOccurredListener({tabId:t,requestId:r,statusCode:o,error:i}):this.onCompletedListener({tabId:t,requestId:r,statusCode:o})},e.prototype.shouldTrackRequest=function(e){return e.requestBody&&!e.requestBody.error&&(e.requestBody.formData||e.requestBody.raw)&&!i.LegacyGlobal.hasNeverEnableLP(e.url,i.LegacyGlobal.lp_gettld_url(e.url))},e.prototype.takeRequest=function(e){var t=this;if(!this.requests[e])return null;var r=this.requests[e];if(r)delete this.requests[e];else{var o=this.parseRequestKey(e).tabId,i=[];Object.keys(this.requests).forEach(function(e){t.parseRequestKey(e).tabId===o&&(i.push(t.requests[e]),delete t.requests[e])}),i.length&&(r=i[0])}return r},e.prototype.requestHasFormData=function(e,t){return e.some(function(e){return e.fields.some(function(e){return""!==e.value&&-1!==t.indexOf(e.value)})})},e.prototype.getTrackedFormProfile=function(e){var t=this.takeRequest(e);if(!t)return null;var o=this.getSubmittedDataString(t),i=this.trackedFormProfiles[t.tabId];if(!(i&&i.profiles&&i.profiles.length&&o&&this.requestHasFormData(i.profiles,o)))return null;var n=null,s;if(o){if(!(n=i.profiles.filter(function(e){return e.fields.some(function(t){return!(!e.currentPassword||""===t.value)&&(t.value===e.currentPassword&&o.indexOf(t.value)>-1)})})[0]))return null;s=e.indexOf("NONE")>-1?r.ResolverType.InjectedPasswordSubmitted:r.ResolverType.PasswordSubmitted,delete this.trackedFormProfiles[t.tabId]}var a=this.parseRequestKey(e).tabId;return this.requestHasRecentlyResolved(a)?null:{profile:n,action:s}},e.prototype.requestHasRecentlyResolved=function(e){return this.didTabResolveLoginRequest(e,!0)},e.prototype.getSubmittedDataString=function(e){return e.requestBody?e.requestBody.formData?JSON.stringify(e.requestBody.formData):e.requestBody.raw.reduce(function(e,t){return e+String.fromCharCode.apply(null,new Uint8Array(t.bytes))},""):null},e.prototype.initialize=function(){var e=this;this.requestResolvers=this.setupRequestResolvers(),this.features=n.getRepository(r.RepositoryType.Feature);var t=n.getService(r.ServiceType.Topic);t.subscribe(r.TopicType.LoginFinished,function(){return e.setup()}),t.subscribe(r.TopicType.ClearData,function(){return e.teardown()}),i.LegacyGlobal.LPPlatform.onTabClosed(function(t){delete e.trackedFormProfiles[t],Object.keys(e.requests).forEach(function(r){return e.parseRequestKey(r).tabId===t&&delete e.requests[r]})})},e.prototype.destroy=function(){this.teardown()},e.prototype.setup=function(){if(this.isApiSupported()&&this.isEnabled()){var e={urls:["<all_urls>"],types:["xmlhttprequest","main_frame","sub_frame","other"]};this.webRequestApi.onBeforeRequest.addListener(this.onBeforeRequestListener,e,["requestBody"]),this.webRequestApi.onCompleted.addListener(this.onCompletedListener,e,null),this.webRequestApi.onErrorOccurred.addListener(this.onErrorOccurredListener,e)}},e.prototype.teardown=function(){this.isApiSupported()&&this.isEnabled()&&(this.webRequestApi.onBeforeRequest.removeListener(this.onBeforeRequestListener),this.webRequestApi.onCompleted.removeListener(this.onCompletedListener),this.webRequestApi.onErrorOccurred.removeListener(this.onErrorOccurredListener))},e.prototype.setupRequestResolvers=function(){var e=[];return e[r.ResolverType.PasswordSubmitted]=new s.PasswordSubmittedResolver,e[r.ResolverType.InjectedPasswordSubmitted]=new s.InjectedPasswordSubmittedResolver,e},e.prototype.getRequestKey=function(e,t){return t||(t="NONE"),e+"-"+t},e.prototype.parseRequestKey=function(e){var t=e.split("-"),r=t[0],o=t[1];return{tabId:parseInt(r,10),requestId:o}},e.prototype.getTabState=function(e){var t=i.LegacyGlobal.LPTabState.getStateByTabIdImmediate(e);return t||null},e.prototype.didTabResolveLoginRequest=function(e,t){var r=this.getTabState(e);if(!r)return!1;var o=r.getLoginRequestRecentlyResolved();return void 0!==t&&r.setLoginRequestRecentlyResolved(),o},a([o.Visible],e.prototype,"trackFormSubmission",null),a([o.Visible],e.prototype,"isApiSupported",null),a([o.Visible],e.prototype,"isEnabled",null),e=a([o.RegisterService(r.ServiceType.WebRequest)],e)}();t.WebRequestService=u}),o("background/services/index",["require","exports","background/services/auto-fill/delegated-auto-fill.service","background/services/basic-auth/basic-auth.service","background/services/form-parser/form-parser.service","background/services/segment/segment.service","background/services/service-provider","background/services/site/site.service","background/services/web-request/web-request-shim.service","background/services/web-request/web-request.service","common/services/topic/topic.service","common/services/utils/string-utils.service"],function(e,t,r,o,i,n,s,a,u,c,l,d){function p(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),p(r),p(o),p(i),p(n),p(s),p(a),p(u),p(c),p(l),p(d)}),o("background/background.module",["require","exports","background/repositories/index","background/services/index","common/decorators/index","common/module.abstract","background/legacy"],function(e,t,r,o,i,a,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return window.addEventListener("beforeunload",function(){t.serviceProvider.teardown(),t.repositoryProvider.teardown()}),t}return u(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.initialize=function(){return n(this,void 0,void 0,function(){return s(this,function(e){return this.repositoryProvider=new r.RepositoryProvider(i.getRepositoryRegistry()),this.serviceProvider=new o.ServiceProvider(i.getServiceRegistry()),this.repositoryProvider.initialize(),this.serviceProvider.initialize(),[2]})})},t.prototype.postInitialize=function(){return n(this,void 0,void 0,function(){return s(this,function(e){return this.repositoryProvider.postInitialize(),this.serviceProvider.postInitialize(),[2]})})},t.prototype.getServiceProvider=function(){return this.serviceProvider},t.prototype.getRepositoryProvider=function(){return this.repositoryProvider},t.prototype.getService=function(e){var t=this.serviceProvider.getService(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.prototype.getRepository=function(e){var t=this.repositoryProvider.getRepository(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.instance=null,t}(a.ModuleAbstract);function d(e){return n(this,void 0,void 0,function(){var t,r,o;return s(this,function(i){if(t=[],e.interface)t.push(e.interface);else{if(!e.tabId)throw new TypeError("Invalid target provided.");if(!(r=c.LegacyGlobal.LPTabs.get({tabID:e.tabId})))throw new TypeError("No tab with id "+e.tabId+" found.");if(o=void 0,e.frameId&&"top"!==e.frameId){if("number"!=typeof e.frameId)throw new TypeError("Unsupported frame id value: "+e.frameId);o=r.getFrame(e.frameId)}else o=r.getTop();if(!o)throw new TypeError("No content script interface found for tab "+e.tabId);t.push(o)}return[2,t]})})}function p(e){return l.getInstance().getService(e)}function f(e){return l.getInstance().getRepository(e)}function m(e){return l.getInstance().isInitialized(e)}function v(e,t,r,o,i){void 0===r&&(r=[]),l.getInstance().getServiceProvider().call(e,t,r,o,i)}function g(e,t,r,o,i){void 0===r&&(r=[]),l.getInstance().getRepositoryProvider().call(e,t,r,o,i)}t.getContentScriptInterfaces=d,t.getService=p,t.getRepository=f,t.isInitialized=m,t.callService=v,t.callRepository=g,t.default=l.getInstance()}),e.LPModule=r("background/background.module")}).call(this);
//# sourceMappingURL=sourcemaps/modules-background.js.map
