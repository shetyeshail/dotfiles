"use strict";function sendRequest(e){if(null!=e)if(e.cmd&&"popupfillinputget"!=e.cmd&&"popupfilliconnumber"!=e.cmd&&L("IF -> BG : cmd="+e.cmd),g_ischrome)try{chrome_runtime_sendMessage(e,function(){})}catch(e){}else g_issafari?safari.self.tab?safari.self.tab.dispatchMessage(e.cmd,e):safari.extension&&safari.extension.globalPage&&safari.extension.globalPage.contentWindow&&safari.extension.globalPage.contentWindow.message_handler({name:e.cmd,message:e,target:window}):g_isfirefoxsdk?(e.messagetype=e.cmd,send_message(e)):g_iscasper?"function"==typeof t_sendmsg&&t_sendmsg(e):bg.LPPlatform.postLegacyMessage({name:"message",message:e})}var g_reference_url="",InfieldMenuTimer=function(){var e;function n(){e=setTimeout(function(){$(".menuTriggered").removeClass("menuTriggered"),$(".dropdown").hide()},300)}function t(){void 0!=e&&clearTimeout(e)}return{startTimer:n,clearTimer:t}}(),InfieldIcons={pw:"fa-lock",sn:"fa-sticky-note",address:"fa-address-book",ccDefault:"fa-credit-card-alt",ccAmex:"fa-cc-amex",ccMastercard:"fa-cc-mastercard",ccDiscover:"fa-cc-discover",ccVisa:"fa-cc-visa",ccDiners:"fa-cc-diners-club",ccJcb:"fa-cc-jcb",ba:"fa-bank",dl:"fa-car",pp:"fa-globe",ssn:"fa-balance-scale",insurance:"fa-umbrella",member:"fa-barcode",wifi:"fa-wifi",db:"fa-database",server:"fa-server",ssh:"fa-user-secret",software:"fa-laptop",custom:"fa-puzzle-piece"},advancedOptionsViewed=!1,debounceWait=500,InfieldCommands=function(){function e(e){csTop.LPInfieldFrame.close(e)}function n(e){bg.InfieldCommands.editSite(e,!0)}function t(n){sendRequest({cmd:"autofillaid",aid:n,from_iframe:!0,no_manualfill_on_saveall:!0,fromiframe:1,source:"formv2"}),e("action")}function i(n){bg.InfieldCommands.copyUrl(n,!0),e("action")}function o(n){bg.InfieldCommands.copyUserName(n,!0),e("action")}function a(n){bg.InfieldCommands.copyPassword(n,!0,"formv2"),e("action")}function r(n,t,i){bg.InfieldCommands.copyProp(n,t,!0,i),e("action")}function s(e,n){bg.InfieldCommands.setGeneratePasswordPrefs({prefstr:e,genpwstr:n})}function c(n){bg.InfieldCommands.editFormFill(n,!0,"formv2"),e("action")}function d(n){bg.InfieldCommands.fillForm(n,!0,"formv2"),e("action")}function l(e,n){bg.copytoclipboard(e),h("copypass",{action:n,source:"formv2"})}function p(e){bg.InfieldCommands.getGeneratePasswordPrefs(e)}function u(n,t){bg.InfieldCommands.fillGeneratedPassword(n,t,!0),e("action")}function f(e,n,t){bg.InfieldCommands.searchVaultAll(e,n,t)}function g(e){bg.InfieldCommands.getPopupFillData(e)}function h(e,n){bg.sendLpImprove(e,n)}return{closePopup:e,copyToClipboard:l,editSite:n,fillUsernamePass:t,copyUrl:i,copyUserName:o,copyPassword:a,copyProp:r,editFormFill:c,fillForm:d,getGeneratePrefs:p,writeAllPrefs:s,fillGeneratedPassword:u,searchVault:f,getInitialData:g,sendLPImprove:h}}();!function(e){var n=function(n,t,i){var o=this;o._onResizeCallback=i,n&&(n instanceof jQuery?o._triggerElement=n:o._triggerElement=e("#"+n),t?(o._triggerElement.click(function(e){o.show(),o._setPosition(e)}),o._triggerElement.keypress(function(n){o.show(),e(o._menuElement[0]).children().children()[0].focus(),o._setPosition(n)})):(o._triggerElement.children().click(function(e){o.show()}),o._triggerElement.children().keypress(function(n){o.show(),e(o._menuElement[0]).children().children()[0].focus()})))};n.prototype._setPosition=function(n){var t=e(n.currentTarget).offset();t.top+=20,t.left+=20,this._menuElement.offset(t)},n.prototype.show=function(){e(".dropdown").hide(),e(".menuTriggered").removeClass("menuTriggered");var n=this,t;n._triggerElement.closest(".tile").addClass("menuTriggered"),n._triggerElement.addClass("menuTriggered"),this._menuElement&&this._menuElement.show(0,function(){n._onResizeCallback&&n._onResizeCallback(n._menuElement.height(),90)})},n.prototype.hide=function(e){var n=this,t;n._triggerElement.closest(".tile").removeClass("menuTriggered"),n._triggerElement.removeClass("menuTriggered"),n._triggerElement.blur(),this._menuElement&&(this._menuElement.hide(e),n._onResizeCallback(),n._triggerElement.trigger("reset"))},n.prototype.createMenu=function(n,t,i){var o=this;return o._menuElement=e("<div></div>").attr("id",n+"Menu").addClass("dropdown").addClass(t).hide().hover(function(){var e=o._triggerElement.closest(".tile");InfieldMenuTimer.clearTimer()},function(){InfieldMenuTimer.startTimer()}).append(o._createMenuItems(i)),o._menuElement},n.prototype._createMenuItems=function(n){var t=this;t._menuItems=n;for(var i=e("<ul></ul>").addClass("menuList"),o=0;o<t._menuItems.length;o++){var a=e("<li></li>").attr("data-viewId",t._menuItems[o].id).attr("tabindex","1").click(function(e){t._triggerElement.trigger("reset",["action"]),t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).keypress(function(e){t._triggerElement.trigger("reset",["action"]),t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).append(e("<p></p>").text(t._menuItems[o].text));i.append(a)}return i},n.prototype._findMenu=function(n){var t=e.grep(this._menuItems,function(e){return e.id===n});return t&&t.length>0?t[0]:null},n.prototype.select=function(e,n){var t=this._findMenu(e);t&&this._triggerElement&&this._triggerElement.find("p").text(t.selectedText),!0===n&&t&&t.action&&t.action()},window.InfieldMenu=n}(jQuery);var InfieldView=function(e){var n=[];function t(e){Array.isArray(e)&&e.length>0&&(n=e,o())}function i(t){-1!=n.indexOf(t)&&("generatePassView"!==t?(o(),e(".views").show()):(o(),e("#"+t).show()))}function o(){e(".views").hide(),e("#generatePassView").hide()}return{init:t,show:i}}(jQuery),InfieldGeneratePassword=function(e){function n(n,i){e("#moreOptions").click(function(){d(),i&&i()}),e(".iconMoreInfo").hover(function(){e(this).children().fadeIn(200)},function(){e(this).children().fadeOut(100)}),e("#showHistory").click(function(){u(),i&&i()}),e("#lengthInput").on("input",function(){InfieldSearch.debounce(a(e("#lengthInput").val()),debounceWait)}),e("#length").on("input",function(){InfieldSearch.debounce(a(e("#length").val()),debounceWait)}),g_isedge&&e("#length").on("mouseup",function(){t()}),e(".pwgen").change(t),e("#generateBtn").click(t),e("#pronounceable").click(function(){e("#pronounceable").prop("checked")?(e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#ambig").prop("checked",!1),e("#all").prop("checked",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)):(e("#digits").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("checked",!0),e("#special").prop("disabled",!1))}),e("#ambig").click(function(){e("#ambig").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#all").prop("checked",!1),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#all").click(function(){e("#all").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#ambig").prop("checked",!1),e("#digits").prop("checked",!0),e("#special").prop("checked",!0),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#password").on("copy",function(){bg.LPTabState.setCopiedGeneratedPassword(this.value)}).LP_addGeneratePasswordMeter(!0),e("#btnCopy").click(function(){var t=e("#password").val();n.copyToClipboard(t,"generatepassword"),f(),bg.LPTabState.setCopiedGeneratedPassword(t),e(this).children().fadeIn(1,function(){e(this).fadeOut(1200)})}),e("#clearHistory").bind("click",function(){g()});var o=function(){var t=e("#password").val();n.fillGeneratedPassword(t,{pronounceable:e("#pronounceable").prop("checked"),length:e("#password").val().length,expand:advancedOptionsViewed,uppercase:e("#upper").prop("checked"),lowercase:e("#lower").prop("checked"),numeric:e("#digits").prop("checked"),special:e("#special").prop("checked"),avoidAmbiguous:e("#ambig").prop("checked"),passwordType:c(),source:"formv2",variation:"new",generatedPasswordCount:e("#generatedPasswordCount").val()}),n.writeAllPrefs(JSON.stringify({generate_allcombos:e("#all").prop("checked")?1:0,generate_pronounceable:e("#pronounceable").prop("checked")?1:0,generate_length:e("#length").val(),generate_upper:e("#upper").prop("checked")?1:0,generate_lower:e("#lower").prop("checked")?1:0,generate_digits:e("#digits").prop("checked")?1:0,generate_special:e("#special").prop("checked")?1:0,generate_ambig:e("#ambig").prop("checked")?1:0,generate_mindigits:2,generate_reqevery:0})),bg.GenPassHistory.add(t)};e("#fillPasswordBtn").click(o),e("#generateAndFillBtn").click(o),e("#generateAndFillBtn").keypress(o),m(),e("#password").on("change paste keyup",function(e){m()}),e("#advancedView").hide(),e("#generateBtnContainer").hide(),e("#history").hide(),e("#clearHistory").hide()}function t(){h(),e("#generatedPasswordCount").val(function(){return parseInt(e("#generatedPasswordCount").val())+1});var n=lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),e("#all").prop("checked"),e("#pronounceable").prop("checked"));e("#password").val(n).change()}function i(){var n=bg.get("g_prefoverrides").sitepwlen;n&&(n=JSON.parse(n),bg.get_selected_tab_data_no_extension(null,function(t){var i=bg.lp_gettld_url(t.url);if(n[i]){var o=n[i],r=Math.max(e("#length").val(),o);e("#length").attr({min:o}),a(r)}}))}function o(n){i();var t=JSON.parse(n.prefstr);e("#length").val(parseInt(t.generate_length)),e("#upper").prop("checked",!!parseInt(t.generate_upper)),e("#lower").prop("checked",!!parseInt(t.generate_lower)),e("#digits").prop("checked",!!parseInt(t.generate_digits)),e("#special").prop("checked",!!parseInt(t.generate_special)),e("#ambig").prop("checked",!!parseInt(t.generate_ambig)),e("#all").prop("checked",!!parseInt(t.generate_allcombos)),e("#advancedView").hide(),e("#generateAndFillView").show(),parseInt(t.generate_pronounceable)?r():e("#pronounceable").prop("pronounceable",!1),e("#ambig").prop("checked")||e("#pronounceable").prop("checked")||s(),parseInt(parseInt(t.generate_length))?a(parseInt(t.generate_length)):a(10),bg.GenPassHistory.getWithReadableDate(f.bind(this)),e("#password").val(lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),e("#all").prop("checked"),e("#pronounceable").prop("checked"))).change()}function a(n){n>99&&(n=99),e("#length").val(n);var t=e("#length"),i=t.val(),o=t.attr("min"),a,r=(i-o)/(t.attr("max")-o)*100;e("#sliderFill").width(r+"%"),e("#lengthInput").val(n)}function r(){e("#pronounceable").prop("checked")||e("#pronounceable").prop("checked",!0),e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)}function s(){e("#all").prop("checked")||e("#all").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)}function c(){return e("#ambig").prop("checked")?"ambig":e("#pronounceable").prop("checked")?"pronounceable":"all"}function d(){advancedOptionsViewed=!0,e("#advancedView").toggle(),e("#generateBtnContainer").toggle(),e("#moreOptions").html(e("#moreOptions").text()==Strings.translateString("Show Options")?Strings.translateString("Hide Options"):Strings.translateString("Show Options"))}function l(){e("#moreOptions").show(),e("#fillPasswordBtn").show(),e("#generateBtnContainer").hide()}function p(){e("#moreOptions").hide(),e("#fillPasswordBtn").hide(),e("#generateBtnContainer").hide()}function u(){"Show History"==e("#showHistory").text()?(e("#showHistory").html("Hide History"),e("#advanced-features").hide(),e("#history").show(),e("#clearHistory").show(),InfieldCommands.sendLPImprove("historyviewed",{source:"formv2"})):(e("#showHistory").html("Show History"),e("#advanced-features").show(),e("#history").hide(),e("#clearHistory").hide())}function f(n){var t=e("#historyTable"),i=e("#historyBody"),o=e("#historyEmptyState");n&&0!==n.length?(i.empty(),n.forEach(function(e){var n=LPTools.createElement("tr");n.appendChild(LPTools.createElement("td","",e.password)),n.appendChild(LPTools.createElement("td","",Strings.translateString(e.date))),i.append(n)}),t.show(),o.hide()):(t.hide(),o.show())}function g(){bg.GenPassHistory.clear(),e("#historyBody").empty(),e("#historyTable").hide(),e("#historyEmptyState").show(),InfieldCommands.sendLPImprove("historycleared",{source:"formv2"})}function h(){var n=e("#password").val();n&&n.length>0&&(bg.GenPassHistory.add(n),bg.GenPassHistory.getWithReadableDate(f.bind(this)))}function m(){e("#password").val().length>0?e("#fillPasswordBtn").removeAttr("disabled"):e("#fillPasswordBtn").attr("disabled","disabled")}return{init:n,setup:o,show:l,hide:p}}(jQuery),InfieldTiles=function(e,n,t,i){var o="hovered",a=i.translateString("Copy..."),r=i.translateString("Edit"),s=i.translateString("Fill"),c="<div></div>",d;function l(t,o,a,s,c,l){d=c;var u=[];if(e("#"+t).empty().append(e('<p class="italic"></p>').text(l)),a){var f=[],h=e.map(a,function(e,n){return e&&e.language&&e.language.length>1&&-1===f.indexOf(e.language.substr(0,2))&&f.push(e.language.substr(0,2)),e});h.sort(function(e,n){if(void 0===e.name){var t=e.noteType,i=e.decprofilename;return void 0===t&&(t="undefined"),void 0===i&&(i="undefined"),L("BAD_NAME FOUND - ABORT TILE SORT - userId:"+(e.aid||e.ffid)+" noteType:"+t+" decprofname:"+i),0}return e.name.localeCompare(n.name)}),e.each(h,function(e,t){var a=!1;e+1===h.length&&(a=!0);var c=g(o,{id:t.aid||t.ffid,name:"sites"===o?t.name:t.decprofilename,description:"sites"===o?t.unencryptedUsername||t.useusername:null!==t.description?t.description:null,icons:p(s,o,t),noteType:t.notetype,moreText:"sites"===o?i.translateString("More"):r,language:f.length>1?t.language.substr(0,2):null,moreHandler:"sites"===o?null:function(){n.editFormFill(t.aid||t.ffid)},clickHandler:"sites"===o?function(){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_FILLED),n.fillUsernamePass(t.aid)}:function(){n.fillForm(t.aid||t.ffid)},lastTile:a});c&&u.push(c)}),u.length>0?e("#"+t).empty().append(u):"sites"==o&&e("#"+t).empty().append(e('<p class="italic"></p>').text(l))}return u.length}function p(n,t,i){var o="",a="",r;if("formfills"===t)if(0==i.profiletype)o=InfieldIcons.profile;else switch(i.notetype){case"Credit Card":o=u(i.ccType);break;case"Bank Account":o=InfieldIcons.ba;break;case"Social Security":o=InfieldIcons.ssn;break;case"Address":o=InfieldIcons.address;break;default:if(i.notetype.includes("Custom_")){o=InfieldIcons.custom;break}o=InfieldIcons.pw}else a="icon-site",o=n&&i.aid&&n[i.aid]?n[i.aid]:InfieldIcons.pw;return{normalEl:r=0!=i.profiletype&&"formfills"===t?e("<span/>").addClass("omarImgIcon fa fa-fw fa-2x "+o).attr("aria-hidden","true"):o==InfieldIcons.pw?e("<span/>").addClass("omarImgIcon fa fa-fw fa-2x "+o).attr("aria-hidden","true"):e("<img/>").attr("src",o).addClass("icon-default omarImgIcon "+a)}}function u(e){if(!e||!e.length)return InfieldIcons.ccDefault;switch(e){case"AMEX":return InfieldIcons.ccAmex;case"MC":return InfieldIcons.ccMastercard;case"DISC":return InfieldIcons.ccDiscover;case"VISA":return InfieldIcons.ccVisa;case"DINERS":return InfieldIcons.ccDiners;case"JCB":return InfieldIcons.ccJcb;case"GENERIC":default:return InfieldIcons.ccDefault}}function f(n){return e(c).addClass("col-2 cardIcon no-left-gutter no-right-gutter").append(e(c).addClass("icon").append(n))}function g(l,p){if(!p)return null;var u=null,g=null,h=null,m=e(c).addClass("col-10 cardBody"),w=e(c).addClass("cardInside"),v=e(c).addClass("fa-lg fa-stack"),y=e("<i></i>").addClass("fa fa-clone").attr("aria-hidden","true"),b=e(c).addClass("fa fa-caret-down fa-stack-1x fontAwesomeIcon").attr("aria-hidden","true"),I=e(c).addClass("fa fa-circle fa-stack-1x circle");I.append(b),v.append(y),v.append(I);var C=e("<i></i>").addClass("fa fa-pencil fa-lg").attr("aria-hidden","true"),k=e(c).attr("id",p.id+"copyBtn").attr("tabindex","1").addClass("copyAction").append(v),P=e(c).attr("id",p.id+"editBtn").attr("tabindex","2").addClass("editAction").append(C);h=e(c).addClass("cardMainAction").text(s),m.hover(function(){h.addClass(o),w.addClass(o)},function(){h.removeClass(o),w.removeClass(o)}),w.append(e(c).addClass("cardPrimary").text(p.name+(p.language?" ("+p.language+")":""))),w.append(e(c).addClass("cardSecondary").text(p.description||String.fromCharCode(160))),m.append(h),m.append(w);var T=e(c).addClass("cardActions no-right-gutter no-left-gutter").append(k,P);u=new t(k,!0,d),T.hover(function(){InfieldMenuTimer.clearTimer()},function(){InfieldMenuTimer.startTimer()});var _=[],S;bg.InfieldCommands.canCopy(function(t){t?"sites"===l?(_.push({id:"copyPassword",text:i.translateString("Copy password"),action:function(){n.copyPassword(p.id)}}),_.push({id:"copyUsername",text:i.translateString("Copy username"),action:function(){n.copyUserName(p.id)}}),_.push({id:"copyURL",text:i.translateString("Copy URL"),action:function(){n.copyUrl(p.id)}})):"Credit Card"===p.noteType?(_.push({id:"copyCardNum",text:i.translateString("Copy card number"),action:function(){n.copyProp(p.id,"Number")}}),_.push({id:"copySecurityCode",text:i.translateString("Copy security code"),action:function(){n.copyProp(p.id,"Security Code")}})):"Bank Account"===p.noteType?(_.push({id:"copyAccountNum",text:i.translateString("Copy account number"),action:function(){n.copyProp(p.id,"Account Number")}}),_.push({id:"copyRoutingNum",text:i.translateString("Copy routing number"),action:function(){n.copyProp(p.id,"Routing Number")}})):"Social Security"===p.noteType?_.push({id:"copySSN",text:i.translateString("Copy SSN"),action:function(){n.copyProp(p.id,"Number")}}):"Address"===p.noteType&&(_.push({id:"copyFirstName",text:i.translateString("Copy first name"),action:function(){n.copyProp(p.id,"First Name")}}),_.push({id:"copyLastName",text:i.translateString("Copy last name"),action:function(){n.copyProp(p.id,"Last Name")}}),_.push({id:"copyAddressFirst",text:i.translateString("Copy address 1"),action:function(){n.copyProp(p.id,"Address 1")}}),_.push({id:"copyCity",text:i.translateString("Copy city/town"),action:function(){n.copyProp(p.id,"City / Town")}}),_.push({id:"copyZip",text:i.translateString("Copy zip/postal code"),action:function(){n.copyProp(p.id,"Zip / Postal Code")}}),_.push({id:"copyEmail",text:i.translateString("Copy email address"),action:function(){n.copyProp(p.id,"Email Address")}}),_.push({id:"copyPhone",text:i.translateString("Copy phone number"),action:function(){n.copyProp(p.id,"Phone","num")}})):e("#btnCopy").hide(),_.length?((g=u.createMenu("copy","tileDropdown",_)).hover(function(){InfieldMenuTimer.clearTimer()},function(){InfieldMenuTimer.startTimer()}),e("#menuContainer").append(g),k.click(function(e){e.stopPropagation(),u.show()}),k.bind("reset",function(e,n){E.removeClass("triggered"),!n&&m.hasClass(o)||(y.removeClass(o),I.removeClass(o)),h&&(h.text(s),w.hasClass(o)||h.removeClass(o))}),k.hover(function(){g&&g.is(":visible")||(y.addClass(o),I.addClass(o),h&&(h.text(a),h.addClass(o)))},function(){g&&g.is(":visible")||k.hasClass("menuTriggered")||(y.removeClass(o),I.removeClass(o),h&&(h.text(s),m.hasClass(o)||h.removeClass(o)))})):k.hide()}),P.click(function(e){e.stopPropagation(),"sites"===l?n.editSite(p.id):"formfills"===l&&n.editFormFill(p.id)}),P.hover(function(e){g&&g.is(":visible")||(C.addClass(o),h&&(h.text(r),h.addClass(o)))},function(){g&&g.is(":visible")||(C.removeClass(o),h&&(h.text(s),h.removeClass(o)))}),new MutationObserver(function(e){e.forEach(function(e){var n;"class"==e.attributeName&&(e.target.classList.contains("menuTriggered")||e.target.children[0].firstChild.classList.contains("hovered")&&(y.removeClass(o),I.removeClass(o)))})}).observe(k[0],{attributes:!0,childList:!0});var x=f([p.icons.normalEl]),E=e(c).addClass("cardContainer col-12").attr("id",p.id).attr("tabindex","1").append(e(c).addClass("omarCard").append(x,m,T)).hover(function(){T.addClass(o),m.addClass(o)},function(){k.hasClass("menuTriggered")||(E.removeClass("triggered"),T.removeClass(o),m.removeClass(o),w.removeClass(o),h&&h.removeClass(o))});return E.click(p.clickHandler),p.lastTile&&E.addClass("lastTile"),e(".copyAction",".editAction").focus(function(){E.addClass("triggered")}).blur(function(){E.removeClass("triggered")}).click(function(){E.addClass("menuTriggered"),E.removeClass("triggered")}),E}return e("#menuContainer").empty(),{setup:l}}(jQuery,InfieldCommands,InfieldMenu,Strings),InfieldSearch=function(e){var n,t,i,o,a,r=250;function s(r){if(t=e("#searchContainer"),i=e("#inlineSearch"),o=e("#searchCloseBtn"),a=e("#searchBtn"),n=e("#headerMain"),p(),e("#searchBtn").click(function(){e(this).hasClass("search")&&d()}).keypress(function(){e(this).hasClass("search")&&d()}),e("#searchCloseBtn").click(function(){l(),r("")}).keypress(function(){l(),r("")}),r){var s=c(function(n){r(e(n.currentTarget).val())},debounceWait);i.keyup(s)}e("#inlineSearch").focus(function(){e(".searchBar").addClass("hoverOver").fadeIn(100)}),e("#inlineSearch").focusout(function(){e(".searchBar").removeClass("hoverOver")})}function c(e,n){var t;return function(){var i=this,o=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(i,o)},n)}}function d(){t.show(),n.hide(),t.animate({},r,function(){o.show(),i.fadeIn().focus()}),a.addClass("searchBtnActive")}function l(){t.hide(),n.show(),t.animate({},r,function(){o.hide(),i.fadeOut()}),i.val(""),a.removeClass("searchBtnActive")}function p(){t.hide(),a.removeClass("searchBtnActive")}function u(){t.show()}function f(){i.hide(),o.hide(),t.hide()}function g(e){e&&!0===e?u():f()}return{init:s,debounce:c,showIcon:u,hideIcon:f,display:g}}(jQuery),lpInfield=function(e,n,t,o,a,r,s,c,d){var l,p,u=d.translateString("No passwords found for this site."),f=d.translateString("No passwords found for this site."),g=d.translateString("Nothing in your vault to fill on this site."),h=d.translateString("Nothing in your vault to fill on this site."),m=10,w=360;function v(){var t=Date.now();document.addEventListener("DOMContentLoaded",function(){C(function(){var t;d.translate(document.body),y(),I(),o.init(["sitesView","formFillView","generatePassView"]),r.init(k),s.init(n,T),new MutationObserver(function(){T()}).observe(e(".infield-dialog")[0],{subtree:!0,childList:!0}),n.getInitialData(x)})})}function y(){p=new c({$parentEl:e(".infield-dialog")}),b({position:w})}function b(n){p&&(n&&n.position&&e.isNumeric(n.position)&&n.position>m&&n.position<w?p.show("top",n.position):p.show(!1,!1))}function I(){e("#btnClose").click(function(){n.closePopup("close")}),e("#btnClose").keypress(function(){n.closePopup("close")})}function C(e){document.body.style.setProperty("display","none","important");var n=document.createElement("iframe");n.setAttribute("class","backgroundFrame"),n.src="backgroundFrame.html",n.style.display="none",n.addEventListener("load",function(){n.contentWindow.LPPlatform.getBackgroundInterface({mainRequestFramework:!1,interfaceDefinition:Interfaces.InfieldPopupInterface,getData:!0,context:"infieldPopup",callback:function(e){window.bg=e}}),n.contentWindow.Topics.get(n.contentWindow.Topics.REQUEST_FRAMEWORK_INITIALIZED).subscribe(function(n,t){var i=parseInt(n.topFrameID);window.csTop=Interfaces.createInstance(Interfaces.ContentScriptInterface,{direct:!1,context:"infieldPopup",requestFunction:function(e){t.sendRequest({type:"contentScriptRequest",data:e,frameID:i})}}),window.csTop.LPFrame.initializeRequestFramework(LPTools.getURLParams().dialogID,function(n){n&&(document.body.style.removeProperty("display"),e&&e())})})}),document.body.appendChild(n)}function k(e){n.searchVault(e,l.type,P)}function P(e){var n=l.type;if(e){var t=JSON.parse(e);t&&(a.setup("sitesView","sites",t.sites,t.bigicons,T,f),a.setup("formFillView","formfills",t.formfills,null,T,h))}}function T(n,t){var i=e(".infield-dialog").outerHeight()+20,o=e(".infield-dialog").outerWidth()+10;n&&e.isNumeric(n)&&(i+=n),t&&e.isNumeric(t)&&(o+=t),csTop.LPInfieldFrame.resizeFrame(i,o)}function _(n){e("#fillSelector").show();var t=JSON.parse(n.fillData.sites),i=n.fillData.bigIcons?JSON.parse(n.fillData.bigIcons):null;a.setup("sitesView","sites",t,i,T,u);var r=n.fillData.formFills?JSON.parse(n.fillData.formFills):{};return a.setup("formFillView","formfills",r,null,T,g),o.show("formFillView"),s.hide(),Object.keys(t).length+Object.keys(r).length}function S(){e("#fillSelector").hide(),o.show("generatePassView"),n.getGeneratePrefs(s.setup),s.show()}function x(t){if(t){if(l=t,t.type)switch(t.type){case"generate":S(),r.display(!1);break;case"formfills":e(".lblSites").insertAfter("#formFillView"),e("#sitesView").insertAfter(".lblSites");default:var o=_(t)}if("generate"!=t.type&&t.condensedDropdown&&!0===t.condensedDropdown){var a={init:function(){e(".viewLabel").hide(),e("#fillSelector").show();var n=a.getData();a.createDropdown(n),a.selectDropdownOption()},getData:function(){var n=0,t=[];return e(".views").children("div").each(function(){var n={id:null,text:null};n.id=e(this).attr("id"),"sitesView"===n.id&&(n.text="Log in as",t.push(n)),"formFillView"===n.id&&(n.text="Fill form with",t.push(n))}),t},createDropdown:function(n){for(e("#fillSelector").html(""),e("<div/>",{id:"dropdownButton",class:"dropdownButton"}).appendTo("#fillSelector"),e("<span/>",{id:"dropdownButtonText",class:"dropdownButtonText",text:""}).appendTo("#dropdownButton"),e("<i/>",{id:"dropdownButtonIcon",class:"fa fa-caret-down dropdownButtonIcon",ariaHidden:!0}).appendTo("#dropdownButton"),e("<ul/>",{id:"dropdown",class:"dropdown"}).appendTo("#fillSelector"),i=0;i<n.length;i++)e("<li/>",{id:"option"+i,class:"option"+i,"data-viewed":n[i].id}).appendTo("#dropdown"),e("<i/>",{class:"fa fa-check","aria-hidden":!0}).appendTo("#option"+i),e("<span />",{text:n[i].text}).appendTo("#option"+i);e("#dropdown").hover(function(){InfieldMenuTimer.clearTimer()},function(){InfieldMenuTimer.startTimer()})},selectDropdownOption:function(n){void 0===n?n={id:"option0",text:e("#option0 > span").text(),action:e("#option0").attr("data-viewed")}:InfieldCommands.sendLPImprove("infield_dropdown_toggled",{toggle:n.action,domain:t.url}),e("#dropdownButtonText").text(n.text),e("#views").children().hide(),e('div[id*="'+n.action+'"]').show(),e("#dropdown > li > i").hide(),e("#dropdown > #"+n.id+" > i").show(),e("#dropdown").hide()}};a.init(),e("#dropdownButton").click(function(){e("#dropdown").show(),T(e("#dropdown").height())}),e("#dropdown > li").click(function(){var n={id:e(this).attr("id"),text:e(this).text(),action:e(this).attr("data-viewed")};a.selectDropdownOption(n)})}else t.noHeaders&&!0===t.noHeaders&&(e(".lblSites").hide(),e(".lblForms").hide());e("#searchBtn").click(function(){_(t),T()}).keypress(function(){_(t),T()}),e("#generatePassInfieldIconInfield").click(function(){S()}).keypress(function(){S()}),csTop.LPInfieldFrame.positionFrame(function(e){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_OPENED,e)}),csTop.LPInfieldFrame.show(),e(".infield-dialog").show()}else n.closePopup("close")}return{init:v,setArrowPosition:b}}(jQuery,InfieldCommands,InfieldMenu,InfieldView,InfieldTiles,InfieldSearch,InfieldGeneratePassword,lpArrow,Strings);lpInfield&&lpInfield.init();
//# sourceMappingURL=sourcemaps/betterLpInfield.js.map
