function postacctsload(){var e,t={};for(e=0;e<g_sites.length;e++)g_sites[e].url=AES.hex2url(g_sites[e].url),void 0!==g_sites[e].username&&(g_sites[e].unencryptedUsername=lpmdec_acct(g_sites[e].username,!0,g_sites[e],g_shares)),g_SUPPORTSINGLE||(g_sites[e].pwch=!1),t[g_sites[e].aid]=g_sites[e];g_sites=t;var a={};for(e=0;e<g_securenotes.length;e++)g_securenotes[e].url=AES.hex2url(g_securenotes[e].url),a[g_securenotes[e].aid]=g_securenotes[e];g_securenotes=a;var r={};for(e=0;e<g_applications.length;e++)g_applications[e].appname=AES.hex2url(g_applications[e].appname),r[g_applications[e].appaid]=g_applications[e];for(g_applications=r,e=0;e<g_identities.length;e++)g_identities[e].deciname=lpdec(g_identities[e].iname);if("function"==typeof get_data_handler&&get_data_handler(),"undefined"!=typeof foundmsfi){postdata="";var n=0;for(e in msfids)if(msfids.hasOwnProperty(e)){for(var i=msfids[e].shareid,s="",o=null,l=0;l<g_shares.length;l++)if(g_shares[l].id==i){s=AES.bin2hex(g_shares[l].key),o=g_shares[l].decsharename;break}var d=new RSAKey;if(parse_public_key(d,msfids[e].key)&&o){var p=d.encrypt(s),c=lpenc(o,g_shares[l].key);postdata+="&sharekey"+n+"="+encodeURIComponent(p)+"&uid"+n+"="+encodeURIComponent(msfids[e].uid),postdata+="&shareid"+n+"="+encodeURIComponent(msfids[e].shareid),postdata+="&decsharename"+n+"="+encodeURIComponent(o),postdata+="&encsharename"+n+"="+encodeURIComponent(c),n++}}postdata+="&token="+g_token,n=0,$.ajax({type:"POST",url:base_url+"process_msf.php",data:postdata,failure:function(e){console.log(e)}})}}function sendError(e){$.ajax({type:"POST",url:base_url+"error.php",data:{msg:e},dataType:"text",success:function(){},failure:function(){}})}function get_accts(){$.ajax({type:"POST",url:base_url+"getaccts.php",data:"mobile=1&b64=1&shap=1&includependingsharedfolders=1&includesharedfolderformfillprofiles=1&includeemergencyaccess=1&requestsrc=newvault&hasplugin="+encodeURIComponent(lpversion)+"&u="+encodeURIComponent(g_username_hash),dataType:"text",success:function(e){try{e=atob(e)}catch(e){sendError("BLOB ERROR: cannot be base64 decoded for user "+g_uid)}e.endsWith("ENDM\0\0\0OK")||sendError("BLOB ERROR: not complete for user "+g_uid),g_sites=[],g_securenotes=[],g_prompts=[],g_formfills=[],g_identities=[],g_pendings=[],g_maxid=[],g_groups=[],g_prefoverrides=[],g_shares=[],g_applications=[],lp_attaches=[],g_attachversion=[],g_emer_sharers=[],g_emer_sharees=[],g_note_templates=[],g_pending_shares=[],parsemobile(e,e.length,100,0,postacctsload,g_sites,g_securenotes,g_prompts,g_formfills,g_identities,null,null,!0,!1,null,g_pendings,null,g_maxid,null,g_groups,g_prefoverrides,lp_rsaprivatekeyhex,g_shares,null,null,null,g_applications,lp_attaches,g_attachversion,null,null,null,g_emer_sharers,g_emer_sharees,null,g_note_templates,g_pending_shares,null,null,null)}})}function process_icons(e,t){if(e&&(e=e.split(":")).length)for(var a=e[0],r=0,n=e.length;r+1<n;r+=2){var i=parseInt(e[r+1]);if(0===a.indexOf("lp")&&i>0){a=a.substring(2);var s=e[r+2].substring(0,i);t?g_bigicons[AES.hex2bin(a)]=s:g_icons[a]=s,a=e[r+2].substring(i)}}}function get_icons(e){$.ajax({type:"POST",url:base_url+"geticon.php",data:"big=1&versionchrome=1&username="+encodeURIComponent(g_username)+"&domain=all",dataType:"text",success:function(t){"latest"!=t&&"nodata"!=t&&process_icons(t,!0),e&&e()}})}function moveIntoSharedFolder(e,t,a,r,n,i,s,o){for(var l=e&&t&&e.id===t.id,d=void 0!==e&&e?e.sharekey:g_local_key,p=void 0!==t&&t?t.sharekey:g_local_key,c=void 0!==e&&e?e.id:g_uid,_=void 0!==t&&t?t.id:"",g="cmd=uploadaccounts&username="+en(g_username),u="",f=new Array,h={},m=0;m<a.length;++m){var v,y;"object"==typeof a[m]?(y=!1,v=a[m]):(v=getacct(a[m]),y=!0);var b=v.aid,w=!1;if(null==v)return o.errorCallback(gs("Error: This folder has already been moved?")),!1;var k={};for(var x in v)v.hasOwnProperty(x)&&(k[x]=v[x]);var S=e?r[b].substr(e.decsharename.length+1):r[b],C;k.group=e?e.decsharename:"",""!=k.group&&""!=S&&(k.group+="\\"),k.group+=S,y&&(k.extra=lpmenc(lpmdec(v.extra,!0,p),!0,d)),is_application(v)?C="&appname"+m+"="+en(v.appname)+"&name"+m+"="+en(lpenc(v.name,d))+"&type"+m+"="+en("cr")+"&group"+m+"="+en(lpenc(S,d))+"&extra"+m+"="+en(crypto_btoa(k.extra))+"&script"+m+"="+en(v.script)+"&pwprotect"+m+"="+en(v.pwprotect?1:0)+"&wininfo"+m+"="+en(v.wininfo)+"&wintitle"+m+"="+en(v.wintitle)+"&exeversion"+m+"="+en(v.exeversion)+"&exehash"+m+"="+en(v.exehash)+"&fiid"+m+"="+en(v.fiid):(y&&(k.username=lpmenc(lpmdec(v.username,!0,p),!0,d)),y&&(k.password=lpmenc(lpmdec(v.password,!0,p),!0,d)),y&&(k.realm_data=lpmenc(lpmdec(v.realm_data,!0,p),!0,d)),C="&url"+m+"="+en(AES.url2hex(v.url))+"&username"+m+"="+en(crypto_btoa(k.username))+"&password"+m+"="+en(crypto_btoa(k.password))+"&name"+m+"="+en(lpenc(v.name,d))+"&type"+m+"="+en("cr")+"&grouping"+m+"="+en(lpenc(S,d))+"&extra"+m+"="+en(crypto_btoa(k.extra))+"&pwprotect"+m+"="+en(v.pwprotect?1:0)+"&realm"+m+"="+en(crypto_btoa(k.realm_data)),v.save_all&&(C+="&save_all"+m+"=1"),void 0!==v.basic_auth&&"1"==v.basic_auth&&(C+="&basic_auth"+m+"=1"),void 0!==v.notetype&&v.notetype&&v.notetype.length&&(C+="&notetype"+m+"="+en(v.notetype)),void 0!==v.template&&v.template&&v.template.length&&(C+="&template"+m+"="+en(v.template))),c!=g_uid?k.sharefolderid=c:void 0!==k.sharefolderid&&delete k.sharefolderid,void 0!==v.attachkey&&""!=v.attachkey&&(y&&(k.attachkey=lpenc(lpdec(v.attachkey,p),d)),C+="&attachkey"+m+"="+en(k.attachkey)),C+="&origaid"+m+"="+en(b);var P="";k.fields=new Array;for(var x=0;x<v.fields.length;x++){for(var I in k.fields[x]={},v.fields[x])v.fields[x].hasOwnProperty(I)&&(k.fields[x][I]=v.fields[x][I]);var R=v.fields[x].value,A=v.fields[x].type;is_application(v)||"text"==A||"email"==A||"tel"==A||"password"==A||"textarea"==A||"hidden"==A?(y&&(k.fields[x].value=lpmenc(lpmdec(R,!0,p),!0,d)),R=crypto_btoa(k.fields[x].value)):"checkbox"!=A&&"radio"!=A||(R+=v.fields[x].checked?"-1":"-0"),is_application(v)?P+="&fields"+m+"id"+x+"="+en(v.fields[x].id)+"&fields"+m+"type"+x+"="+en(v.fields[x].type)+"&fields"+m+"value"+x+"="+en(R):P+="&fields"+m+"name"+x+"="+en(v.fields[x].name)+"&fields"+m+"type"+x+"="+en(v.fields[x].type)+"&fields"+m+"value"+x+"="+en(R)+"&fields"+m+"formname"+x+"="+en(void 0===v.fields[x].formname?"":v.fields[x].formname)}h[b]=k,g+=C,g+=P,u+=en(b)+",",f[f.length]=b}return g+="&sharedfolderid="+en(c),g+="&todelete="+u,null!=typeof e&&t&&(g+="&origsharedfolderid="+en(t.id)),4==(4&g_loglogins)&&(g+="&reportname="+en(v.name)),8==(8&g_loglogins)&&(g+="&reportusername="+en(v.unencryptedUsername)),$.ajax({type:"POST",url:base_url+"lastpass/api.php",data:g,dataType:"xml",success:function(e){var t;if((t=e.documentElement.getElementsByTagName("result")).length>0){for(var r=!0,n=0;n<a.length;++n){var i="object"==typeof a[n]?a[n]:getacct(a[n]),s=i.aid,l=h[s];if(l.attacharraychanges={add:[],remove:[]},i&&l)if(is_application(i)){if(lp_in_array(s,f)&&delete g_applications[get_appaid(s)],l.appaid=t[0].getAttribute("aidmap"+s),!l.appaid){r=!1;break}l.appaid=get_appaid(l.appaid),g_applications[l.appaid]=l}else{var d=lp_gettld_url(i.url);if(lp_in_array(s,f)&&("http://sn"==i.url?delete g_securenotes[s]:delete g_sites[s]),l.aid=t[0].getAttribute("aidmap"+s),!l.aid){r=!1;break}for(var p in"http://sn"==l.url?g_securenotes[l.aid]=l:g_sites[l.aid]=l,lp_attaches)if(lp_attaches.hasOwnProperty(p)&&lp_attaches[p].parent==s){var c=lp_attaches[p],_=new Array;for(var g in c)c.hasOwnProperty(g)&&(_[g]=c[g]);var u=c.id;if(_.id=t[0].getAttribute("attachidmap"+u),_.storagekey=t[0].getAttribute("storagekeymap"+u),!_.id||!_.storagekey){r=!1;break}l.attacharraychanges.add.push(_),l.attacharraychanges.remove.push(c.id),_.parent=l.aid,lp_in_array(s,f)?lp_attaches[p]=_:lp_attaches[lp_attaches.length]=_}if(!r)break}}r&&o&&o.successCallback&&o.successCallback(h)}else{var t;if("SERVER_uploadfailed"==(t=e.documentElement.getAttribute("rc"))){var m=gs("Your Shared Folder action failed. Please check your permissions before trying again");o&&o.errorCallback&&o.errorCallback(m)}else if("SERVER_sharedfolder_passwordsmustbehidden"==t){var m=gs("Your do not have permission to view this account password so you cannot move it from the current Shared Folder.");o&&o.errorCallback&&o.errorCallback(m)}else{var m=gs("Your Shared Folder action failed.");o&&o.errorCallback&&o.errorCallback(m)}}get_accts()},error:function(){o&&o.errorCallback&&o.errorCallback(gs("An error occurred"))}}),!0}function refreshGroupNames(){}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),lploggedin=!0,g_local_accts_version=-1,g_server_accts_version=-1,g_identities=[],g_formfills=[],g_pendings=[],base_url="",g_sites={},g_securenotes={},g_enterpriseuser=0,g_enterprisemodel=0,g_enterpriseuserrole=null,g_iscompanyadmin=0,g_premium_exp=0,g_premium_trial=0,g_applications={},g_shares=[],g_username=null,lp_username=null,g_username_hash=null,g_prompts={},g_maxid=[],g_groups={},g_prefoverrides={},lp_attaches=[],g_attachversion=[],g_emer_sharers=[],g_emer_sharees=[],g_note_templates=[],lpversion="4.0",g_uid=null,g_icons=[],g_bigicons=[],g_identity="undefined"!=typeof iid&&iid?iid:Preferences.get("identity"),g_nofolder_feature_enabled=!1,g_basicauth_feature_enabled=!1,get_personal_linked=function(){for(var e=0;e<g_shares.length;e++)if(void 0!==g_shares[e].associative&&1==g_shares[e].associative)return g_shares[e].id;return""},get_securityChallengeScore=function(e){e(null)},getbigicon=function(e){var t=lp_gettld_url(e);return void 0!==g_bigicons[t]?"data:image/png;base64,"+g_bigicons[t]:null},get_method_async=function(e){e()},geticonurlfromrecord=function(e,t){return is_application(e)?"lps lpapp"+e.fiid:"lps lp"+e.aid},unlock_plug2web=function(){g_plug2web_last_initiated=parseInt((new Date).getTime()/1e3)},get_last_reprompt_time=function(){return"undefined"==typeof last_reprompt_time&&(last_reprompt_time=Preferences.get("lastreprompttime")),last_reprompt_time},set_last_reprompt_time=function(){last_reprompt_time=(new Date).getTime(),Preferences.set("lastreprompttime",last_reprompt_time)},get_key_iterations=function(){return 5e3},function(){var e={};lpevent=function(t){e[t="w"+t]=e.hasOwnProperty(t)?e[t]+1:1},setInterval(function(){if(g_prompts.improve){var t=!1;for(var a in e){t=!0;break}t&&LPServer.xmlRequest({url:"poll_server.php",data:e}),e={}}},1e4)}(),processCS=function(e,t,a){if("ipcgetdata"==t.cmd&&"undefined"!=typeof g_plug2web_last_initiated&&g_plug2web_last_initiated>=parseInt((new Date).getTime()/1e3)-20){var r=lpParseUri(t.url),n=r.directory.replace(new RegExp("^/~[^/]*"),""),i=r.file.replace(new RegExp("#"),"");if("/"==n&&"acctsiframe.php"==i){var s={cmd:"ipcgotdata",username:g_username,key:btoa(g_local_key),version:lpversion,identity:g_identity,iterations:get_key_iterations(g_username)};t.callback(s)}}},openimport=function(){window.open(base_url+"import.php")},openexport=function(){window.open(base_url+"export.php")},openseccheck=function(){window.open(base_url+"?securitychallenge=1&lpnorefresh=1")},openentconsole=function(){window.open(base_url+"company/#/dashboard")},openOnNewTab=function(e){window.open(base_url+e)},openFamilyConsole=function(){window.open(base_url+"family/")},openPremiumPaymentPage=function(){window.open(base_url+"premium/payment")},openEnterprisePaymentPage=function(){window.open(base_url+"enterprisepayment.php")},openTeamsPaymentPage=function(){window.open(base_url+"teamspayment.php")},openFamiliesPaymentPage=function(){window.open(base_url+"families/payment")},openPricingPage=function(){window.open(base_url+"pricing")},loggedOut=function(){send_website_event("logoff"),setTimeout(function(){top.location.href=base_url+"logout.php?token="+g_token},500)},get_saved_logins=function(){},have_binary=function(){return canopensaveattach},install_binary=function(){window.open(base_url+"installer/")},addAttach=function(e){addattach_callback=e,attachkey=SHA256(get_random_password()),send_website_event("getattach",attachkey)},openAttach=function(e,t,a){for(var r=0;r<lp_attaches.length;r++)if(lp_attaches[r].id==t){if(void 0===lp_attaches[r].data||""===lp_attaches[r].data){var n={getattach:lp_attaches[r].storagekey};return void 0!==g_securenotes[e].sharefolderid&&(n.sharedfolderid=g_securenotes[e].sharefolderid),void $.ajax({global:!1,type:"POST",cache:!1,dataType:"json",url:"show_website.php",data:n,success:function(n){""!=n&&(lp_attaches[r].data=n,openAttach(e,t,a))},failure:function(e){alert("error")}})}send_website_event("openattach",lpdec_acct(g_securenotes[e].attachkey,g_securenotes[e],g_shares),lp_attaches[r].data,lp_attaches[r].mimetype)}},exportAttachment=function(e,t,a){for(var r=0;r<lp_attaches.length;r++)if(lp_attaches[r].id==t){if(void 0===lp_attaches[r].data||""===lp_attaches[r].data){var n={getattach:lp_attaches[r].storagekey};return void 0!==g_securenotes[e].sharefolderid&&(n.sharedfolderid=g_securenotes[e].sharefolderid),void $.ajax({global:!1,type:"POST",cache:!1,dataType:"json",url:"show_website.php",data:n,success:function(n){""!=n&&(lp_attaches[r].data=n,exportAttachment(e,t,a))},failure:function(e){alert("error")}})}send_website_event("saveattach",lpdec_acct(g_securenotes[e].attachkey,g_securenotes[e],g_shares),lp_attaches[r].data,lp_attaches[r].mimetype)}},can_copy_to_clipboard=function(){return!1},fastEncryptAttachments=function(e,t,a){var r=[];for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&r.push({id:t[n].id,data:enccbc(t[n].bytes,e)});a(r)},gotourl=function(e){if(g_sites[e].url){var t=g_sites[e].url;t.match(/^[a-z]+?\:\/\//i)||(t="http://"+t),window.open(t)}},increment_local_accts_version=function(){g_local_accts_version++},refreshsites=function(){get_accts()},request_native_messaging=function(){send_website_event("request_native_messaging")},rewritelocalfile=function(){},editAid=function(e,t,a,r){r&&send_website_event("auto_pwchg",e,"0")},switch_identity=function(e){send_website_event("switchidentity",e),g_identity=""+e,Preferences.set("identity",g_identity),document.cookie="iid="+encodeURIComponent(g_identity)},launch=function(e){g_hasplugin?(document[g_manualformname].aid.value=e,document[g_manualformname].submitbtn.click()):pa(function(){window.open(base_url+"launch.php?id="+encodeURIComponent(e)+"&shareid="+encodeURIComponent(void 0!==g_sites[e].sharefolderid?g_sites[e].sharefolderid:0)+"&method=web&token="+g_token)},g_prompts.login_site_prompt||g_sites[e].pwprotect)},launchApp=function(e){launch("app"+e)},check_ident_aid=function(e){if(""===g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.aidarr&&(a.aidarr=a.aids.split(",")),lp_in_array(e,a.aidarr)},check_ident_appaid=function(e){if(""===g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.appaidarr&&(a.appaidarr=a.appaids.split(",")),lp_in_array(e,a.appaidarr)},openall=function(e,t){var a=[],r=!1;for(var n in g_sites)if(check_ident_aid(n)){var i=g_sites[n];i.group==e&&"http://group"!=i.url&&(a.push(i),r=r||i.pwprotect)}if(0!==a.length)if(t||!r&&!g_prompts.login_site_prompt)for(var s=0;s<a.length;s++)window.open(a[s].url);else pa(function(){openall(e,!0)},!0)},openAllSites=function(e){for(var t=0;t<e.length;t++)window.open(e[t].url)},openfavorites=function(e,t){var a=[],r=!1;for(var n in g_sites){var i=g_sites[n];check_ident_aid(n)&&"1"==i.fav&&(a.push(i),r=r||i.pwprotect)}if(0!==a.length)if(e||!r&&!g_prompts.login_site_prompt){for(var s=0;s<a.length;s++)window.open(a[s].url);var o={};void 0!==t&&(o={source:t}),sendLpImprove("openfavorites",o)}else pa(function(){openfavorites(!0)},!0);else alert(StringUtils.translate("You do not have any Favorites yet."))},createNewAcct=function(){return{aid:"",name:"",group:"",url:"",tld:"",extra:"",fav:"0",sharedfromuid:"",username:"",unencryptedUsername:"",password:"",pwprotect:0,genpw:0,sn:0,last_touch:lp_get_gmt_timestamp(),autologin:0,never_autofill:0,realm_data:"",fiid:"",custom_js:"",submit_id:"",captcha_id:"",urid:"0",basic_auth:"0",method:"",action:"",individualshare:!1,fields:[]}},addEmptyGroup=function(e,t,a){var r=issharedfolder(g_shares,e);if(checkreadonly(r)){var n=!1===r?g_local_key:r.sharekey,i=e;if(r){if(!checkreadonly(r))return;i=e.substr(r.decsharename.length+1)}var s=createNewAcct();s.url="http://group",s.group=e,s.aid="0";var o="ajax=1&extjs=1&name=&url="+encodeURIComponent(AES.url2hex(s.url))+"&grouping="+encodeURIComponent(lpenc(i,n))+"&username=&password=&extra=&aid=0&openid_url=&isbookmark=0";o+=!1===r?"":"&sharedfolderid="+en(r.id),o+=get_identity_param(),o+="&token="+g_token,$.ajax({type:"POST",url:base_url+"show_website.php",data:o,dataType:"text",success:function(e){var a=$(jQuery.parseXML(e)).find("result");a.length&&(s.aid=a.attr("aid"),add_ident_aid(s.aid),t(s),g_sites[s.aid]=s)},failure:a})}},checkmultiplefolders=function(e){for(var t=!1,a=null,r=!0,n=0;n<e.length;n++){var i=e[n],s=get_record(i);if(s){var o=issharedfolder(g_shares,s.group);if(o){if(t){r=!1;break}if(null===a)a=o.decsharename;else if(a!=o.decsharename){r=!1;break}}else{if(null!==a){r=!1;break}t=!0}}}return r||alert(StringUtils.translate("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once.")),r},get_record=function(e){return void 0===e?null:is_application(e)?g_applications[e.substring(3)]:"undefined"!=typeof g_sites&&void 0!==g_sites[e]?g_sites[e]:"undefined"!=typeof g_securenotes&&void 0!==g_securenotes[e]?g_securenotes[e]:null},deleteAid=function(e,t,a,r,n){var i=e.split(",");if(!checkmultiplefolders(i))return!1;for(var s="",o=0,l={},d=0;d<i.length;d++){var p=i[d];if(is_application(id)){if(!check_ident_appaid(p))continue}else if(!check_ident_aid(p))continue;var c=get_record(p);if(c){if(s+=(""===s?"":",")+p,void 0!==c.sharefolderid){o=c.sharefolderid;var _=issharedfolder(g_shares,c.group);if(!checkreadonly(_))return!1}is_application(c)&&void 0!==g_applications[c.appaid]?delete g_applications[c.appaid]:void 0!==g_sites[p]?delete g_sites[p]:void 0!==g_securenotes[p]&&delete g_securenotes[p],Policies.logNameEnabled()&&"http://sn"==c.url&&(l[p]=c.name)}}if(""===s)return!1;var g="ajax=1&extjs=1&delete=1&aid="+en(s);return Policies.logNameEnabled()&&"http://sn"==c.url&&(g+="&deletedobjects="+AES.url2hex(JSON.stringify(l))),g+=get_identity_param(),0!==o&&(g+="&sharedfolderid="+en(o)),g+="&token="+g_token,$.ajax({type:"POST",url:base_url+"show_website.php",data:g,dataType:"text"}),n&&n(),!0},get_identity_param=function(){return"&iid="+encodeURIComponent(g_identity)},deleteGroup=function(e,t,a){var r=[],n;for(n in g_sites)g_sites[i].group===e&&r.push(n);for(n in g_securenotes)g_securenotes[i].group===e&&r.push(n);for(n in g_applications)g_applications[i].group===e&&r.push(n);return deleteAid(r.join(","),t,!1,!0,a)},deleteformfill=function(e,t,a,r,n,i,s){var o,l=!1;for(o=0;o<g_formfills.length;o++)if(g_formfills[o].ffid==e){l=issharedfolder(g_shares,void 0!==g_formfills[o].group?g_formfills[o].group:""),g_formfills.splice(o,1);break}var d="deleteext=1&ffid="+encodeURIComponent(e);return d+=!1===l?"":"&sharedfolderid="+encodeURIComponent(l.id),d+=get_identity_param(),d+="&method="+encodeURIComponent(getBG().get_method()),d+="&token="+g_token,d+="&src=website",s&&(d+="&source="+encodeURIComponent(s)),$.ajax({type:"POST",url:base_url+"formfill.php",data:d,dataType:"text",success:n,failure:i}),!0},moveSelectedToGroup=function(e,t,a,r,n){(a=a||{}).successCallback=r,a.errorCallback=n;var i=void 0!==a.skipConfirm&&a.skipConfirm,s=t.split(","),o=issharedfolder(g_shares,e),l=null;if(checkreadonly(o)){for(var d=!1,p=0;p<s.length;p++){var c=s[p],_=get_record(c);if(l=issharedfolder(g_shares,_.group),!checkreadonly(l))return;if(!checkmove(o,l))return;!o&&!l||o&&l&&o.id===l.id||(d=!0)}if(d){for(var g=[],p=0;p<s.length;p++)g[s[p]]=e;moveIntoSharedFolder(o,l,s,g,!1,!1,i,a)}else{var u=[],f=[];if(e===StringUtils.translate("favorites"))for(var p=0;p<s.length;p++){var h=get_record(s[p]);h&&"0"==h.fav&&(u[u.length]=s[p])}(s.length>0||u.length>0||f.length>0)&&changeGroupAndFavorites(s,u,f,e,o,a)}}},changeGroupAndFavorites=function(e,t,a,r,n,i){for(var s="",o="",l="",d="",p=[],c=0;c<e.length;c++){var _=e[c],g;(g=get_record(_))&&r!=StringUtils.translate("favorites")&&(p[p.length]=_,g.group=r,s+=d+_,d=",")}d="";for(var c=0;c<t.length;c++){var _=t[c],g;(g=get_record(_))&&(p[p.length]=_,g.fav="1",o+=d+_,d=",")}g_local_accts_version++,g_server_accts_version++,rewritelocalfile(),i&&i.successCallback&&i.successCallback();var u=!1===n?g_local_key:n.sharekey,f=r;n&&(f=r.substr(n.decsharename.length+1));var h="aids="+encodeURIComponent(s)+"&newfavaids="+encodeURIComponent(o)+"&oldfavaids="+encodeURIComponent("")+"&newgrp="+encodeURIComponent(lpenc(f,u))+"&xml=1";h+=0==n?"":"&sharedfolderid="+en(n.id),g_token&&(h+="&token="+g_token),$.ajax({type:"POST",url:base_url+"groups.php",data:h,dataType:"text"})},renameGroup=function(e,t){if(e!=StringUtils.translate("favorites")){var a=issharedfolder(g_shares,e);if(0==a||a.decsharename!=e){var r=issharedfolder(g_shares,t);if(checkmove(r,a)&&checkreadonly(r)&&checkreadonly(a)){var n=0==r?g_local_key:r.sharekey,i=t;if(r&&(i=t.substr(r.decsharename.length+1)),r||a){var s=[],o=[],l=[g_sites,g_securenotes,g_applications],d=r?t.substr(r.decsharename.length+1):"";for(var p in l){var c=l[p];for(var _ in c){var g;if(c.hasOwnProperty(_))if((g=c[_]).group==e||0==g.group.indexOf(e+"\\\\")){s[s.length]=get_record_id(g);var u=t;g.group!=e&&g.group.indexOf("\\\\")>0&&(u=t+g.group.substr(g.group.indexOf("\\\\"))),o[get_record_id(g)]=u}}}moveIntoSharedFolder(r,a,s,o,!1,!1,!1)}else{var l=[g_sites,g_securenotes,g_applications],f=[],h=[],m=[];for(var p in l){var c=l[p];for(var _ in c){var g;if(c.hasOwnProperty(_))if((g=c[_]).group==e){g.group=t,void 0===f[e]?(m[m.length]=e,h[e]=get_record_id(g)):h[e]+=","+get_record_id(g);var i=t;r&&(i=i.substr(r.decsharename.length+1)),f[e]=i}else if(0==g.group.indexOf(e+"\\\\")){var v=g.group;g.group=g.group.replace(e+"\\\\",t+"\\\\"),void 0===f[v]?(m[m.length]=v,h[v]=get_record_id(g)):h[v]+=","+get_record_id(g);var i=g.group;r&&(i=i.substr(r.decsharename.length+1)),f[v]=i}}}g_local_accts_version++,rewritelocalfile();for(var y="xml=1",b=0;b<m.length;b++)y+="&ids"+b+"="+encodeURIComponent(h[m[b]])+"&newgrp"+b+"="+encodeURIComponent(lpenc(f[m[b]],n));y+=0==r?"":"&sharedfolderid="+en(r.id),g_token&&(y+="&token="+g_token),$.ajax({type:"POST",url:base_url+"groups.php",data:y,dataType:"text"})}}}else alertfrombg("You cannot rename a top level Shared folder")}},get_record_id=function(e){return is_application(e)?"app"+e.appaid:e.aid},is_application=function(e){return"string"==typeof e?0===e.indexOf("app"):e&&void 0!==e.appaid},getBG=function(){return this},saveSite=function(e,t,a,r){e+="&method="+encodeURIComponent(getBG().get_method()),e+="&auto=1"+get_identity_param(),e+="&token="+g_token,t.postdata=e,t.posturl=base_url+(is_application(t)?"addapp.php":"show_website.php"),$.ajax({type:"POST",url:t.posturl,data:e,dataType:"text",success:function(e){var n=(e=$(jQuery.parseXML(e))).find("result");if(n.length){var i=0==t.aid;i&&(t.aid=n.attr("aid"),add_ident_aid(t.aid));var s=n.attr("attacherror");s&&""!=s&&alert(s);for(var o=0,l=Array();null!=n.attr("att_"+o);)l[n.attr("att_"+o)]=Array(),l[n.attr("att_"+o)].storagekey=n.attr("attstorekey_"+o),l[n.attr("att_"+o)].size=n.attr("attsize_"+o),o++;var d=n.attr("aid");if(!s&&t.attacharraychanges&&t.attacharraychanges.add){for(var p in t.attacharraychanges.add)if(t.attacharraychanges.add.hasOwnProperty(p)){var c=t.attacharraychanges.add[p];i&&(c.id=d+"-"+c.id),l[c.id]&&(c.storagekey=l[c.id].storagekey,c.size=l[c.id].size)}applyattacharraychanges(t.attacharraychanges)}t.sn?g_securenotes[t.aid]=t:g_sites[t.aid]=t,a(t)}else{var _=e.find("error");_.length&&r(_.attr("response"))}},failure:r})},saveFields=function(e,t,a,r,n){t+="&method="+encodeURIComponent(getBG().get_method()),t+="&token="+g_token,$.ajax({type:"POST",url:base_url+"fields.php?"+e,data:t,dataType:"text",success:r,failure:n})},changePassword=function(e,t,a,r,n){for(var i=[],s=0,o=0;o<t.length;o++)if(g_sites[t[o]]){var l=lpmdec_acct(g_sites[t[o]].password,!0,g_sites[t[o]],g_shares);if(l!=e&&(i[i.length]=t[o],g_sites[t[o]].password=lpmenc_acct(e,!0,g_sites[t[o]],g_shares),g_sites[t[o]].fields))for(var d=0;d<g_sites[t[o]].fields.length;d++)"password"==g_sites[t[o]].fields[d].type&&lpmdec_acct(g_sites[t[o]].fields[d].value,!0,g_sites[t[o]],g_shares)==l&&(g_sites[t[o]].fields[d].value=g_sites[t[o]].password);void 0!==g_sites[t[o]].sharefolderid&&(s=g_sites[t[o]].sharefolderid)}if(0!==(t=i).length){for(var p="xml=1",c=[],o=0;o<t.length;o++){var _=o>0?o:"";p+="&username"+_+"=dummy",p+="&password"+_+"="+encodeURIComponent(lpenc_acct(e,g_sites[t[o]],g_shares)),p+="&id"+_+"="+encodeURIComponent(t[o]);try{lp_in_array(g_sites[t[o]].tld,c)||(c[c.length]=g_sites[t[o]].tld)}catch(e){}}try{for(var o in g_sites)if(g_sites[o].genpw&&lp_in_array(g_sites[o].tld,c)&&lpmdec_acct(g_sites[o].password,!0,g_sites[o],g_shares)==e){p+="&delgenpwaid="+encodeURIComponent(o);break}}catch(e){}0!=s&&(p+="&sharedfolderid="+en(s)),void 0!==a&&a&&(p+="&autochange=1");var g={aid:0};g.postdata=p,g.url=base_url+"change_pw.php",g.handler=r,g.param={aid:g.aid,postdata:g.postdata,url:g.url,handler:g.handler},g.successCallback=r,$.ajax({type:"POST",url:g.url,data:g.postdata,dataType:"text",success:function(e){var t=$(jQuery.parseXML(e)).find("ok");if(t.length)for(var a="";t.attr("id"+a);){var n=g_sites[t.attr("id"+a)],i=crypto_atob(t.attr("newpassword"+a)),s=crypto_atob(t.attr("oldpassword"+a));if(n.password=i,n.fields)for(var o=0;o<n.fields.length;++o){var l=n.fields[o];"password"!=l.type||l.value!=s&&lpmdec_acct(l.value,!0,n,g_shares)!=lpmdec_acct(s,!0,n,g_shares)||(l.value=i)}a=""===a?1:++a}r()},failure:n})}},addeditformfill=function(e,t,a,r){var n="",i;for(i in n+="&method="+encodeURIComponent(getBG().get_method()),e)n+=(""==n?"":"&")+i+"="+en(e[i]);var s=!1;return void 0!==t.group&&""!=t.group&&(s=issharedfolder(g_shares,t.group)),n+=0==s?"":"&sharedfolderid="+en(s.id),n+=get_identity_param(),n+="&token="+g_token,n+="&src=website",$.ajax({type:"POST",url:base_url+"formfill.php",data:n,dataType:"text",success:function(e){var r=$(jQuery.parseXML(e)).find("result");if(r.length){var n=r.attr("msg"),i=r.attr("ffid");add_ident_ffid(i);var s=r.attr("cfids"),o=r.attr("accts_version"),l,d=[],p=""==s?[]:s.split(","),c=0;for(l=1;void 0!==t["customfield"+l+"cfid"];++l){var _={};_.cfid=0!=t["customfield"+l+"cfid"]?t["customfield"+l+"cfid"]:c<p.length?p[c++]:0,_.text=t["customfield"+l+"text"],_.value=t["customfield"+l+"value"],_.alttext=t["customfield"+l+"alttext"],""==_.text&&""==_.value&&""==_.alttext||d.push(_)}var g=t.cmd;for(delete t.cmd,delete t.deleteext,l=1;void 0!==t["customfield"+l+"cfid"];++l)delete t["customfield"+l+"cfid"],delete t["customfield"+l+"text"],delete t["customfield"+l+"value"],delete t["customfield"+l+"alttext"];if(t.custom_fields=d,"add"==g)t.ffid=i,g_formfills.push(t);else for(l=0;l<g_formfills.length;++l)if(i==g_formfills[l].ffid){g_formfills[l]=t;break}a&&a(t)}},failure:r}),!0},add_ident_aid=function(e){if(g_identity){for(var t=null,a=0;a<g_identities.length;a++)if(g_identities[a].iid===g_identity){t=g_identities[a];break}t&&(t.aids&&(t.aids+=","),t.aids+=e,t.aidarr=t.aids.split(","))}},add_ident_ffid=function(e){if(g_identity){for(var t=null,a=0;a<g_identities.length;a++)if(g_identities[a].iid==g_identity){t=g_identities[a];break}t&&(t.ffids&&(t.ffids+=","),t.ffids+=e,t.ffidarr=t.ffids.split(","))}},db_prepend=function(e){return e},localStorage_setItem=function(e,t){try{return localStorage.setItem(e,t),!0}catch(e){return!1}},localStorage_getItem=function(e){try{return localStorage.getItem(e)}catch(e){return null}},openURL=function(e){window.open(e)},canLaunchApplication=function(){return!1},singlefactor_reprompt=function(e,t,a){FederatedLogin.isFederated(g_username,function(r){r?FederatedLogin.getPassword(g_username,function(e){g_local_key===make_lp_key_iterations(g_username,e,get_key_iterations(g_username))?t():a()},a):e()},a)},isOffline=function(){return!1},get_method=function(){return"web"},lpReportError=(errorCount=0,function(e){!0===g_prompts.improve&&(++errorCount,errorCount>100||$.ajax({url:base_url+"error.php",type:"POST",data:{msg:"error: website("+lpversion+") errors("+errorCount+"): "+e}}))}),loglogin=function(e){if(g_loglogins){var t=get_record(e);if(t){var a=issharedfolder(g_shares,t.group);if(a&&a.id===get_personal_linked())return;var r={id:e,method:get_method()};a&&(r.sharedfolderid=a.id),t&&(Policies.logUrlEnabled()&&"http://sn"!==t.url&&(r.u=AES.url2hex(t.url)),Policies.logNameEnabled()&&(r.n=AES.url2hex(t.name)),Policies.logUserNameEnabled()&&t.unencryptedUsername&&(r.un=AES.url2hex(t.unencryptedUsername))),$.ajax({url:base_url+"loglogin.php",type:"POST",data:r})}}},sendLpImprove=function(e,t){"object"==typeof LastpassApiHelper&&"function"==typeof LastpassApiHelper.sendLpImprove&&LastpassApiHelper.sendLpImprove(e,g_lpImprove,t)},sendLpImproveCallback=function(e,t,a){"object"==typeof LastpassApiHelper&&"function"==typeof LastpassApiHelper.sendLpImproveCallback&&LastpassApiHelper.sendLpImproveCallback(e,t,g_lpImprove,a)};
//# sourceMappingURL=sourcemaps/websiteBackground.js.map
