LPRequest={},function(e){var t={},r=function(){for(var e in t)clearTimeout(t[e]);t={}},s,o,n,i,a,c,l,u;Topics.get(Topics.REFRESH_DATA).subscribe(r),Topics.get(Topics.CLEAR_DATA).subscribe(r),e.getNewRequestID=(s=0,function(){return++s}),e.makeRequest=(o=function(e,t){return function(){for(var r=0,s=e.length;r<s;++r)e[r].unlock();t&&t.apply(window,arguments)}},n=function(e,t){return function(){for(var r=0,s=e.length;r<s;++r)e[r].lockForUpdate();t.apply(window,arguments)}},i=function(e,r){var s=function(s){try{Topics.get(Topics.REQUEST_SUCCESS).publish(e),r&&(clearTimeout(r),delete t[e.requestID]),s&&Topics.get(Topics.SUCCESS).publish(s)}catch(e){LPPlatform.logException(e)}};return e&&e.success?function(){var t=arguments,r=e.successMessage;t.length>0&&"string"==typeof t[0]&&(r=void 0===r?t[0]:r,t=Array.prototype.slice.call(t,1));try{e.success.apply(window,t)}catch(e){LPPlatform.logException(e)}s(r)}:s},a=function(e,r){var s=function(s,o){try{switch(r&&(clearTimeout(r),delete t[e.requestID]),"object"==typeof o&&(s=l(o)),Topics.get(Topics.REQUEST_ERROR).publish(e),s){case"throttled":return u(o);case"notoken":s=Strings.translateString("No token was provided. Request could not be completed.");break;case"session_expired":s=Strings.translateString("ErrorSessionMsg");break;case"not_allowed":s=Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again");break;case"invalidxml":s=Strings.translateString("Invalid XML response.");break;case"invalidjson":s=Strings.translateString("Invalid JSON response.");break;case"offline":s=Strings.translateString("This request cannot be completed because you are currently offline.");break;case"1_to_1_restricted_for_free":LPVault.closeShareDialog(),s=LPVault.openRestrictedSharingDialog();break;case"policy":s=Strings.translateString("Sorry, this operation is not allowed by a policy.");break;case"shouldverifyemail":dialogs.verifyEmail.open({email:bg.get("g_username")}),s=null;break;case void 0:s=Strings.Vault.UNEXPECTED_ERROR}Topics.get(Topics.ERROR).publish(s)}catch(e){LPPlatform.logException(e)}};return e&&e.error?e.shouldverifyemail?void dialogs.verifyEmail.open({email:bg.get("g_username")}):function(t){s(t),e.error()}:s},c=function(e){return function(t){Topics.get(Topics.REQUEST_STATUS).publish(t,e)}},l=function(e){if(!e||void 0===e.__raven_xhr)return console.log("Unable to read error response object."),e;var t=e.__raven_xhr;return t.status_code&&429==t.status_code?"throttled":Strings.Vault.UNEXPECTED_ERROR},u=function(e){if(e&&void 0!==e.__raven_xhr){var t=e.__raven_xhr.url,r=Strings.translateString("Too many requests were made in a short time. Please try again later."),s="Request to "+t+" was throttled.",o;(function(e){return e.indexOf("deliver_and_add.php")>-1||e.indexOf("show.php")>-1})(t)?Topics.get(Topics.ERROR).publish(r):console.log(s),LPPlatform.logException(s)}else console.log("Request to unknown url was throttled.")},function(r,s){if(s.confirm){var l=s.confirm;return delete s.confirm,l.handler=function(){e.makeRequest(r,s)},void Topics.get(Topics.CONFIRM).publish(l)}s.requestID=e.getNewRequestID();var u=null;if(LPTools.getOption(s,"showTimeWarning",!0)&&(u=setTimeout(function(){f(Strings.translateString("Sorry, this request is taking longer than normal."))},3e4),t[s.requestID]=u),s.items&&LPTools.getOption(s,"lockItems",!1)){var p=s.items;p instanceof Array||(p=[p]),r=n(p,r),s.success=o(p,s.success),s.error=o(p,s.error),s.confirm&&(s.confirm.closeHandler=o(p))}var g=i(s,u),f=a(s,u),d;s.params?d=[{params:s.params,requestArgs:s.requestArgs,success:g,error:f,status:s.status?c(s):null}]:((d=LPTools.getOption(s,"parameters",[]))instanceof Array||(d=[d]),d.push(g),d.push(f)),Topics.get(Topics.REQUEST_START).publish(s);try{r.apply(window,d)}catch(e){LPPlatform.logException(e),f(Strings.Vault.UNEXPECTED_ERROR)}}),e.makeDataRequest=function(t,r){e.makeRequest(t,$.extend(!0,r,{dialogRequest:!1}))},e.makeUpdateRequest=function(t,r){e.makeRequest(t,$.extend(!0,r,{requestSuccessOptions:{incrementAccountsVersion:!0}}))},e.makeLockItemUpdateRequest=function(e,t){this.makeUpdateRequest(e,$.extend(t,{lockItems:!0}))}}(LPRequest);
//# sourceMappingURL=sourcemaps/request.js.map
