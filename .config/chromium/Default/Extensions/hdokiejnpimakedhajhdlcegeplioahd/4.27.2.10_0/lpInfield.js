"use strict";function sendRequest(e){if(null!=e)if(e.cmd&&"popupfillinputget"!=e.cmd&&"popupfilliconnumber"!=e.cmd&&L("IF -> BG : cmd="+e.cmd),g_ischrome)try{chrome_runtime_sendMessage(e,function(){})}catch(e){}else g_issafari?safari.self.tab?safari.self.tab.dispatchMessage(e.cmd,e):safari.extension&&safari.extension.globalPage&&safari.extension.globalPage.contentWindow&&safari.extension.globalPage.contentWindow.message_handler({name:e.cmd,message:e,target:window}):g_isfirefoxsdk?(e.messagetype=e.cmd,send_message(e)):g_iscasper?"function"==typeof t_sendmsg&&t_sendmsg(e):bg.LPPlatform.postLegacyMessage({name:"message",message:e})}var g_reference_url="",InfieldIcons={globe:"images/Globe.png",profile:"images/Profile.png",other:"images/Other.png",mastercard:"images/Mastercard.png",visa:"images/Visa.png",amex:"images/Amex.png",discover:"images/Discover.png"},InfieldCommands=function(){function e(e){csTop.LPInfieldFrame.close(e)}function n(e){bg.InfieldCommands.editSite(e,!0)}function t(n){bg.InfieldCommands.fillUserData(n,!0),e("action")}function i(e){bg.InfieldCommands.copyUrl(e,!0)}function r(e){bg.InfieldCommands.copyUserName(e,!0)}function o(e){bg.InfieldCommands.copyPassword(e,!0,"formv2")}function a(e,n){bg.InfieldCommands.setGeneratePasswordPrefs({prefstr:e,genpwstr:n})}function s(n){bg.InfieldCommands.editFormFill(n,!0,"formv2"),e("action")}function c(n){bg.InfieldCommands.fillForm(n,!0,"formv2"),e("action")}function l(e,n){if(bg.is_firefox_webext()){var t=Clipboard.utilities.createTextArea(e);t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}else bg.copytoclipboard(e);g("copypass",{action:n,source:"formv2"})}function d(e){bg.InfieldCommands.getGeneratePasswordPrefs(e)}function p(n,t){bg.InfieldCommands.fillGeneratedPassword(n,t,!0),e("action")}function u(e,n,t){bg.InfieldCommands.searchVault(e,n,t)}function f(e){bg.InfieldCommands.getPopupFillData(e)}function g(e,n){bg.sendLpImprove(e,n)}return{closePopup:e,copyToClipboard:l,editSite:n,fillUsernamePass:t,copyUrl:i,copyUserName:r,copyPassword:o,editFormFill:s,fillForm:c,getGeneratePrefs:d,writeAllPrefs:a,fillGeneratedPassword:p,searchVault:u,getInitialData:f,sendLpImprove:g}}();!function(e){var n=function(n,t,i){var r=this;r._onResizeCallback=i,n&&(n instanceof jQuery?r._triggerElement=n:r._triggerElement=e("#"+n),t?(r._triggerElement.click(function(e){r.show(),r._setPosition(e)}),r._triggerElement.keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus(),r._setPosition(n)})):(r._triggerElement.children().click(function(e){r.show()}),r._triggerElement.children().keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus()})))};n.prototype._setPosition=function(n){var t=e(n.currentTarget).offset();t.top+=20,t.left+=20,this._menuElement.offset(t)},n.prototype.show=function(){e(".dropdown").hide(),e(".menuTriggered").removeClass("menuTriggered");var n=this,t;n._triggerElement.closest(".tile").addClass("menuTriggered"),n._triggerElement.addClass("menuTriggered"),this._menuElement&&this._menuElement.show(0,function(){n._onResizeCallback&&n._onResizeCallback(n._menuElement.height(),90)})},n.prototype.hide=function(e){var n=this,t;n._triggerElement.closest(".tile").removeClass("menuTriggered"),n._triggerElement.removeClass("menuTriggered"),n._triggerElement.blur(),this._menuElement&&(this._menuElement.hide(e),n._onResizeCallback())},n.prototype.resetTimer=function(e){var n=this;n._menuElement&&(n._menuTimer=setTimeout(function(){n.hide()},e||1e3))},n.prototype.createMenu=function(n,t,i){var r=this;return r._menuElement=e("<div></div>").attr("id",n+"Menu").addClass("dropdown").addClass(t).hide().hover(function(){var e=r._triggerElement.closest(".tile");clearTimeout(r._menuTimer)},function(){r.resetTimer(300)}).append(r._createMenuItems(i)),r._menuElement},n.prototype._createMenuItems=function(n){var t=this;t._menuItems=n;for(var i=e("<ul></ul>").addClass("menuList"),r=0;r<t._menuItems.length;r++){var o=e("<li></li>").attr("data-viewId",t._menuItems[r].id).attr("tabindex","1").click(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).focus(function(){clearTimeout(t._menuTimer)}).keypress(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).append(e("<p></p>").text(t._menuItems[r].text));i.append(o)}return i},n.prototype._findMenu=function(n){var t=e.grep(this._menuItems,function(e){return e.id===n});return t&&t.length>0?t[0]:null},n.prototype.select=function(e,n){var t=this._findMenu(e);t&&this._triggerElement&&this._triggerElement.find("p").text(t.selectedText),!0===n&&t&&t.action&&t.action()},window.InfieldMenu=n}(jQuery);var InfieldView=function(e){var n=[];function t(e){Array.isArray(e)&&e.length>0&&(n=e,r())}function i(t){-1!=n.indexOf(t)&&(r(),e("#"+t).show())}function r(){e.each(n,function(n,t){e("#"+t).hide()})}return{init:t,show:i}}(jQuery),InfieldGeneratePassword=function(e){function n(n,i,r){e("#moreOptions, #hideOptions").click(function(){a(),r&&r()}),e("#length").on("input",function(){InfieldSearch.debounce(o(),500)}),e(".pwgen").change(t),e("#generateBtn").click(t),e("#pronounceable").click(function(){e("#pronounceable").prop("checked")?(e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#ambig").prop("checked",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)):(e("#digits").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("checked",!0),e("#special").prop("disabled",!1))}),e("#ambig").click(function(){e("#ambig").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#password").on("copy",function(){bg.LPTabState.setCopiedGeneratedPassword(this.value)}).LP_addGeneratePasswordMeter(),bg.InfieldCommands.canCopy(function(t){t?e("#btnCopy").click(function(){var t=e("#password").val();n.copyToClipboard(t,"generatepassword"),e("#btnCopy").hide(),e("#copied").show(),setTimeout(function(){e("#copied").hide(),e("#btnCopy").show()},1e3),bg.LPTabState.setCopiedGeneratedPassword(t)}):e("#btnCopy").hide()});var s=function(){var t=e("#password").val();n.fillGeneratedPassword(t,{pronounceable:e("#pronounceable").prop("checked"),length:e("#password").val().length,expand:e("#moreOptions").is(":hidden"),uppercase:e("#upper").prop("checked"),lowercase:e("#lower").prop("checked"),numeric:e("#digits").prop("checked"),special:e("#special").prop("checked"),avoidAmbiguous:e("#ambig").prop("checked"),source:"formv2",variation:"old",generatedPasswordCount:e("#generatedPasswordCount").val()}),n.writeAllPrefs(JSON.stringify({generate_pronounceable:e("#pronounceable").prop("checked")?1:0,generate_length:e("#length").val(),generate_upper:e("#upper").prop("checked")?1:0,generate_lower:e("#lower").prop("checked")?1:0,generate_digits:e("#digits").prop("checked")?1:0,generate_special:e("#special").prop("checked")?1:0,generate_ambig:e("#ambig").prop("checked")?1:0,generate_mindigits:2,generate_reqevery:0})),bg.GenPassHistory.add(t)};e("#fillPasswordBtn").click(s),e("#generateAndFillBtn").click(s),e("#generateAndFillBtn").keypress(s),e("#advancedView").hide(),e("#generateBtnContainer").hide()}function t(){e("#generatedPasswordCount").val(function(){return parseInt(e("#generatedPasswordCount").val())+1});var n=lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"));e("#password").val(n).change(),bg.GenPassHistory.add(n)}function i(){var n=bg.get("g_prefoverrides").sitepwlen;n&&(n=JSON.parse(n),bg.get_selected_tab_data_no_extension(null,function(t){var i=bg.lp_gettld_url(t.url);if(n[i]){var r=n[i],a=Math.max(e("#length").val(),r);e("#length").attr({min:r}),e("#length").val(a),o()}}))}function r(n){i();var t=JSON.parse(n.prefstr);e("#length").val(parseInt(t.generate_length)),o(),e("#upper").prop("checked",!!parseInt(t.generate_upper)),e("#lower").prop("checked",!!parseInt(t.generate_lower)),e("#digits").prop("checked",!!parseInt(t.generate_digits)),e("#special").prop("checked",!!parseInt(t.generate_special)),e("#ambig").prop("checked",!!parseInt(t.generate_ambig)),e("#advancedView").hide(),e("#generateAndFillView").show(),parseInt(t.generate_pronounceable)?e("#pronounceable").click():e("#pronounceable").prop("pronounceable",!1),e("#password").val(lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"))).change()}function o(){e("#generatedPasswordLength").text(e("#length").val());var n=e("#length"),t=n.val(),i=n.attr("min"),r,o=(t-i)/(n.attr("max")-i)*100;e("#sliderFill").width(o+"%")}function a(){e("#advancedView").toggle(),e("#generateAndFillView").toggle(),e("#generateBtnContainer").toggle(),e("#moreOptions").toggle()}function s(){e("#moreOptions").show(),e("#generateBtnContainer").hide()}function c(){e("#moreOptions").hide(),e("#generateBtnContainer").hide()}return{init:n,setup:r,show:s,hide:c}}(jQuery),InfieldTiles=function(e,n,t,i){var r;function o(t,o,s,l,d,p){r=d;var u=[];if(e("#menuContainer").empty(),e("#"+t).empty().append(e('<p class="italic"></p>').text(p)),s){var f=e.map(s,function(e,n){return e});f.sort(function(e,n){return e}),e.each(f,function(e,t){var r=!1;e+1===f.length&&(r=!0);var s=c(o,{id:"sites"===o?t.aid:t.ffid,name:"sites"===o?t.name:t.decprofilename,description:"sites"===o?t.unencryptedUsername:1==t.profiletype?t.formattedCCNum:null,icons:a(l,o,t),moreText:"sites"===o?i.translateString("More"):i.translateString("Edit"),moreHandler:"sites"===o?null:function(){n.editFormFill(t.ffid)},clickHandler:"sites"===o?function(){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_FILLED),n.fillUsernamePass(t.aid)}:function(){n.fillForm(t.ffid)},lastTile:r});s&&u.push(s)}),u.length>0&&e("#"+t).empty().append(u)}return u.length}function a(n,t,i){var r="",o="",a;if("formfills"===t)if(0==i.profiletype)r=InfieldIcons.profile;else switch(i.ccType){case"VISA":r=InfieldIcons.visa;break;case"AMEX":r=InfieldIcons.amex;break;case"MC":r=InfieldIcons.mastercard;break;case"DISC":r=InfieldIcons.discover;break;default:r=InfieldIcons.other}else o="icon-site",r=n&&i.aid&&n[i.aid]?n[i.aid]:InfieldIcons.globe;return{normalEl:e("<img/>").attr("src",r).addClass("icon-default "+o)}}function s(n){return e("<div></div>").addClass("col-2 no-left-gutter no-right-gutter").append(e("<div></div>").addClass("icon").append(n))}function c(i,o){if(!o)return null;var a=null,c=e("<div></div>").addClass("col-8 text full-height"),l=e("<button></button>").attr("id",o.id+"btn").attr("tabindex","1").text(o.moreText);switch(i){case"formfills":c.append(e("<span></span>").text(o.name)),o.description&&c.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").addClass("small").text(o.description));break;case"sites":c.append(e("<span></span>").addClass("small").text(o.name)),o.description&&c.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").text(o.description)),a=new t(l,!0,r);var d=[{id:"editSite",text:"Edit",action:function(){n.editSite(o.id)}}];bg.InfieldCommands.canCopy(function(t){t&&(d.push({id:"copyPassword",text:"Copy password",action:function(){n.copyPassword(o.id)}}),d.push({id:"copyUsername",text:"Copy username",action:function(){n.copyUserName(o.id)}}),d.push({id:"copyURL",text:"Copy URL",action:function(){n.copyUrl(o.id)}})),e("#menuContainer").append(a.createMenu(o.id+"btn","tileDropdown",d))})}o.moreHandler&&l.click(o.moreHandler);var p=e("<div></div>").addClass("col-2 no-right-gutter no-left-gutter pull-right more").append(l),u=s([o.icons.normalEl]);u.click(o.clickHandler),c.click(o.clickHandler);var f=e("<div></div>").addClass("tile col-12").attr("id",o.id).attr("tabindex","1").append(e("<div></div>").addClass("row").append(u,c,p)).hover(function(){},function(){f.removeClass("triggered")});return o.lastTile&&f.addClass("lastTile"),l.focus(function(){f.addClass("triggered")}).blur(function(){f.removeClass("triggered")}).click(function(){f.addClass("menuTriggered"),f.removeClass("triggered")}),f}return{setup:o}}(jQuery,InfieldCommands,InfieldMenu,Strings),InfieldSearch=function(e){var n,t,i,r,o,a;function s(s){if(n=e("#searchContainer"),t=e("#currentTab"),i=e("#searchBtnContainer"),r=e("#inlineSearch"),o=e("#searchCloseBtn"),a=e("#searchBtn"),p(),e("#searchBtn").click(function(){l()}).keypress(function(){l()}),e("#searchCloseBtn").click(function(){d(),s("")}).keypress(function(){d(),s("")}),s){var u=c(function(n){s(e(n.currentTarget).val())},500);r.keyup(u)}}function c(e,n){var t;return function(){var i=this,r=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(i,r)},n)}}function l(){t.fadeOut(),n.show(),n.animate({width:"360px"},250,function(){o.show(),r.fadeIn().focus()}),a.addClass("searchBtnActive")}function d(){r.val(""),r.hide(),o.fadeOut(),n.show(),n.animate({width:"16px"},250,function(){i.fadeOut(),t.fadeIn()}),a.removeClass("searchBtnActive")}function p(){r.hide(),o.hide(),n.show().css({width:"16px"}),i.hide(),t.show(),a.removeClass("searchBtnActive")}function u(){n.show()}function f(){r.hide(),i.hide(),o.hide(),n.hide()}function g(e){e&&!0===e?u():f()}return{init:s,debounce:c,showIcon:u,hideIcon:f,display:g}}(jQuery),lpInfield=function(e,n,t,i,r,o,a,s,c){var l,d,p,u=c.translateString("No sites found for this web address. You can log in to this website to save your credentials"),f=c.translateString("No sites found matching your search."),g=c.translateString("No Form Fills saved. You can add one in your Vault."),m=c.translateString("No Form Fills found matching your search.");function h(){var t=Date.now();document.addEventListener("DOMContentLoaded",function(){y(function(){var t;c.translate(document.body),w(),I(),i.init(["sitesView","formFillView","generatePassView"]),v(),o.init(C),a.init(n,l,_),new MutationObserver(function(){_()}).observe(e(".infield-dialog")[0],{subtree:!0,childList:!0}),n.getInitialData(P),e("#currentTabText").focus()})})}function w(){p=new s({$parentEl:e(".infield-dialog")}),b({position:360})}function b(n){p&&n&&n.position&&e.isNumeric(n.position)&&n.position>10&&n.position<370&&p.show("top",n.position)}function v(){var n=(l=new t("currentTab",null,_)).createMenu("navigation",null,[{id:"sitesView",text:c.translateString("Log in"),selectedText:c.translateString("Log in as"),action:function(){d.type="sites",P(d)}},{id:"formFillView",text:c.translateString("Fill form"),selectedText:c.translateString("Fill form with"),action:function(){d.type="formfills",P(d)}},{id:"generatePassView",text:c.translateString("Generate a password"),selectedText:c.translateString("Generate a password"),action:function(){d.type="generate",P(d)}}]);e("#navigationPlaceholder").append(n)}function I(){e("#btnClose").click(function(){n.closePopup("close")}),e("#btnClose").keypress(function(){n.closePopup("close")})}function y(e){document.body.style.setProperty("display","none","important");var n=document.createElement("iframe");n.setAttribute("class","backgroundFrame"),n.src="backgroundFrame.html",n.style.display="none",n.addEventListener("load",function(){n.contentWindow.LPPlatform.getBackgroundInterface({mainRequestFramework:!1,interfaceDefinition:Interfaces.InfieldPopupInterface,getData:!0,context:"infieldPopup",callback:function(e){window.bg=e}}),n.contentWindow.Topics.get(n.contentWindow.Topics.REQUEST_FRAMEWORK_INITIALIZED).subscribe(function(n,t){var i=parseInt(n.topFrameID);window.csTop=Interfaces.createInstance(Interfaces.ContentScriptInterface,{direct:!1,context:"infieldPopup",requestFunction:function(e){t.sendRequest({type:"contentScriptRequest",data:e,frameID:i})}}),window.csTop.LPFrame.initializeRequestFramework(LPTools.getURLParams().dialogID,function(n){n&&(document.body.style.removeProperty("display"),e&&e())})})}),document.body.appendChild(n)}function C(e){n.searchVault(e,d.type,k)}function k(e){var n=d.type;if(e){var t=JSON.parse(e);if(t)switch(n){case"sites":r.setup("sitesView",n,t.sites,t.bigicons,_,f);break;case"formfills":r.setup("formFillView",n,t.formfills,null,_,m)}}}function _(n,t){var i=e(".infield-dialog").outerHeight()+20,r=e(".infield-dialog").outerWidth()+10;n&&e.isNumeric(n)&&(i+=n),t&&e.isNumeric(t)&&(r+=t),csTop.LPInfieldFrame.resizeFrame(i,r)}function P(t){if(t){d=t;var s=0;if(t.type)switch(t.type){case"sites":if(t.fillData.sites){var c=JSON.parse(t.fillData.sites),p=t.fillData.bigIcons?JSON.parse(t.fillData.bigIcons):null,f=r.setup("sitesView",t.type,c,p,_,u);l.select("sitesView"),i.show("sitesView"),o.display(f>2),a.hide(),s=Object.keys(c).length}break;case"formfills":var m=t.fillData.formFills?JSON.parse(t.fillData.formFills):{},f=r.setup("formFillView",t.type,m,null,_,g);l.select("formFillView"),i.show("formFillView"),o.display(f>2),a.hide(),s=Object.keys(m).length;break;case"generate":n.getGeneratePrefs(a.setup),l.select("generatePassView"),i.show("generatePassView"),o.display(!1),a.show()}csTop.LPInfieldFrame.positionFrame(function(e){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_OPENED,e)}),csTop.LPInfieldFrame.show(),e(".infield-dialog").show()}else n.closePopup("close")}return{init:h,setArrowPosition:b}}(jQuery,InfieldCommands,InfieldMenu,InfieldView,InfieldTiles,InfieldSearch,InfieldGeneratePassword,lpArrow,Strings);lpInfield&&lpInfield.init();
//# sourceMappingURL=sourcemaps/lpInfield.js.map
