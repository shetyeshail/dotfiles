LPFrame=function(){var e=0,t={},n=null,i=function(n){var i=++e,r=n.tracking,o=null,a=new LPEventManager,s=[],c=null,l=null,u=n.interfaceDefinition;t[i]=this;var f=getchromeurl(n.url);f.indexOf(":id")>-1?f=f.replace(":id",i):f+=(f.indexOf("?")>-1?"&":"?")+"dialogID="+i;var d=LPPlatform.newFrameContainer(f,i);this.close=function(){a.publishEvent("close"),d.close(),window.removeEventListener("resize",this.refreshPosition),window.removeEventListener("scroll",this.refreshPosition),delete t[i]},this.onClose=function(e){a.addEventListener("close",e)},this.css=function(e){d.css(e),this.refreshPosition()};var g=function(e,t,n){if(n){if("string"==typeof n){if(!n.indexOf("%"))throw"trackElement only supports numbers or percentages for translations";n=e[t]*parseInt(n.substring(0,n.indexOf("%")))/100}return n}return 0};this.refreshPosition=function(){if(r){var e=r.element.getBoundingClientRect(),t=e.top,n=e.left;r.frameTranslation&&(t+=g(d,"clientHeight",r.frameTranslation.y),n+=g(d,"clientWidth",r.frameTranslation.x)),r.targetTranslation&&(t+=g(r.element,"clientHeight",r.targetTranslation.y),n+=g(r.element,"clientWidth",r.targetTranslation.x)),d.css({top:t,left:n})}},this.trackElement=function(e){r=e,window.addEventListener("resize",this.refreshPosition),window.addEventListener("scroll",this.refreshPosition)},this.getInterface=function(){return null===l&&(c=function(e){null===o?s.push(e):LPPlatform.requestFramework.sendRequest({type:"contentScriptRequest",data:e,frameID:o})},l=Interfaces.createInstance(u,{direct:!1,context:"contentScript",requestFunction:c})),l};var h=function(){for(var e=[],t=document.getElementsByTagName("iframe"),n=0;n<t.length;++n){var i=t[n];i.src!==f&&i.getAttribute("lpsrc")!==f||e.push(i)}return e};this.initialize=function(e){if(null===o){var t=h();if(!(t.length>1)){o=e;for(var n=0;n<s.length;++n)c(s[n]);return!0}t.forEach(function(e){e.parentElement.removeChild(e)})}return!1},this.getParams=function(){return n.dialogData},this.getDialogID=function(){return i},r&&this.trackElement(r)};Topics.get(Topics.CLEAR_DATA).subscribe(function(){for(var e in t)t[e].close()});var r,o,a,s,c,l,u=function(e){return new i(e)},f,d,g;return{css:function(e){if(e){var n=t[e.id];n&&n.css(e.css)}"function"==typeof e.callback&&e.callback()},close:function(e){var n=t[e];n&&n.close()},openDialog:function(e,t,n){var i=u({url:"contentScriptDialog.html",interfaceDefinition:Interfaces.ContentScriptDialogInterface});return i.getInterface().LPDialog.openDialog(e,t),n&&(n.css&&i.css(n.css),n.callback&&n.callback(i.getDialogID())),i},openAngularDialog:function(e,t,n){var i,r=u({url:"lastpass/index.html#/sandbox/:id/"+e,dialogData:t});return n&&(n.css&&r.css(n.css),n.callback&&n.callback(r.getDialogID())),r},openFrame:u,initializeRequestFramework:function(e,n,i){var r=t[e],o=!1;r&&(o=r.initialize(i)),n&&n(o)},getParams:function(e,n){n(t[e].getParams())},showModal:function(e){null===n&&(n=document.createElement("div"),LPContentScriptTools.setCSS(n,{position:"fixed","z-index":"2147483646",top:"0px",right:"0px",bottom:"0px",left:"0px","background-color":"rgba(52, 61, 68, 0.6)"})),document.body.appendChild(n)},hideModal:function(){n&&document.body.removeChild(n)},numberOfDialogs:function(){return t?Object.keys(t).length:0}}}();
//# sourceMappingURL=sourcemaps/contentScriptFrame.js.map
