var ExtensionLoginDialog=function(e){var a;LoginDialog.call(this,e,{closeButtonEnabled:!1}),this.populatedSavedLogin=!1,(a=this).savedLoginCallback=function(e){for(var i=[],t=function(e){return function(i){bg.delete_saved_login(e),i.stopPropagation(),i.preventDefault();for(var t=0;t<a.data.savedLogins.length;t++)if(a.data.savedLogins[t].username===e){a.data.savedLogins.splice(t,1);break}a.inputFields.email.removeValue(e),a.inputFields.email.inputObject.input.val(""),a.inputFields.password.setValue(""),a.inputFields.email.updateDropdown(""),a.inputFields.email.clearHint()}},o=0,n=e.length;o<n;++o){var s=e[o].username,r=LPTools.createElement("li",{dropdownValue:s},"");r.appendChild(LPTools.createElement("span",{class:"dropdownText"},s));var l=LPTools.createElement("img",{src:"images/vault_4.0/Close_x.png",class:"ddl-remove"});LPPlatform.addEventListener(l,"mousedown",t(s)),r.appendChild(l),i.push({value:s,label:s,element:r})}if(a.inputFields.email.setOptions(i),e.length>0){var d=e[0];a.data.savedLogins=e,a.inputFields.email.setValue(d.username),a.inputFields.password.focus()}else a.inputFields.email.focus();a.data.sesameusername&&a.inputFields.email.setValue(a.data.sesameusername)}};ExtensionLoginDialog.prototype=Object.create(LoginDialog.prototype),ExtensionLoginDialog.prototype.constructor=ExtensionLoginDialog,function(){var e,a;ExtensionLoginDialog.prototype.populateSavedLogin=function(e){this.inputFields.password.setValue(e),this.inputFields.rememberPassword.setValue(""!==e),this.populatedSavedLogin=!0},ExtensionLoginDialog.prototype.parseSavedLogin=function(e){switch(e.protected){case 0:this.populateSavedLogin(e.password);break;case 1:bg.unprotect_data(e.password,!1,this.createDynamicHandler(function(e){this.populateSavedLogin(e)}));break;case 2:this.populateSavedLogin(bg.lpdec(e.password,bg.AES.hex2bin(bg.SHA256(e.username))))}},ExtensionLoginDialog.prototype.initialize=function(e){var a,i,t;LoginDialog.prototype.initialize.apply(this,arguments),this.inputFields.rememberPassword.getElement().bind("click",(a=this,i=!1,t=function(){i=!0,a.inputFields.rememberPassword.setValue(!0)},function(){var e=a.inputFields.rememberPassword.getValue();!i&&e?(dialogs.confirmation.open({title:Strings.translateString("Are you sure?"),text:Strings.translateString("Using 'remember password' makes it easier to forget your password and decreases your security if your device is infected or stolen."),handler:t,onResize:a.data.onResize}),a.inputFields.rememberPassword.setValue(!1)):i=!1}));var o=(n=this,function(e){bg.FederatedLogin.isFederated(e,function(a){a&&(bg.FederatedLogin.login(e),n.federatedLoginStarted())});var a=n.populatedSavedLogin;if(n.populatedSavedLogin=!1,n.data.savedLogins)for(var i=0,t=n.data.savedLogins.length;i<t;++i){var o=n.data.savedLogins[i];if(o.username===e){n.parseSavedLogin(o);break}}a&&!n.populatedSavedLogin&&(n.inputFields.password.clear(),n.inputFields.rememberPassword.clear());var r=s;e&&bg.localStorage_getItem(bg.SHA256(e)+".noremember")?($("#ExtensionLoginDialogRememberPasswordContainer").hide(),s=!1):($("#ExtensionLoginDialogRememberPasswordContainer").show(),s=!0)}),n,s;this.inputFields.email.onChange(o),this.inputFields.email.inputObject.onChange(o)},ExtensionLoginDialog.prototype.federatedLoginStarted=function(){this.close(!0)},ExtensionLoginDialog.prototype.setup=function(){LoginDialog.prototype.setup.apply(this,arguments),bg.get_saved_logins(this.savedLoginCallback),$("#loginDialogDisableBrowserDiv").hide()},ExtensionLoginDialog.prototype.open=function(e){LoginDialog.prototype.open.call(this,$.extend(e,{defaultData:{rememberEmail:bg.Preferences.get("rememberemail"),rememberPassword:bg.Preferences.get("rememberpassword"),rememberShowVault:bg.Preferences.get("showvault")}}))},ExtensionLoginDialog.prototype.handleSubmit=(e=null,a=function(a){null===e&&(e=setInterval(function(){"undefined"==typeof VaultState&&bg.getData&&bg.getData({context:"login"}),bg.get("lploggedin")&&(clearInterval(e),e=null,data.disablePasswordManager&&"undefined"==typeof InstallTrigger?bg.disablepasswordmanager(data.disablePasswordManager,a):a.close())},1e3))},function(e){var i,t;e.email=bg.fix_username(e.email),bg.Preferences.set({rememberemail:e.rememberEmail,rememberpassword:e.rememberPassword,showvault:e.rememberShowVault}),bg.make_lp_key_hash(e.email,e.password,(i=bg,t=this,function(a,o){i.set("g_manual_login",!0),i.LP_do_login(e.email,e.password,e.rememberEmail,e.rememberPassword,null,e.rememberShowVault,a,o),t.data.isPopup&&(e.disablePasswordManager&&"undefined"==typeof InstallTrigger?i.disablepasswordmanager(e.disablePasswordManager,t):t.close(!0))})),this.data.isPopup?e.disablePasswordManager&&"undefined"==typeof InstallTrigger&&bg.disablepasswordmanager(e.disablePasswordManager,this):a(this,e.disablePasswordManager)})}();
//# sourceMappingURL=sourcemaps/extensionLoginDialog.js.map
