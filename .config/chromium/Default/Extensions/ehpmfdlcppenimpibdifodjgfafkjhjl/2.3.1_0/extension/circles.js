function parse_query_string(e){for(var n=e.split("&"),r={},i=0;i<n.length;i++){var t=n[i].split("=");if("undefined"==typeof r[t[0]])r[t[0]]=decodeURIComponent(t[1]);else if("string"==typeof r[t[0]]){var s=[r[t[0]],decodeURIComponent(t[1])];r[t[0]]=s}else r[t[0]].push(decodeURIComponent(t[1]))}return r}function scrollForFriends(){if(debugMode)return void allFriendsLoaded();if("mainFriends"==siteType&&0==mainFriendsLoaded||"mutualFriends"==siteType){var e='[id^="timeline-medley"]';"mutualFriends"==siteType&&(e=".fbProfileBrowserResult"),"mutualFriends"==siteType&&0==$(".uiMorePager").length?(console.log("final num friends: "+getFriends().length),allFriendsLoaded()):($(e).first().bind("DOMSubtreeModified",function(){var n=$(e).find("[id^=pagelet]").size();getNonFriends().length;"mainFriends"==siteType&&n<3||"mutualFriends"==siteType&&0!=$(".uiMorePager").length?funcScroll():(console.log("final num friends: "+getFriends().length),$(e).first().unbind(),allFriendsLoaded())}),funcScroll())}}function doGetImage(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===this.readyState&&(200===this.status?n(this.response):(console.error("Error sending AJAX request to fetch image. Status: "+this.status+". Text: "+this.statusText),n()))},r.onerror=function(){console.error("Error sending AJAX request to fetch image: "+e),n()},r.open("GET",e),r.responseType="blob",r.send()}var debugMode=!1,link=window.location.href,siteType="bad",myUsername=/facebook.com\/([^\"]+)/.exec($('[title^="Profil"]').attr("href"))[1],myID=/profile_pic_header_([0-9]+)/.exec($('[id^="profile_pic_header"]').attr("id"))[1],getNonFriends=function(){var e=getAllFriends();return $(e).filter(function(e,n){return null==n.querySelector(".FriendRequestAdd.hidden_elem")})},getAllFriends=function(){return $('[data-testid="friend_list_item"], .fbProfileBrowserListItem')},getFriends=function(){var e=getAllFriends();return e},getMutualFriends=getFriends,funcScroll=function(){$("html, body").animate({scrollTop:$(document).height()},0)},getJsonFriends=function(e){var n={userID:myID,userName:myUsername,friends:[]};return e?n.type="mutualFriends":n.type="mainFriends",getFriends().each(function(r,i){try{var t=$(i).find("[data-hovercard*=ajax]").last(),s=$(t).attr("href"),o=$(t).attr("data-hovercard"),d=/id=([0-9]*)/.exec(o)[1],a=/facebook.com\/(profile.php\?id=[0-9]*|[^\?]+)/.exec(s)[1],l=$(t).text();if(0==e){var u=$(i).find("img").first().attr("src");doGetImage(u,function(e){var n=new window.FileReader;n.readAsDataURL(e),n.onloadend=function(){var e=n.result,r={type:"image",id:d,dataUrl:e};chrome.runtime.sendMessage(r,function(e){})}})}n.friends.push({id:d,name:l,userName:a,profile:s})}catch(e){console.log(e);var c=$(i).find("a").last().text();console.log("error parsing friend, probably inactive: "+c),n.friends.push({id:d,name:c,userName:null,profile:"https://www.facebook.com/profile.php?id="+d})}}),n},allFriendsLoaded=function(){var e=getJsonFriends("mainFriends"!=siteType);chrome.runtime.sendMessage(e,function(e){})},request={type:"loadStatus",id:myID},mainFriendsLoaded=!1;console.log(window.location.href),null!=/mutual_friends/.exec(link)?siteType="mutualFriends":null!=/sk=friends/.exec(link)&&(siteType="mainFriends"),"mutualFriends"==siteType&&$("h2").each(function(e,n){var r=$(n).text();r.includes("Sorry, this page isn't available")&&allFriendsLoaded()});var query=window.location.search.substring(1),qs=parse_query_string(query);console.log(qs),"mutualFriends"==siteType&&(myID=qs.node),"mutualFriends"==siteType&&(getFriends=getMutualFriends),"mainFriends"==siteType?chrome.runtime.sendMessage(request,function(e){"friendsLoaded"==e.status&&(mainFriendsLoaded=!0),scrollForFriends()}):scrollForFriends(),"mainFriends"==siteType&&chrome.runtime.sendMessage({type:"setMainTab"});