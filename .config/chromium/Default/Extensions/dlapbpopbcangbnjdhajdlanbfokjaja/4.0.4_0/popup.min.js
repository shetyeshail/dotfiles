(function(){var a,b=function(c,d){return function(){return c.apply(d,arguments);};};window.TagTypeahead=a=(function(){function c(f){var h,e,d,g;this.minLength=f;this.setup=b(this.setup,this);this.loadInitial=b(this.loadInitial,this);this.wrapList=b(this.wrapList,this);this.url=(document.environment||"")+"/api/hashtags/suggestions?version=1";if(g=typeof Refind!=="undefined"&&Refind!==null?(h=Refind.data)!=null?(e=h.appState)!=null?(d=e.user)!=null?d.id:void 0:void 0:void 0:void 0){this.url+="&user_id="+g;}this.url+="&prefix=%q";}c.prototype.wrapItem=function(d){return"<span class='tt-suggestion tt-selectable'>"+d+"</span>";};c.prototype.wrapList=function(h){var g,e,f,d;g=[];for(e=0,d=h.length;e<d;e++){f=h[e];g.push(this.wrapItem(f));}return"<div class='tt-dataset tt-dataset-typeahead'>"+(g.join(""))+"</div>";};c.prototype.loadInitial=function(){var d;if(d=$("body").data("tags-autocomplete")){return d.map((function(e){return function(f){return e.wrapResult(f.name,f.rendered_count);};})(this));}else{return this.spinner();}};c.prototype.spinner=function(){return['<div class="circle-spinner" style="margin: 30px auto;"></div>'];};c.prototype.wrapResult=function(d,e){return"<span>"+d+"<span class='count'>("+e+")</span></span>";};c.prototype.setup=function(e,d){return $(e,d).typeahead({minLength:0,highlight:true,hint:true},{name:"typeahead",source:this.getSuggestions(),limit:5,display:"name",templates:{pending:(function(f){return function(g){if(g.query.length===0){return f.wrapList(f.loadInitial());}else{return f.wrapList(f.spinner());}};})(this),suggestion:(function(f){return function(g){return f.wrapResult(g.name,g.rendered_count);};})(this)}});};c.prototype.getSuggestions=function(){return new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:this.url,prepare:function(e,d){this.lastQuery=e;d.url=d.url.replace("%q",encodeURIComponent(e));return d;},transform:function(d){return d.map(function(e){if(e.count!=null){return e;}else{e.rendered_count=e.name.match(/[,;]/)?"add tags":"add tag";return e;}});}}});};return c;})();}).call(this);(function(){var a;a=Refind["for"](document.environment);a.setupPopover();}).call(this);